package com.bachue.snr.prosnr01.dao.acc;

import com.b2bsg.common.exception.B2BException;

import com.b2bsg.common.util.CollectionUtils;
import com.b2bsg.common.util.DateUtils;
import com.b2bsg.common.util.NumericUtils;
import com.b2bsg.common.util.StringUtils;

import com.bachue.snr.prosnr01.common.constants.EstadoCommon;
import com.bachue.snr.prosnr01.common.constants.EtapaCommon;
import com.bachue.snr.prosnr01.common.constants.IdentificadoresCommon;
import com.bachue.snr.prosnr01.common.constants.ProcesoCommon;

import com.bachue.snr.prosnr01.dao.auditoria.AuditoriaDao;
import com.bachue.snr.prosnr01.dao.util.ConsultasUtilidades;

import com.bachue.snr.prosnr01.model.aprobacion.Aprobacion;
import com.bachue.snr.prosnr01.model.calificacion.Calificacion;
import com.bachue.snr.prosnr01.model.calificacion.TramiteCantidad;
import com.bachue.snr.prosnr01.model.consulta.trazabilidad.Trazabilidad;
import com.bachue.snr.prosnr01.model.reasignar.ReasignarTurnos;
import com.bachue.snr.prosnr01.model.sdb.acc.Proceso;
import com.bachue.snr.prosnr01.model.sdb.acc.TipoCausal;
import com.bachue.snr.prosnr01.model.sdb.acc.Turno;
import com.bachue.snr.prosnr01.model.sdb.acc.TurnoHistoria;
import com.bachue.snr.prosnr01.model.sdb.col.InteresadoDocumentoTipo;

import java.math.BigDecimal;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;

import java.util.ArrayList;
import java.util.Collection;
import java.util.LinkedHashMap;
import java.util.LinkedList;
import java.util.Map;


// TODO: Auto-generated Javadoc
/**
 * Clase que contiene todos las consultas de la tabla SDB_ACC_TURNO_HISTORIA.
 *
 * @author hcastaneda
 */
public class TurnoHistoriaDAO extends AuditoriaDao
{
	/** Constante cs_FIND_BY_ALL_ID_SOLICITUD. */
	private static final String cs_FIND_ALL_BY_ID_SOLICITUD = "SELECT *FROM SDB_ACC_TURNO_HISTORIA WHERE ID_SOLICITUD = ? ORDER BY ID_TURNO_HISTORIA";

	/** Constante cs_FIND_BY_ALL_ID_SOLICITUD_ID_TURNO. */
	private static final String cs_FIND_ALL_BY_ID_SOLICITUD_ID_TURNO = "SELECT * FROM SDB_ACC_TURNO_HISTORIA WHERE "
		+ "ID_SOLICITUD=? AND ID_TURNO=? ORDER BY ID_TURNO_HISTORIA";

	/** Constante cs_UPDATE_RENUNCIA_TERMINOS. */
	private static final String cs_UPDATE_RENUNCIA_TERMINOS = "UPDATE SDB_ACC_TURNO_HISTORIA SET RENUNCIA_TERMINOS = ?, FECHA_MODIFICACION = SYSTIMESTAMP, ID_USUARIO_MODIFICACION = ? WHERE ID_TURNO_HISTORIA = ?";

	/** Constante cs_FIND_BY_ID_SOLICITUD_80_BLQ. */
	private static final String cs_FIND_BY_ID_SOLICITUD_80_BLQ = "SELECT * FROM SDB_ACC_TURNO_HISTORIA WHERE ID_SOLICITUD = ? AND ESTADO_ACTIVIDAD = 'BLQ' AND ID_ETAPA = '80'";

	/** Constante cs_FIND_BY_ID. */
	private static final String cs_FIND_BY_ID = "SELECT * FROM SDB_ACC_TURNO_HISTORIA "
		+ " WHERE ID_TURNO_HISTORIA = ?";

	/** Constante cs_FIND_BY_ID_ANTERIOR. */
	private static final String cs_FIND_BY_ID_ANTERIOR = "SELECT * FROM SDB_ACC_TURNO_HISTORIA "
		+ " WHERE ID_ANTERIOR = ?";

	/** Constante cs_HAS_STAGE. */
	private static final String cs_HAS_STAGE = "SELECT COUNT (0) AS CONTEO FROM SDB_ACC_TURNO_HISTORIA WHERE ID_TURNO = ? AND ID_ETAPA = ?";

	/** Constante cs_FIND_BY_ID_MENSAJE. */
	private static final String cs_FIND_BY_ID_MENSAJE = "SELECT * FROM SDB_ACC_TURNO_HISTORIA "
		+ " WHERE ID_MENSAJE = ?";

	/** Constante cs_FIND_BY_SOLICITUD. */
	private static final String cs_FIND_BY_SOLICITUD = "SELECT * FROM SDB_ACC_TURNO_HISTORIA "
		+ " WHERE ID_SOLICITUD = ?";

	/** Constante cs_FIND_BY_TURNO_SUSPENSION. */
	private static final String cs_FIND_BY_TURNO_SUSPENSION_ENTREGA_DOC = "SELECT * FROM SDB_ACC_TURNO_HISTORIA  WHERE ID_ETAPA >= 280 AND ID_ETAPA <= 281 AND ID_TURNO = ? OR ID_ETAPA >= 284 AND ID_ETAPA <= 292 AND ID_TURNO = ? OR ID_ETAPA >= 405 AND ID_ETAPA <= 406 AND ID_TURNO = ? OR ID_ETAPA IN (310,190) AND ID_TURNO = ?";

	/** Constante cs_FIND_BY_TURNO_SUSPENSION. */
	private static final String cs_FIND_BY_TURNO_SUSPENSION_PRORROGA_ENTREGA = "SELECT * FROM SDB_ACC_TURNO_HISTORIA  WHERE ID_ETAPA >= 280 AND ID_ETAPA <= 281 AND ID_TURNO = ? OR ID_ETAPA >= 284 AND ID_ETAPA <= 288  AND ID_TURNO = ? OR ID_ETAPA >= 291 AND ID_ETAPA <= 292 AND ID_TURNO = ? ";

	/** Constante cs_FIND_BY_TURNO_FASE_ENTREGA. */
	private static final String cs_FIND_BY_TURNO_FASE_ENTREGA = "SELECT * FROM SDB_ACC_TURNO_HISTORIA  WHERE ID_ETAPA >= 200 AND ID_TURNO = ? AND ESTADO_ACTIVIDAD = 'ASG' ";

	/** Constante cs_FIND_ALL_GENERACION_CITATORIO. */
	private static final String cs_FIND_ALL_BY_ETAPA_AUT = "SELECT SATH.* FROM SDB_ACC_TURNO_HISTORIA SATH ";

	/** Constante cs_FIND_MAX_BY_ID_ETAPA. */
	private static final String cs_FIND_MAX_BY_ID_ETAPA = "SELECT * FROM SDB_ACC_TURNO_HISTORIA  WHERE ID_ETAPA = ? ";

	/** Constante cs_FIND_BY_TURNO_PRORROGA_MAYOR_VALOR. */
	private static final String cs_FIND_BY_TURNO_PRORROGA_MAYOR_VALOR = "SELECT * FROM SDB_ACC_TURNO_HISTORIA  WHERE ID_ETAPA >= 282 AND ID_ETAPA <= 283 AND ID_TURNO = ?";

	/** Constante cs_FIND_BY_TURNO_SEGUNDA_INSTANCIA. */
	private static final String cs_FIND_BY_TURNO_SEGUNDA_INSTANCIA = "SELECT * FROM SDB_ACC_TURNO_HISTORIA  WHERE ID_ETAPA >= 400 AND ID_ETAPA <= 401 AND ID_TURNO = ?";

	/** Constante cs_FIND_BY_SOLICITUD_PROCESO. */
	private static final String cs_FIND_BY_SOLICITUD_PROCESO = "SELECT DISTINCT TH.ID_TURNO FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO T ON T.ID_TURNO = TH.ID_TURNO WHERE TH.ID_SOLICITUD = ? AND TH.ID_PROCESO = ? AND TH.ID_TURNO IS NOT NULL AND T.ANULADO <> 'S'";

	/** Constante cs_FIND_BY_SOLICITUD_ETAPA. */
	private static final String cs_FIND_BY_SOLICITUD_ETAPA = "SELECT * FROM SDB_ACC_TURNO_HISTORIA "
		+ " WHERE ID_ETAPA = ? ";

	/** Constante cs_FIND_BY_ID_TURNO. */
	private static final String cs_FIND_BY_ID_TURNO = "SELECT * FROM SDB_ACC_TURNO_HISTORIA WHERE ID_TURNO=?";

	/** Constante cs_FIND_MAX_BY_ID_TURNO_ETAPA. */
	private static final String cs_FIND_MAX_BY_ID_TURNO_ETAPA = "SELECT MAX(ID_TURNO_HISTORIA) AS ID_TURNO_HISTORIA FROM SDB_ACC_TURNO_HISTORIA WHERE ID_ETAPA = ? AND ID_TURNO = ? ";

	/** Constante cs_FIND_BY_ID_TURNO. */
	private static final String cs_FIND_BY_NIR = "SELECT * FROM SDB_ACC_TURNO_HISTORIA ATH "
		+ "INNER JOIN SDB_ACC_SOLICITUD SAS ON SAS.ID_SOLICITUD = ATH.ID_SOLICITUD WHERE SAS.NIR = ?  ";

	/** Constante cs_FIND_BY_ID_TURNO_DESC. */
	private static final String cs_FIND_BY_ID_TURNO_DESC = "SELECT * FROM SDB_ACC_TURNO_HISTORIA WHERE ID_TURNO = ? ORDER BY ID_ETAPA DESC";

	/** Constante cs_FIND_MAX_ID_TELEFONO. */
	private static final String cs_FIND_MAX_ID_TELEFONO = "SELECT MAX(TO_NUMBER(ID_TELEFONO))"
		+ " FROM SDB_ACC_TURNO_HISTORIA WHERE ID_PERSONA = ?";

	/** Constante cs_FIND_SECUENCE. */
	private static final String cs_FIND_SECUENCE = "SELECT SEC_ACC_TURNO_HISTORIA_ID_TURNO_HISTORIA.NEXTVAL FROM DUAL";

	/** Constante cs_UPDATE_OBSERVACIONES. */
	private static final String cs_UPDATE_OBSERVACIONES = "UPDATE SDB_ACC_TURNO_HISTORIA SET "
		+ " OBSERVACIONES = ?, ID_USUARIO_MODIFICACION = ?, FECHA_MODIFICACION = SYSTIMESTAMP,"
		+ " IP_MODIFICACION = ? WHERE ID_TURNO_HISTORIA = ?";

	/** Constante cs_UPDATE_OBSERVACIONES_NO_TRAMITE. */
	private static final String cs_UPDATE_OBSERVACIONES_NO_TRAMITE = "UPDATE SDB_ACC_TURNO_HISTORIA SET "
		+ " OBSERVACIONES_NO_TRAMITE = ?, ID_USUARIO_MODIFICACION = ?, FECHA_MODIFICACION = SYSTIMESTAMP,"
		+ " IP_MODIFICACION = ? WHERE ID_TURNO_HISTORIA = ?";

	/** Constante cs_UPDATE. */
	private static final String cs_UPDATE = "UPDATE SDB_ACC_TURNO_HISTORIA SET "
		+ " ID_TURNO = ?,ID_SOLICITUD = ?,ID_ETAPA = ?,ID_USUARIO = ?,ID_CIRCULO_USUARIO = ?,INDICADOR_DEVOLUCION = ?, "
		+ "	ESTADO_ACTIVIDAD = ?,FECHA_REPARTO = ?,FECHA_INICIAL = ?,FECHA_FINAL = SYSTIMESTAMP,CALIFICACION = ?,MOTIVO = ?,OBSERVACIONES = ?, JUSTIFICACION = ?, OBSERVACIONES_NO_TRAMITE = ?, "
		+ "	ID_ANTERIOR = ?,ID_PROCESO = ?,ID_USUARIO_MODIFICACION = ?, "
		+ "	FECHA_MODIFICACION = SYSTIMESTAMP, IP_MODIFICACION = ?, ID_MOTIVO = ?, GENERAR_RELACION=?, NUMERO_RELACION=?, ID_SUBPROCESO=?,VERSION_SUBPROCESO=? WHERE ID_TURNO_HISTORIA = ? ";

	/** Constante cs_UPDATE_FECHA_INICIAL. */
	private static final String cs_UPDATE_FECHA_INICIAL = "UPDATE SDB_ACC_TURNO_HISTORIA SET "
		+ "	FECHA_INICIAL = SYSTIMESTAMP, FECHA_MODIFICACION = SYSTIMESTAMP, IP_MODIFICACION = ?,ID_USUARIO_MODIFICACION = ?"
		+ " WHERE ID_TURNO_HISTORIA = ? ";

	/** Constante cs_INSERT. */
	private static final String cs_INSERT = "INSERT INTO SDB_ACC_TURNO_HISTORIA (ID_TURNO_HISTORIA,"
		+ " ID_TURNO,ID_SOLICITUD,ID_ETAPA,ID_USUARIO,ID_CIRCULO_USUARIO,INDICADOR_DEVOLUCION, "
		+ "	ESTADO_ACTIVIDAD,FECHA_REPARTO,FECHA_INICIAL,FECHA_FINAL,CALIFICACION,MOTIVO,OBSERVACIONES,JUSTIFICACION,OBSERVACIONES_NO_TRAMITE, "
		+ "	ID_ANTERIOR,ID_PROCESO,ID_USUARIO_CREACION,FECHA_CREACION,IP_CREACION,ID_MOTIVO,GENERAR_RELACION,NUMERO_RELACION,ID_SUBPROCESO,VERSION_SUBPROCESO) "
		+ " VALUES (?,?,?,?,?,?,?,?,?,SYSTIMESTAMP,SYSTIMESTAMP,?,?,?,?,?,?,?,?,SYSTIMESTAMP,?,?,?,?,?,?)";

	/** Constante cs_SAVE_TIPOS_CAUSALES. */
	private static final String cs_SAVE_TIPOS_CAUSALES = " INSERT INTO SDB_ACC_NOTA_DEVOLUTIVA (ID_NOTA_DEVOLUTIVA,ID_TURNO,ID_TURNO_HISTORIA,ID_CAUSAL,ID_USUARIO_CREACION ,FECHA_CREACION ) "
		+ "		VALUES (?,?,?,?,?,SYSTIMESTAMP)";

	/** Constante cs_FIND_SECUENCE_NOTA_DEVOLUTIVA. */
	private static final String cs_FIND_SECUENCE_NOTA_DEVOLUTIVA = "  SELECT SEC_ACC_NOTA_DEVOLUTIVA_ID_NOTA_DEVOLUTIVA.NEXTVAL FROM DUAL";

	/** Constante cs_FIND_DATOS_TURN. */
	private static final String cs_FIND_DATOS_TURN = "   SELECT ID_TURNO,ID_SOLICITUD  FROM SDB_ACC_TURNO_HISTORIA WHERE ID_TURNO_HISTORIA  = ?  AND ID_ETAPA =  ? ";

	/** Constante cs_FIND_TURNO_HISTORIA_IN_ETAPA_280_OR_281. */
	private static final String cs_FIND_TURNO_HISTORIA_IN_ETAPA_280_OR_281 = "SELECT * FROM SDB_ACC_TURNO_HISTORIA WHERE ID_TURNO = ? AND ID_ETAPA IN (280,281)";

	/** Constante cs_FIND_TURNO_DERIVADO. */
	private static final String cs_FIND_TURNO_DERIVADO = "  SELECT ID_TURNO_HIJO  FROM SDB_ACC_TURNO_DERIVADO WHERE ID_TURNO_PADRE = ? ";

	/** Constante cs_INSERT_CHEKS. */
	private static final String cs_INSERT_CHEKS = "  INSERT INTO SDB_ACC_CORRECCION_DATOS_DOCUMENTO(ID_SOLICITUD,ID_TURNO_HISTORIA,CAMPO,FECHA_CREACION,ID_USUARIO_CREACION)"
		+ "VALUES( ?,?,?,SYSTIMESTAMP,?)";

	/** Constante cs_DATA_PRINCIPAL. */
	private static final String cs_DATA_PRINCIPAL = "SELECT P.NOMBRE PROCESO,TH.ID_TURNO,  S.NIR,TH.MOTIVO_NO_TRAMITE ,TH.MOTIVO, TH.OBSERVACIONES,TH.ID_TURNO_HISTORIA,TH.ESTADO_ACTIVIDAD,TH.ID_PROCESO"
		+ " FROM SDB_ACC_TURNO_HISTORIA TH RIGHT JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO RIGHT JOIN SDB_ACC_PROCESO P ON TH.ID_PROCESO = P.ID_PROCESO"
		+ " RIGHT JOIN SDB_ACC_SOLICITUD S ON TH.ID_PROCESO = S.ID_PROCESO AND TH.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_SUBPROCESO SUB ON S.ID_PROCESO = SUB.ID_PROCESO AND S.ID_SUBPROCESO = SUB.ID_SUBPROCESO "
		+ " WHERE TH.ID_ETAPA = ? AND SUB.NOMBRE = ? AND TH.ID_USUARIO = ?  AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') AND LTRIM(RTRIM(TH.MOTIVO_NO_TRAMITE)) = ?  ";

	/** Constante cs_DATA_PRINCIPAL. */
	private static final String cs_DATA_PRINCIPAL_SIN_USUARIO = "SELECT P.NOMBRE PROCESO,TH.ID_TURNO,  S.NIR,TH.MOTIVO_NO_TRAMITE ,TH.MOTIVO, TH.OBSERVACIONES,TH.ID_TURNO_HISTORIA,TH.ESTADO_ACTIVIDAD,TH.ID_PROCESO"
		+ " FROM SDB_ACC_TURNO_HISTORIA TH RIGHT JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO RIGHT JOIN SDB_ACC_PROCESO P ON TH.ID_PROCESO = P.ID_PROCESO"
		+ " RIGHT JOIN SDB_ACC_SOLICITUD S ON TH.ID_PROCESO = S.ID_PROCESO AND TH.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_SUBPROCESO SUB ON S.ID_PROCESO = SUB.ID_PROCESO AND S.ID_SUBPROCESO = SUB.ID_SUBPROCESO "
		+ " WHERE TH.ID_ETAPA = ? AND SUB.NOMBRE = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') AND LTRIM(RTRIM(TH.MOTIVO_NO_TRAMITE)) = ?  ";

	/** Constante cs_BANDEJA_APROBACION_SUBPROCESO. */
	private static final String cs_BANDEJA_APROBACION_SUBPROCESO = "SELECT  SUB.NOMBRE, COUNT (0) CANTIDAD FROM SDB_ACC_TURNO_HISTORIA TH RIGHT JOIN SDB_ACC_PROCESO P ON TH.ID_PROCESO = P.ID_PROCESO RIGHT JOIN SDB_ACC_SOLICITUD S ON TH.ID_PROCESO = S.ID_PROCESO AND TH.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_SUBPROCESO SUB ON S.ID_PROCESO = SUB.ID_PROCESO AND S.ID_SUBPROCESO = SUB.ID_SUBPROCESO WHERE TH.ID_PROCESO = ? AND TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') ";

	/** Constante cs_BANDEJA_APROBACION_SUBPROCESO. */
	private static final String cs_BANDEJA_APROBACION_SUBPROCESO_ACTO = "SELECT  SUB.NOMBRE, COUNT (0) CANTIDAD FROM SDB_ACC_TURNO_HISTORIA TH RIGHT JOIN SDB_ACC_PROCESO P ON TH.ID_PROCESO = P.ID_PROCESO RIGHT JOIN SDB_ACC_SOLICITUD S ON TH.ID_PROCESO = S.ID_PROCESO AND TH.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_SUBPROCESO SUB ON S.ID_PROCESO = SUB.ID_PROCESO AND S.ID_SUBPROCESO = SUB.ID_SUBPROCESO INNER JOIN SDB_ACC_ACTO ASA ON ASA.ID_SOLICITUD = S.ID_SOLICITUD AND ASA.ID_TIPO_ACTO = '0463' WHERE TH.ID_PROCESO = ? AND TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') ";

	/** Constante cs_BANDEJA_APROBACION_SUBPROCESO_SIN_USUARIO. */
	private static final String cs_BANDEJA_APROBACION_SUBPROCESO_SIN_USUARIO = "SELECT  SUB.NOMBRE, COUNT (NVL(SUB.NOMBRE,'SIN_NOMBRE'))CANTIDAD FROM SDB_ACC_TURNO_HISTORIA TH RIGHT JOIN SDB_ACC_PROCESO P ON TH.ID_PROCESO = P.ID_PROCESO RIGHT JOIN SDB_ACC_SOLICITUD S ON TH.ID_PROCESO = S.ID_PROCESO AND TH.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_SUBPROCESO SUB ON S.ID_PROCESO = SUB.ID_PROCESO AND S.ID_SUBPROCESO = SUB.ID_SUBPROCESO WHERE TH.ID_PROCESO = ? AND TH.ID_ETAPA = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') ";

	/** Constante cs_BANDEJA_APROBACION_EJECUCION_SUBPROCESO_SIN_USUARIO. */
	private static final String cs_BANDEJA_APROBACION_EJECUCION_SUBPROCESO_SIN_USUARIO = "SELECT SUB.NOMBRE, COUNT(NVL(SUB.NOMBRE,'SIN_NOMBRE') ) CANTIDAD FROM SDB_ACC_TURNO_HISTORIA TH RIGHT JOIN SDB_ACC_PROCESO P ON TH.ID_PROCESO = P.ID_PROCESO RIGHT JOIN SDB_ACC_SOLICITUD S ON TH.ID_PROCESO = S.ID_PROCESO AND TH.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_SUBPROCESO SUB ON S.ID_PROCESO = SUB.ID_PROCESO AND S.ID_SUBPROCESO = SUB.ID_SUBPROCESO INNER JOIN SDB_ACC_TURNO_HISTORIA TH2 ON TH2.ID_TURNO_HISTORIA = TH.ID_ANTERIOR WHERE TH.ID_PROCESO = ? AND TH.ID_ETAPA = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG','BLQ') ";

	/** Constante cs_BANDEJA_APROBACION. */
	private static final String cs_BANDEJA_APROBACION = "SELECT ATH2.ID_ETAPA, ATH2.ID_MOTIVO,TH.MOTIVO_NO_TRAMITE, COUNT (NVL(TH.MOTIVO_NO_TRAMITE,'SIN_MOTIVO'))CANTIDAD FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO_HISTORIA ATH2 ON ATH2.ID_TURNO_HISTORIA = TH.ID_ANTERIOR RIGHT JOIN SDB_ACC_PROCESO P ON TH.ID_PROCESO = P.ID_PROCESO RIGHT JOIN SDB_ACC_SOLICITUD S ON TH.ID_PROCESO = S.ID_PROCESO AND TH.ID_SOLICITUD = S.ID_SOLICITUD RIGHT JOIN SDB_ACC_SUBPROCESO SUB ON SUB.ID_PROCESO = S.ID_PROCESO AND SUB.ID_SUBPROCESO = S.ID_SUBPROCESO WHERE TH.ID_PROCESO = ? AND TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') AND SUB.NOMBRE = ? ";

	/** Constante cs_BANDEJA_APROBACION_SIN_USUARIO. */
	private static final String cs_BANDEJA_APROBACION_SIN_USUARIO = "SELECT ATH2.ID_ETAPA, ATH2.ID_MOTIVO,TH.MOTIVO_NO_TRAMITE, COUNT (NVL(TH.MOTIVO_NO_TRAMITE,'SIN_MOTIVO'))CANTIDAD FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO_HISTORIA ATH2 ON ATH2.ID_TURNO_HISTORIA = TH.ID_ANTERIOR RIGHT JOIN SDB_ACC_PROCESO P ON TH.ID_PROCESO = P.ID_PROCESO RIGHT JOIN SDB_ACC_SOLICITUD S ON TH.ID_PROCESO = S.ID_PROCESO AND TH.ID_SOLICITUD = S.ID_SOLICITUD RIGHT JOIN SDB_ACC_SUBPROCESO SUB ON SUB.ID_PROCESO = S.ID_PROCESO AND SUB.ID_SUBPROCESO = S.ID_SUBPROCESO WHERE TH.ID_PROCESO = ? AND TH.ID_ETAPA = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') AND SUB.NOMBRE = ? ";

	/** Constante cs_BANDEJA_APROBACION_SIN_MOTIVO_NO_TRAMITE. */
	private static final String cs_BANDEJA_APROBACION_SIN_MOTIVO_NO_TRAMITE = "SELECT ATH2.ID_ETAPA, ATH2.ID_MOTIVO, CASE WHEN ATH2.ID_ETAPA = '199' THEN 'PUBLICACIÓN AVISO WEB' ELSE TH.MOTIVO_NO_TRAMITE END MOTIVO_NO_TRAMITE, COUNT (NVL(TH.MOTIVO_NO_TRAMITE,'SIN_MOTIVO'))CANTIDAD, SUB.ID_SUBPROCESO FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO_HISTORIA ATH2 ON ATH2.ID_TURNO_HISTORIA = TH.ID_ANTERIOR RIGHT JOIN SDB_ACC_PROCESO P ON TH.ID_PROCESO = P.ID_PROCESO RIGHT JOIN SDB_ACC_SOLICITUD S ON TH.ID_PROCESO = S.ID_PROCESO AND TH.ID_SOLICITUD = S.ID_SOLICITUD "
		+ "RIGHT JOIN SDB_ACC_SUBPROCESO SUB ON SUB.ID_PROCESO = S.ID_PROCESO AND SUB.ID_SUBPROCESO = S.ID_SUBPROCESO WHERE TH.ID_PROCESO = ? AND TH.ID_ETAPA = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') AND SUB.NOMBRE = ? ";

	/** Constante cs_TURNOS_DERIVADOS. */
	private static final String cs_TURNOS_DERIVADOS = " SELECT ID_TURNO_HIJO FROM SDB_ACC_TURNO_DERIVADO WHERE ID_TURNO_PADRE = ?";

	/** Constante cs_TURNOS_DERIVADOS_NO_VINCULADOS. */
	private static final String cs_TURNOS_DERIVADOS_NO_VINCULADOS = "SELECT ID_TURNO_HIJO FROM SDB_ACC_TURNO_DERIVADO WHERE ID_TURNO_PADRE = ? AND NVL(INDICADOR_VINCULADO, 'N') <> 'S'";

	/** Constante cs_TURNOS_DERIVADOS_CON_INDICADOR_VINCULADO. */
	private static final String cs_TURNOS_DERIVADOS_CON_INDICADOR_VINCULADO = " SELECT ID_TURNO_HIJO FROM SDB_ACC_TURNO_DERIVADO WHERE ID_TURNO_PADRE = ? AND INDICADOR_VINCULADO = 'S'";

	/** Constante cs_TURNOS_DERIVADOS_VINCULACION. */
	private static final String cs_TURNOS_DERIVADOS_VINCULACION = " SELECT TD.ID_TURNO_HIJO,TD.ID_PROCESO_HIJO FROM SDB_ACC_TURNO_DERIVADO  TD INNER JOIN SDB_ACC_TURNO T ON T.ID_TURNO = TD.ID_TURNO_PADRE"
		+ " INNER JOIN SDB_ACC_SOLICITUD S ON T.ID_SOLICITUD = S.ID_SOLICITUD ";

	/** Constante cs_ID_DOCUMENTOS. */
	private static final String cs_ID_DOCUMENTOS = "  SELECT ID_IMAGEN FROM   SDB_ACC_DOCUMENTOS_SALIDA WHERE ID_TURNO = ? AND ESTADO = 'A'";

	/** Constante cs_FIND_ALL. */
	private static final String cs_FIND_ALL = " SELECT ID_MOTIVO,DESCRIPCION FROM SDB_PGN_MOTIVO_TRAMITE WHERE ID_ETAPA_ORIGEN = ? ";

	/** Constante cs_FIND_BY_ID_TURNO_ETAPA. */
	private static final String cs_FIND_BY_ID_TURNO_ETAPA = "SELECT * FROM SDB_ACC_TURNO_HISTORIA "
		+ " WHERE ID_TURNO = ? AND ID_ETAPA = ? ORDER BY FECHA_CREACION DESC";

	/** Constante cs_FIND_BY_ID_TURNO_ETAPA_ESTADO. */
	private static final String cs_FIND_BY_ID_TURNO_ETAPA_ESTADO = "SELECT * FROM SDB_ACC_TURNO_HISTORIA "
		+ " WHERE ID_TURNO = ? AND ID_ETAPA = ? AND ESTADO_ACTIVIDAD = ? ORDER BY FECHA_CREACION DESC";

	/** Constante cs_FIND_VALIDACION_SUSPENSION. */
	private static final String cs_FIND_VALIDACION_SUSPENSION = "SELECT * FROM SDB_ACC_TURNO_HISTORIA WHERE ID_TURNO_HISTORIA = ? AND MOTIVO_NO_TRAMITE LIKE '%SUSPENSION%'";

	/** Constante cs_FIND_BY_ID_TURNO_ETAPA_DIFF_ASG. */
	private static final String cs_FIND_BY_ID_TURNO_ETAPA_DIFF_ASG = "SELECT * FROM SDB_ACC_TURNO_HISTORIA  WHERE ID_TURNO = ? AND ID_ETAPA = ? AND ESTADO_ACTIVIDAD <> 'TER'";

	/** Constante CS_CANTIDAD_POR_ETAPA_BANDEJA. */
	private static final String CS_CANTIDAD_POR_ETAPA_BANDEJA = "SELECT TH.ID_ETAPA, COUNT(TH.ID_ETAPA) CANTIDAD FROM SDB_ACC_TURNO_HISTORIA TH WHERE TH.ESTADO_ACTIVIDAD IN ('ASG') AND TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? ";

	/** Constante cs_APROBADOR_ANTIGUO_SISTEMA. */
	private static final String cs_APROBADOR_ANTIGUO_SISTEMA = "SELECT TH.ID_TURNO_HISTORIA, TH.ID_TURNO, SOL.NIR, TH.MOTIVO, TH.MOTIVO_NO_TRAMITE, TH.OBSERVACIONES FROM ((SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO) INNER JOIN SDB_ACC_SOLICITUD SOL ON T.ID_SOLICITUD = SOL.ID_SOLICITUD) WHERE TH.ESTADO_ACTIVIDAD IN ('ASG') AND TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? ";

	/** Constante cs_FIND_COUNT_BY_USER_ETAPA_ESTADO. */
	private static final String cs_FIND_COUNT_BY_USER_ETAPA_ESTADO = "SELECT COUNT(ID_ETAPA) CANTIDAD FROM SDB_ACC_TURNO_HISTORIA WHERE ID_USUARIO = ? AND ID_ETAPA = ? AND ESTADO_ACTIVIDAD = ? ";

	/** Constante cs_FIND_COUNT_BY_ETAPA_ESTADO. */
	private static final String cs_FIND_COUNT_BY_ETAPA_ESTADO = "SELECT COUNT(ID_ETAPA) CANTIDAD FROM SDB_ACC_TURNO_HISTORIA WHERE ID_ETAPA = ? AND ESTADO_ACTIVIDAD = ? ";

	/** Constante cs_FIND_COUNT_BY_USER_ETAPA_ESTADO_TRAMITE. */
	private static final String cs_FIND_COUNT_BY_USER_ETAPA_ESTADO_TRAMITE = "SELECT COUNT(ID_ETAPA) CANTIDAD FROM SDB_ACC_TURNO_HISTORIA TH RIGHT JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO RIGHT JOIN SDB_ACC_PROCESO P ON TH.ID_PROCESO = P.ID_PROCESO RIGHT JOIN SDB_ACC_SOLICITUD S ON TH.ID_PROCESO = S.ID_PROCESO AND TH.ID_SOLICITUD = S.ID_SOLICITUD WHERE TH.ID_USUARIO = ? AND TH.ID_ETAPA = ? AND TH.ESTADO_ACTIVIDAD = ? AND TH.MOTIVO_NO_TRAMITE = ?";

	/** Constante cs_FIND_COUNT_BY_USER_ETAPA_ESTADO_TRAMITE_SUBPROCESO. */
	private static final String cs_FIND_COUNT_BY_USER_ETAPA_ESTADO_TRAMITE_SUBPROCESO = "SELECT COUNT(ID_ETAPA) CANTIDAD FROM SDB_ACC_TURNO_HISTORIA TH RIGHT JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO RIGHT JOIN SDB_ACC_PROCESO P ON TH.ID_PROCESO = P.ID_PROCESO RIGHT JOIN SDB_ACC_SOLICITUD S ON TH.ID_PROCESO = S.ID_PROCESO AND TH.ID_SOLICITUD = S.ID_SOLICITUD RIGHT JOIN SDB_ACC_SUBPROCESO SUB ON S.ID_PROCESO = SUB.ID_PROCESO AND S.ID_SUBPROCESO = SUB.ID_SUBPROCESO WHERE TH.ID_USUARIO = ? AND TH.ID_ETAPA = ? AND TH.ESTADO_ACTIVIDAD = ? AND SUB.NOMBRE = ?";

	/** Constante cs_FIND_BANDEJA_CUENTA_CUPO. */
	private static final String cs_FIND_BANDEJA_CUENTA_CUPO = "SELECT MT.DESCRIPCION, COUNT(NVL(MT.DESCRIPCION,'')) CANTIDAD, TH.ID_ETAPA, MT.ID_MOTIVO, TH.ID_SUBPROCESO FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO INNER JOIN SDB_ACC_SOLICITUD S ON T.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_TURNO_HISTORIA TH1 ON TH1.ID_TURNO_HISTORIA = TH.ID_ANTERIOR INNER JOIN SDB_ACC_SUBPROCESO SAS ON SAS.ID_PROCESO = T.ID_PROCESO AND SAS.ID_SUBPROCESO = T.ID_SUBPROCESO INNER JOIN SDB_PGN_MOTIVO_TRAMITE MT ON MT.ID_ETAPA_ORIGEN = TH1.ID_ETAPA AND T.ID_PROCESO = MT.ID_PROCESO AND T.ID_SUBPROCESO = MT.ID_SUBPROCESO WHERE TH.ID_ETAPA = 600 AND TH.ID_PROCESO = 60 AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') AND TH.ID_USUARIO = ? ";

	/** Constante cs_FIND_BANDEJA_DETALLE_CUENTA_CUPO. */
	private static final String cs_FIND_BANDEJA_DETALLE_CUENTA_CUPO = "SELECT S.NIR, T.ID_TURNO, (SAEE.ID_DOCUMENTO_TIPO || ' ' || SAEE.NUMERO_DOCUMENTO) DOCUMENTO, SAEE.NOMBRE, S.FECHA_CREACION, TH1.OBSERVACIONES, TH.ID_TURNO_HISTORIA FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO INNER JOIN SDB_ACC_SOLICITUD S ON T.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_TURNO_HISTORIA TH1 ON TH1.ID_TURNO_HISTORIA = TH.ID_ANTERIOR INNER JOIN SDB_ACC_SUBPROCESO SAS ON SAS.ID_PROCESO = T.ID_PROCESO AND SAS.ID_SUBPROCESO = T.ID_SUBPROCESO INNER JOIN SDB_PGN_MOTIVO_TRAMITE MT ON MT.ID_ETAPA_ORIGEN = TH1.ID_ETAPA AND T.ID_PROCESO = MT.ID_PROCESO AND T.ID_SUBPROCESO = MT.ID_SUBPROCESO LEFT JOIN SDB_ACC_MOD_CUENTA_CUPO MCC ON S.ID_SOLICITUD = MCC.ID_SOLICITUD INNER JOIN SDB_ACC_CUENTA_CUPO SACC ON (S.ID_SUBPROCESO = 1 AND SACC.ID_SOLICITUD = S.ID_SOLICITUD) OR (S.ID_SUBPROCESO IN (2,3) AND SACC.ID_SOLICITUD = MCC.ID_SOLICITUD_CREACION) INNER JOIN SDB_ACC_ENTIDAD_EXTERNA SAEE ON SAEE.ID_ENTIDAD_EXTERNA = SACC.ID_ENTIDAD_EXTERNA WHERE TH.ID_ETAPA = 600 AND TH.ID_PROCESO = 60 AND TH.ESTADO_ACTIVIDAD IN ( 'ASG', 'BLQ') AND S.ID_SUBPROCESO = ? AND TH.ID_USUARIO = ? ";

	/** Constante cs_FIND_ID_ANTERIOR. */
	private static final String cs_FIND_ID_ANTERIOR = "  SELECT ATH2.ID_ETAPA FROM SDB_ACC_TURNO_HISTORIA ATH1 , SDB_ACC_TURNO_HISTORIA ATH2 WHERE ATH1.ID_TURNO_HISTORIA = ? AND ATH2.ID_TURNO_HISTORIA = ATH1.ID_ANTERIOR";

	/** Constante cs_FIND_BY_TURNO_ETAPA_EST_ACT_DIF. */
	private static final String cs_FIND_BY_TURNO_ETAPA_EST_ACT_DIF = "SELECT * FROM SDB_ACC_TURNO_HISTORIA  WHERE ID_TURNO = ? AND ID_ETAPA = ? AND ESTADO_ACTIVIDAD <> ?";

	/** Constante cs_FIND_BY_DATA_JOB_GENERAR_DOCUMENTOS. */
	private static final String cs_FIND_BY_DATA_JOB_GENERAR_DOCUMENTOS = "SELECT TH.* FROM SDB_ACC_TURNO_HISTORIA TH  WHERE TH.ESTADO_ACTIVIDAD = 'AUT' ";

	/** Constante cs_FIND_BY_ETAPA_EST_ACT. */
	private static final String cs_FIND_BY_ETAPA_EST_ACT = "SELECT * FROM SDB_ACC_TURNO_HISTORIA WHERE ID_ETAPA = ? AND ESTADO_ACTIVIDAD = ?  ORDER BY FECHA_CREACION ASC ";

	/** Constante cs_FIND_BY_ETAPA_PROCESO_SUB_EST_ACT. */
	private static final String cs_FIND_BY_ETAPA_PROCESO_SUB_EST_ACT = "SELECT * FROM SDB_ACC_TURNO_HISTORIA TUA INNER JOIN SDB_ACC_SUBPROCESO S ON TUA.ID_SUBPROCESO = S.ID_SUBPROCESO INNER JOIN SDB_ACC_SOLICITUD SO ON TUA.ID_PROCESO = SO.ID_PROCESO AND TUA.ID_SOLICITUD = SO.ID_SOLICITUD WHERE TUA.ID_ETAPA = ? AND TUA.ESTADO_ACTIVIDAD = ? AND TUA.ID_PROCESO = ? AND S.NOMBRE = ? ";

	/** Constante cs_FIND_ALL_BY_ETAPA_USUARIO. */
	private static final String cs_FIND_ALL_BY_ETAPA_USUARIO = "SELECT TH.ID_TURNO_HISTORIA, T.ID_TURNO, SOL.NIR FROM SDB_ACC_TURNO T INNER JOIN SDB_ACC_TURNO_HISTORIA TH ON T.ID_TURNO = TH.ID_TURNO INNER JOIN SDB_ACC_SOLICITUD SOL ON T.ID_SOLICITUD = SOL.ID_SOLICITUD WHERE TH.ID_USUARIO = ? AND T.ID_ETAPA_ACTUAL = ? AND T.ID_CIRCULO = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') ORDER BY T.FECHA_CREACION ASC";

	/** Constante cs_BANDEJA_CALIFICACION_SUSPENDIDOS. */
	private static final String cs_BANDEJA_CALIFICACION_SUSPENDIDOS = "SELECT  MT.DESCRIPCION ,COUNT (NVL(MT.DESCRIPCION,''))CANTIDAD  ,"
		+ " TH.ID_ETAPA, MT.ID_MOTIVO,TH1.ID_ETAPA ETAPA_ANT  FROM SDB_ACC_TURNO_HISTORIA TH   INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO  "
		+ " INNER JOIN SDB_ACC_SOLICITUD S ON  T.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN  SDB_ACC_TURNO_HISTORIA TH1 ON TH1.ID_TURNO_HISTORIA = TH.ID_ANTERIOR "
		+ " INNER JOIN SDB_PGN_MOTIVO_TRAMITE MT ON MT.ID_ETAPA_ORIGEN = TH1.ID_ETAPA AND  MT.ID_MOTIVO = NVL(TH1.ID_MOTIVO,10 ) AND T.ID_PROCESO = MT.ID_PROCESO AND T.ID_SUBPROCESO = MT.ID_SUBPROCESO"
		+ " LEFT JOIN  SDB_ACC_SOLICITUD_ASOCIADA ASA ON ASA.ID_SOLICITUD = S.ID_SOLICITUD WHERE TH.ID_USUARIO = ?  AND TH.ESTADO_ACTIVIDAD IN ('AUT','BLQ') ";

	/** Constante cs_BANDEJA_CALIFICACION. */
	private static final String cs_BANDEJA_CALIFICACION = "SELECT MT.DESCRIPCION ,COUNT (NVL(MT.DESCRIPCION,''))CANTIDAD, TH.ID_ETAPA, MT.ID_MOTIVO,CASE WHEN TH1.ID_ETAPA = 15 OR TH1.ID_ETAPA = 20 OR TH1.ID_ETAPA = 18 THEN 10 ELSE TH1.ID_ETAPA END ETAPA_ANT FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO INNER JOIN SDB_ACC_SOLICITUD S ON  T.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_TURNO_HISTORIA TH1 ON TH1.ID_TURNO_HISTORIA = TH.ID_ANTERIOR INNER JOIN SDB_ACC_SUBPROCESO SAS ON  SAS.ID_PROCESO = t.id_proceso AND SAS.ID_SUBPROCESO = T.ID_SUBPROCESO INNER JOIN SDB_PGN_MOTIVO_TRAMITE MT ON MT.ID_ETAPA_ORIGEN = TH1.ID_ETAPA AND T.ID_PROCESO = MT.ID_PROCESO AND MT.ID_ETAPA_POSTERIOR NOT IN ('15','20','22') AND T.ID_SUBPROCESO = MT.ID_SUBPROCESO AND MT.ID_MOTIVO = NVL(TH1.ID_MOTIVO,10 ) LEFT JOIN (SELECT ID_SOLICITUD, SUM(CASE WHEN NVL(INDICADOR_VINCULADO,'N') = 'S' THEN 1 ELSE 0  END) SI, SUM(CASE WHEN NVL(INDICADOR_VINCULADO,'N') IN ('N','A') THEN 1 ELSE 0  END) NO FROM SDB_ACC_SOLICITUD_ASOCIADA ASA GROUP BY ID_SOLICITUD ) ASOCIADA ON  S.ID_SOLICITUD = ASOCIADA.ID_SOLICITUD WHERE TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ')";

	/** Constante cs_BANDEJA_CALIFICACION SIN USUARIO. */
	private static final String cs_BANDEJA_CALIFICACION_SIN_USUARIO = "SELECT MT.DESCRIPCION ,COUNT (NVL(MT.DESCRIPCION,''))CANTIDAD, TH.ID_ETAPA, MT.ID_MOTIVO,CASE WHEN TH1.ID_ETAPA = 15 OR TH1.ID_ETAPA = 20 OR TH1.ID_ETAPA = 18 THEN 10 ELSE TH1.ID_ETAPA END ETAPA_ANT FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO INNER JOIN SDB_ACC_SOLICITUD S ON  T.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_TURNO_HISTORIA TH1 ON TH1.ID_TURNO_HISTORIA = TH.ID_ANTERIOR INNER JOIN SDB_ACC_SUBPROCESO SAS ON  SAS.ID_PROCESO = t.id_proceso AND SAS.ID_SUBPROCESO = T.ID_SUBPROCESO INNER JOIN SDB_PGN_MOTIVO_TRAMITE MT ON MT.ID_ETAPA_ORIGEN = TH1.ID_ETAPA AND T.ID_PROCESO = MT.ID_PROCESO AND MT.ID_ETAPA_POSTERIOR NOT IN ('15','20','22') AND T.ID_SUBPROCESO = MT.ID_SUBPROCESO AND MT.ID_MOTIVO = NVL(TH1.ID_MOTIVO,10 ) LEFT JOIN (SELECT ID_SOLICITUD, SUM(CASE WHEN NVL(INDICADOR_VINCULADO,'N') = 'S' THEN 1 ELSE 0  END) SI, SUM(CASE WHEN NVL(INDICADOR_VINCULADO,'N') IN ('N','A') THEN 1 ELSE 0  END) NO FROM SDB_ACC_SOLICITUD_ASOCIADA ASA GROUP BY ID_SOLICITUD ) ASOCIADA ON  S.ID_SOLICITUD = ASOCIADA.ID_SOLICITUD WHERE TH.ID_ETAPA = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ')";

	/** Constante cs_BANDEJA_CALIFICACION_VINCULACIONES. */
	private static final String cs_BANDEJA_CALIFICACION_VINCULACIONES = " SELECT MT.DESCRIPCION , COUNT (NVL(MT.DESCRIPCION,''))CANTIDAD ,"
		+ " TH.ID_ETAPA, MT.ID_MOTIVO,TH1.ID_ETAPA ETAPA_ANT,AP.NOMBRE PROCESO FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO "
		+ " INNER JOIN SDB_ACC_SOLICITUD S ON T.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_TURNO_HISTORIA TH1 ON TH1.ID_TURNO_HISTORIA = TH.ID_ANTERIOR "
		+ " INNER JOIN SDB_PGN_MOTIVO_TRAMITE MT ON MT.ID_ETAPA_ORIGEN = TH1.ID_ETAPA AND MT.ID_MOTIVO = NVL(TH1.ID_MOTIVO,10) AND T.ID_PROCESO = MT.ID_PROCESO AND T.ID_SUBPROCESO = MT.ID_SUBPROCESO"
		+ " INNER JOIN  SDB_ACC_SOLICITUD_ASOCIADA ASA ON ASA.ID_SOLICITUD = S.ID_SOLICITUD AND ASA.INDICADOR_VINCULADO = 'S'"
		+ " INNER JOIN SDB_ACC_PROCESO AP ON AP.ID_PROCESO = S.ID_PROCESO INNER JOIN SDB_ACC_SUBPROCESO ASP ON ASP.ID_PROCESO = S.ID_PROCESO AND ASP.ID_SUBPROCESO = S.ID_SUBPROCESO"
		+ "  WHERE TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ')  ";

	/** Constante cs_BANDEJA_CALIFICACION_PROHIBICIONES. */
	private static final String cs_BANDEJA_CALIFICACION_PROHIBICIONES = "SELECT MT.DESCRIPCION , COUNT (NVL(MT.DESCRIPCION,''))CANTIDAD ,\r\n"
		+ "        TH.ID_ETAPA, MT.ID_MOTIVO,TH1.ID_ETAPA ETAPA_ANT,AP.NOMBRE PROCESO FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO \r\n"
		+ "        INNER JOIN SDB_ACC_SOLICITUD S ON T.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_TURNO_HISTORIA TH1 ON TH1.ID_TURNO_HISTORIA = TH.ID_ANTERIOR \r\n"
		+ "        INNER JOIN SDB_PGN_MOTIVO_TRAMITE MT ON MT.ID_ETAPA_ORIGEN = TH1.ID_ETAPA AND MT.ID_MOTIVO = NVL(TH1.ID_MOTIVO,20) AND T.ID_PROCESO = MT.ID_PROCESO AND T.ID_SUBPROCESO = MT.ID_SUBPROCESO\r\n"
		+ "        INNER JOIN  SDB_ACC_ACTO ASA ON ASA.ID_SOLICITUD = S.ID_SOLICITUD AND ASA.ID_TIPO_ACTO = '0463'"
		+ "        INNER JOIN SDB_ACC_PROCESO AP ON AP.ID_PROCESO = S.ID_PROCESO INNER JOIN SDB_ACC_SUBPROCESO ASP ON ASP.ID_PROCESO = S.ID_PROCESO AND ASP.ID_SUBPROCESO = S.ID_SUBPROCESO\r\n"
		+ "        WHERE TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ')  ";

	/** Constante cs_FROM_WHERE_CALIFICACION_RECEPCION_DOCUMENTOS. */
	private static final String cs_FROM_WHERE_CALIFICACION_RECEPCION_DOCUMENTOS = " FROM SDB_ACC_SOLICITUD_ASOCIADA ACS INNER JOIN SDB_ACC_SOLICITUD ASA ON ASA.ID_SOLICITUD = ACS.ID_SOLICITUD1 "
		+ " INNER JOIN SDB_ACC_PROCESO AP ON AP.ID_PROCESO = ASA .ID_PROCESO "
		+ " INNER JOIN SDB_ACC_SUBPROCESO ASP ON ASP.ID_PROCESO = ASA .ID_PROCESO AND ASP.ID_SUBPROCESO = ASA.ID_SUBPROCESO "
		+ " INNER JOIN SDB_ACC_SOLICITUD S1 ON S1.ID_SOLICITUD = ACS.ID_SOLICITUD "
		+ " INNER JOIN SDB_ACC_TURNO_HISTORIA TH ON TH.ID_SOLICITUD = S1.ID_SOLICITUD "
		+ " INNER JOIN SDB_ACC_TURNO_HISTORIA TH1 ON TH1.ID_TURNO_HISTORIA = TH.ID_ANTERIOR "
		+ " INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO "
		+ " INNER JOIN SDB_PGN_MOTIVO_TRAMITE MT ON MT.ID_ETAPA_ORIGEN = TH1.ID_ETAPA AND MT.ID_MOTIVO = NVL(TH1.ID_MOTIVO,10) "
		+ " AND MT.ID_ETAPA_POSTERIOR NOT IN ('15','20','22') AND T.ID_PROCESO = MT.ID_PROCESO "
		+ " AND T.ID_SUBPROCESO = MT.ID_SUBPROCESO WHERE TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? "
		+ " AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') AND MT.ID_MOTIVO = ? ";

	/** Constante cs_BANDEJA_CALIFICACION_RECEPCION_DOCUMENTOS. */
	private static final String cs_BANDEJA_CALIFICACION_RECEPCION_DOCUMENTOS = "SELECT MT.DESCRIPCION DESCRIPCION, AP.NOMBRE NOMBRE_PROCESO, AP.ID_PROCESO, "
		+ " ASP.NOMBRE NOMBRE_SUBPROCESO, ASP.ID_SUBPROCESO, TH.ID_ETAPA ID_ETAPA, MT.ID_MOTIVO ID_MOTIVO_ANT, COUNT(*) CANTIDAD "
		+ cs_FROM_WHERE_CALIFICACION_RECEPCION_DOCUMENTOS;

	/** Constante cs_BANDEJA_DETALLE_CALIFICACION_RECEPCION_DOCUMENTOS. */
	private static final String cs_BANDEJA_DETALLE_CALIFICACION_RECEPCION_DOCUMENTOS = "SELECT AP.ID_PROCESO ID_PROCESO, ASP.ID_SUBPROCESO ID_SUBPROCESO, AP.NOMBRE NOMBRE_PROCESO, ASP.NOMBRE NOMBRE_SUBPROCESO,"
		+ " TH.ID_ETAPA, TH.ESTADO_ACTIVIDAD, TH.ID_TURNO_HISTORIA, AP.NOMBRE PROCESO, TH.ID_TURNO, S1.NIR, TH1.MOTIVO_NO_TRAMITE, TH.MOTIVO, "
		+ " TH.OBSERVACIONES, TH.ID_PROCESO " + cs_FROM_WHERE_CALIFICACION_RECEPCION_DOCUMENTOS;

	/** Constante cs_DETALLE_BANDEJA_CALIFICACION. */
	private static final String cs_DETALLE_BANDEJA_CALIFICACION = " SELECT AP.ID_PROCESO ID_PROCESO, ASP.ID_SUBPROCESO ID_SUBPROCESO, AP.NOMBRE NOMBRE_PROCESO,ASP.NOMBRE NOMBRE_SUBPROCESO,TH.ID_ETAPA,TH.ESTADO_ACTIVIDAD, TH.ID_TURNO_HISTORIA,AP.NOMBRE PROCESO,TH.ID_TURNO,S.NIR,TH1.MOTIVO_NO_TRAMITE "
		+ "  ,TH.MOTIVO, TH.OBSERVACIONES,TH.ID_PROCESO  FROM   SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO  INNER JOIN SDB_ACC_SOLICITUD S ON  T.ID_SOLICITUD = S.ID_SOLICITUD "
		+ "   INNER JOIN  SDB_ACC_TURNO_HISTORIA TH1 ON TH1.ID_TURNO_HISTORIA = TH.ID_ANTERIOR "
		+ "   INNER JOIN SDB_PGN_MOTIVO_TRAMITE MT ON MT.ID_ETAPA_ORIGEN = TH1.ID_ETAPA AND MT.ID_MOTIVO = NVL(TH1.ID_MOTIVO,10) AND MT.ID_ETAPA_POSTERIOR NOT IN ('15','20','22') AND T.ID_PROCESO = MT.ID_PROCESO AND T.ID_SUBPROCESO = MT.ID_SUBPROCESO"
		+ "   INNER JOIN SDB_ACC_PROCESO AP ON AP.ID_PROCESO = S.ID_PROCESO  INNER JOIN SDB_ACC_SUBPROCESO ASP ON ASP.ID_PROCESO = AP.ID_PROCESO  AND ASP.ID_SUBPROCESO = S.ID_SUBPROCESO  ";

	/** Constante cs_BANDEJA_ANALISTA_CERTIFICADOS_ESPECIALES. */
	private static final String cs_BANDEJA_ANALISTA_CERTIFICADOS_ESPECIALES = "SELECT ASP.NOMBRE NOMBRE_SUBPROCESO, ASP.ID_SUBPROCESO,ASP.ID_PROCESO, COUNT (NVL(ASP.NOMBRE,''))CANTIDAD FROM SDB_ACC_TURNO_HISTORIA "
		+ "TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO INNER JOIN SDB_ACC_SOLICITUD S ON T.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_PROCESO P ON S.ID_PROCESO = P.ID_PROCESO INNER JOIN SDB_ACC_PROCESO AP "
		+ "ON AP.ID_PROCESO = S.ID_PROCESO INNER JOIN SDB_ACC_SUBPROCESO ASP ON ASP.ID_PROCESO = AP.ID_PROCESO AND ASP.ID_SUBPROCESO = S.ID_SUBPROCESO WHERE TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? AND TH.ESTADO_ACTIVIDAD = 'ASG' ";

	/** Constante cs_DETALLE_ANALISTA_CERTIFICADOS_ESPECIALES. */
	private static final String cs_DETALLE_ANALISTA_CERTIFICADOS_ESPECIALES = "SELECT T.ID_TURNO, T.FECHA_CREACION, S.NIR, P.NOMBRE, TH.FECHA_REPARTO,ASP.ID_PROCESO, ASP.NOMBRE NOMBRE_SUBPROCESO, ASP.ID_SUBPROCESO , TH.ID_TURNO_HISTORIA FROM SDB_ACC_TURNO_HISTORIA "
		+ "TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO INNER JOIN SDB_ACC_SOLICITUD S ON T.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_PROCESO P ON S.ID_PROCESO = P.ID_PROCESO INNER JOIN SDB_ACC_PROCESO AP "
		+ "ON AP.ID_PROCESO = S.ID_PROCESO INNER JOIN SDB_ACC_SUBPROCESO ASP ON ASP.ID_PROCESO = AP.ID_PROCESO AND ASP.ID_SUBPROCESO = S.ID_SUBPROCESO WHERE TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? AND TH.ESTADO_ACTIVIDAD = 'ASG' "
		+ "AND AP.ID_PROCESO = ? AND ASP.ID_SUBPROCESO = ?";

	/** Constante cs_BANDEJA_IMPRESION_DOCUMENTOS_CORRESPONDENCIA. */
	private static final String cs_BANDEJA_IMPRESION_DOCUMENTOS_CORRESPONDENCIA = "SELECT E.NOMBRE, E.ID_ETAPA, COUNT (NVL(E.NOMBRE,''))CANTIDAD FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO INNER JOIN SDB_ACC_SOLICITUD S ON T.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_PROCESO P ON S.ID_PROCESO = P.ID_PROCESO INNER JOIN SDB_ACC_PROCESO AP ON AP.ID_PROCESO = S.ID_PROCESO INNER JOIN SDB_ACC_SUBPROCESO ASP ON ASP.ID_PROCESO = AP.ID_PROCESO AND ASP.ID_SUBPROCESO = S.ID_SUBPROCESO INNER JOIN SDB_PGN_ETAPA E ON TH.ID_ETAPA = E.ID_ETAPA WHERE TH.ID_ETAPA = ? AND TH.ESTADO_ACTIVIDAD = 'ASG' ";

	/** Constante cs_BANDEJA_NOTIFICACION_PERSONAL_ORIP. */
	private static final String cs_BANDEJA_NOTIFICACION_PERSONAL_ORIP = "SELECT E.NOMBRE, E.ID_ETAPA, COUNT (NVL(E.NOMBRE,''))CANTIDAD FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO INNER JOIN SDB_ACC_SOLICITUD S ON T.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_PROCESO P ON S.ID_PROCESO = P.ID_PROCESO INNER JOIN SDB_ACC_PROCESO AP ON AP.ID_PROCESO = S.ID_PROCESO INNER JOIN SDB_ACC_SUBPROCESO ASP ON ASP.ID_PROCESO = AP.ID_PROCESO AND ASP.ID_SUBPROCESO = S.ID_SUBPROCESO INNER JOIN SDB_PGN_ETAPA E ON TH.ID_ETAPA = E.ID_ETAPA WHERE TH.ESTADO_ACTIVIDAD <> 'TER' AND TH.ID_ETAPA IN ( ";

	/** Constante cs_DETALLE_TURNO_DESESTIMIENTO. */
	private static final String cs_DETALLE_TURNO_DESESTIMIENTO = "SELECT TH.* FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN  SDB_ACC_TURNO_HISTORIA TH1 ON TH1.ID_TURNO_HISTORIA = TH.ID_ANTERIOR INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO INNER JOIN SDB_PGN_MOTIVO_TRAMITE MT ON MT.ID_ETAPA_ORIGEN = TH1.ID_ETAPA AND MT.ID_MOTIVO = NVL(TH1.ID_MOTIVO,10) AND T.ID_PROCESO = MT.ID_PROCESO AND T.ID_SUBPROCESO = MT.ID_SUBPROCESO WHERE TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') AND MT.ID_MOTIVO  = ? AND TH1.ID_ETAPA = ? ORDER BY 1 DESC";

	/** Constante cs_FIND_BY_ID_TURNO_ETAPA_FOR_MOTIVO. */
	private static final String cs_FIND_BY_ID_TURNO_ETAPA_FOR_MOTIVO = "SELECT * FROM SDB_ACC_TURNO_HISTORIA WHERE ID_TURNO = ? AND ID_ETAPA = 80 ORDER BY FECHA_CREACION DESC FETCH FIRST 1 ROW ONLY";

	/** Constante cs_FIND_LAST_IN_TER. */
	private static final String cs_FIND_LAST_IN_TER = "SELECT * FROM SDB_ACC_TURNO_HISTORIA WHERE ID_TURNO = ? AND ESTADO_ACTIVIDAD = 'TER' AND MOTIVO LIKE '%REASIGNACION%' ORDER BY 1 DESC FETCH FIRST 1 ROW ONLY";

	/** Constante cs_FIND_BY_TURNO. */
	private static final String cs_FIND_BY_TURNO = "SELECT * FROM SDB_ACC_TURNO_HISTORIA WHERE ID_TURNO = ? ORDER BY ID_TURNO_HISTORIA DESC FETCH FIRST 1 ROW ONLY";

	/** Constante cs_DETALLE_BANDEJA_DIGITALIZACION. */
	private static final String cs_DETALLE_BANDEJA_DIGITALIZACION = "SELECT P.NOMBRE NOMBRE_PROCESO,ASP.NOMBRE NOMBRE_SUBPROCESO,TH.ID_ETAPA,TH.ESTADO_ACTIVIDAD, "
		+ " TH.ID_TURNO_HISTORIA,P.NOMBRE PROCESO,TH.ID_TURNO,S.NIR,TH.MOTIVO, TH.OBSERVACIONES,TH.ID_PROCESO  "
		+ " FROM   SDB_ACC_TURNO_HISTORIA TH LEFT JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO  "
		+ " INNER JOIN SDB_ACC_SOLICITUD S ON  TH.ID_SOLICITUD = S.ID_SOLICITUD  "
		+ " INNER JOIN SDB_ACC_PROCESO P ON S.ID_PROCESO = P.ID_PROCESO  "
		+ " INNER JOIN SDB_ACC_SUBPROCESO ASP ON ASP.ID_PROCESO = P.ID_PROCESO  AND ASP.ID_SUBPROCESO = S.ID_SUBPROCESO WHERE ";

	/** Constante cs_UPDATE_CALIFICACION. */
	private static final String cs_UPDATE_CALIFICACION = "UPDATE SDB_ACC_TURNO_HISTORIA SET CALIFICACION = ?, "
		+ "ID_USUARIO_MODIFICACION = ?, FECHA_MODIFICACION = SYSTIMESTAMP, IP_MODIFICACION = ? WHERE ID_TURNO_HISTORIA = ?";

	/** Constante cs_UPDATE_ID_DOCUMENTO_SALIDA. */
	private static final String cs_UPDATE_ID_DOCUMENTO_SALIDA = "UPDATE SDB_ACC_TURNO_HISTORIA SET ID_DOCUMENTO_SALIDA = ?, "
		+ "ID_USUARIO_MODIFICACION = ?, FECHA_MODIFICACION = SYSTIMESTAMP, IP_MODIFICACION = ? WHERE ID_TURNO_HISTORIA = ?";

	/** Constante cs_UPDATE_ESTADO_ACTIVIDAD. */
	private static final String cs_UPDATE_ESTADO_ACTIVIDAD = "UPDATE SDB_ACC_TURNO_HISTORIA SET ESTADO_ACTIVIDAD = ?, "
		+ "ID_USUARIO_MODIFICACION = ?, FECHA_MODIFICACION = SYSTIMESTAMP, IP_MODIFICACION = ? WHERE ID_TURNO_HISTORIA = ?";

	/** Constante cs_UPDATE_INTENTO_ENVIOS. */
	private static final String cs_UPDATE_INTENTO_ENVIOS = "UPDATE SDB_ACC_TURNO_HISTORIA SET INTENTOS_FALLIDOS_EJECUCION_AUTOMATICA = ?, FECHA_INTENTO_EJECUCION_AUTOMATICA = SYSTIMESTAMP, FECHA_EXITO_EJECUCION_AUTOMATICA = ?, RESPUESTAS_EJECUCION_AUTOMATICA = ?, ID_USUARIO_MODIFICACION = ?, FECHA_MODIFICACION = SYSTIMESTAMP, IP_MODIFICACION = ? WHERE ID_TURNO_HISTORIA = ?";

	/** Constante cs_UPDATE_FECHA_RESPUESTA_MENSAJE. */
	private static final String cs_UPDATE_FECHA_RESPUESTA_MENSAJE = "UPDATE SDB_ACC_TURNO_HISTORIA SET ID_MENSAJE = ?, FECHA_RESPUESTA_MENSAJE = ?, "
		+ "ID_USUARIO_MODIFICACION = ?, FECHA_MODIFICACION = SYSTIMESTAMP, IP_MODIFICACION = ? WHERE ID_TURNO_HISTORIA = ?";

	/** Constante cs_BUSCAR_POR_ID_TURNO_ESTADO_ACTIVIDAD. */
	private static final String cs_BUSCAR_POR_ID_TURNO_ESTADO_ACTIVIDAD = "SELECT * FROM SDB_ACC_TURNO_HISTORIA WHERE ID_TURNO = ? "
		+ " AND ESTADO_ACTIVIDAD = ?";

	/**  Constante cs DETALLE TESTAMNENTOS. */
	private static final String cs_DETALLE_TESTAMENTOS = " SELECT T.ID_TURNO, T.FECHA_CREACION, S.NIR, P.NOMBRE, TH.FECHA_REPARTO,ASP.ID_PROCESO, ASP.NOMBRE NOMBRE_SUBPROCESO, ASP.ID_SUBPROCESO , TH.ID_TURNO_HISTORIA FROM SDB_ACC_TURNO_HISTORIA TH INNER JOIN SDB_ACC_TURNO T ON TH.ID_TURNO = T.ID_TURNO INNER JOIN SDB_ACC_SOLICITUD S ON T.ID_SOLICITUD = S.ID_SOLICITUD INNER JOIN SDB_ACC_PROCESO P ON S.ID_PROCESO = P.ID_PROCESO INNER JOIN SDB_ACC_PROCESO AP ON AP.ID_PROCESO = S.ID_PROCESO INNER JOIN SDB_ACC_SUBPROCESO ASP ON ASP.ID_PROCESO = AP.ID_PROCESO AND ASP.ID_SUBPROCESO = S.ID_SUBPROCESO WHERE TH.ID_ETAPA = ? AND TH.ID_USUARIO = ? AND TH.ESTADO_ACTIVIDAD = 'ASG' AND AP.ID_PROCESO = '6' AND ASP.ID_SUBPROCESO IN ('6','4')";

	/**  Constante cs DETALLE TESTAMNENTOS. */
	private static final String cs_FIND_COUNT_BY_TURNO_ETAPA_MOTIVO = "SELECT COUNT(0) FROM SDB_ACC_TURNO_HISTORIA WHERE ID_TURNO = ? AND ID_ETAPA = ? AND ESTADO_ACTIVIDAD = ? AND ID_MOTIVO = ?";

	/**  Constante cs_FIND_PROCESOS_BY_ID_ETAPA. */
	private static final String cs_FIND_PROCESOS_BY_ID_ETAPA = "SELECT DISTINCT(S.ID_PROCESO), P.NOMBRE FROM SDB_ACC_TURNO_HISTORIA TH, "
		+ " SDB_ACC_SOLICITUD S, SDB_ACC_PROCESO P WHERE S.ID_SOLICITUD = TH.ID_SOLICITUD AND "
		+ " S.ID_PROCESO = P.ID_PROCESO AND TH.ID_ETAPA = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ')";

	/**
	 * Instancia un nuevo objeto turno historia DAO.
	 */
	public TurnoHistoriaDAO()
	{
	}

	/**
	 * Retorna el valor de cantidad de turnos por bandeja.
	 *
	 * @param as_idTurno correspondiente al valor del tipo de objeto String
	 * @param as_idSolicitud correspondiente al valor del tipo de objeto String
	 * @param lhmpCriterios correspondiente al valor del tipo de objeto LinkedHashMap<Integer,Object>
	 * @return el valor de cantidad de turnos por bandeja
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public LinkedList<LinkedHashMap<String, Object>> getCantidadPorBandeja(
	    String as_idTurno, String as_idSolicitud, LinkedHashMap<Integer, Object> lhmpCriterios
	)
	    throws B2BException
	{
		LinkedList<LinkedHashMap<String, Object>> lllhmpRet = new LinkedList<LinkedHashMap<String, Object>>();
		PreparedStatement                         lps_ps;
		ResultSet                                 lrs_rs;
		StringBuilder                             lsb_sb;

		lps_ps                                              = null;
		lrs_rs                                              = null;
		lsb_sb                                              = new StringBuilder();

		try
		{
			lsb_sb = lsb_sb.append(CS_CANTIDAD_POR_ETAPA_BANDEJA);

			if(StringUtils.isValidString(as_idTurno))
			{
				lsb_sb = lsb_sb.append("AND TH.ID_TURNO = ? ");
				lhmpCriterios.put(new Integer(3), as_idTurno);

				if(StringUtils.isValidString(as_idSolicitud))
				{
					lsb_sb = lsb_sb.append("AND TH.ID_SOLICITUD = ? GROUP BY TH.ID_ETAPA ");
					lhmpCriterios.put(new Integer(4), as_idSolicitud);
				}
				else
					lsb_sb = lsb_sb.append("GROUP BY TH.ID_ETAPA ");
			}
			else
			{
				if(StringUtils.isValidString(as_idSolicitud))
				{
					lsb_sb = lsb_sb.append("AND TH.ID_SOLICITUD = ? GROUP BY TH.ID_ETAPA ");
					lhmpCriterios.put(new Integer(3), as_idSolicitud);
				}
				else
					lsb_sb = lsb_sb.append("GROUP BY TH.ID_ETAPA ");
			}

			lps_ps = getConnection().prepareStatement(lsb_sb.toString());

			for(Map.Entry<Integer, Object> criterios : lhmpCriterios.entrySet())
				lps_ps.setObject(NumericUtils.getInt(criterios.getKey()), criterios.getValue());

			lrs_rs = lps_ps.executeQuery();

			ResultSetMetaData md      = lrs_rs.getMetaData();
			int               columns = md.getColumnCount();

			while(lrs_rs.next())
			{
				LinkedHashMap<String, Object> row = new LinkedHashMap<String, Object>(columns);

				for(int i = 1; i <= columns; ++i)
					row.put(md.getColumnLabel(i), lrs_rs.getObject(i));

				lllhmpRet.add(row);
			}

			if(lllhmpRet.isEmpty())
				lllhmpRet = null;
		}
		catch(SQLException lse_e)
		{
			logError(this, "getCantidadPorBandeja", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lllhmpRet;
	}

	/**
	 * Actualizar renuncia terminos.
	 *
	 * @param at_parametros de at parametros
	 * @param as_userId de as user id
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public void actualizarRenunciaTerminos(TurnoHistoria at_parametros, String as_userId)
	    throws B2BException
	{
		if(at_parametros != null)
		{
			PreparedStatement lps_ps;

			lps_ps = null;

			try
			{
				int li_count;

				li_count     = 1;

				lps_ps = getConnection().prepareStatement(cs_UPDATE_RENUNCIA_TERMINOS);

				lps_ps.setString(li_count++, at_parametros.getRenunciaTerminos());
				lps_ps.setString(li_count++, as_userId);
				setLong(lps_ps, at_parametros.getIdTurnoHistoria(), li_count++);

				lps_ps.executeUpdate();
			}
			catch(SQLException lse_e)
			{
				logError(this, "actualizarInterviene", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lps_ps);
			}
		}
	}

	/**
	 * Retorna el valor del objeto de tipo Bandeja analista certificados especiales.
	 *
	 * @param atc_tc correspondiente al valor del tipo de objeto TramiteCantidad
	 * @param ab_detalle correspondiente al valor del tipo de objeto boolean
	 * @return devuelve el valor del objeto collection de TramiteCantidad
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TramiteCantidad> bandejaAnalistaCertificadosEspeciales(
	    TramiteCantidad atc_tc, boolean ab_detalle
	)
	    throws B2BException
	{
		Collection<TramiteCantidad> lctc_turnos;
		lctc_turnos = null;

		if(atc_tc != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_contador;
				String        ls_turno;
				String        ls_nir;
				boolean       lb_tieneTurno;
				boolean       lb_tieneNir;
				StringBuilder lsb_builder;

				li_contador       = 1;
				ls_turno          = atc_tc.getIdTurno();
				ls_nir            = atc_tc.getNir();
				lb_tieneTurno     = StringUtils.isValidString(ls_turno);
				lb_tieneNir       = StringUtils.isValidString(ls_nir);
				lsb_builder       = new StringBuilder();

				if(ab_detalle)
					lsb_builder.append(cs_DETALLE_ANALISTA_CERTIFICADOS_ESPECIALES);
				else
					lsb_builder.append(cs_BANDEJA_ANALISTA_CERTIFICADOS_ESPECIALES);

				if(lb_tieneTurno)
					lsb_builder.append("AND T.ID_TURNO = ? ");

				if(lb_tieneNir)
					lsb_builder.append("AND S.NIR = ? ");

				if(!ab_detalle)
					lsb_builder.append("GROUP BY ASP.NOMBRE,ASP.ID_SUBPROCESO,ASP.ID_PROCESO");

				lps_ps = getConnection().prepareStatement(lsb_builder.toString());
				setLong(lps_ps, atc_tc.getIdEtapa(), li_contador++);
				lps_ps.setString(li_contador++, atc_tc.getUsuario());

				if(ab_detalle)
				{
					lps_ps.setString(li_contador++, atc_tc.getIdProceso());
					lps_ps.setString(li_contador++, atc_tc.getIdSubProceso());
				}

				if(lb_tieneTurno)
					lps_ps.setString(li_contador++, ls_turno);

				if(lb_tieneNir)
					lps_ps.setString(li_contador++, ls_nir);

				lrs_rs     = lps_ps.executeQuery();

				lctc_turnos = new ArrayList<TramiteCantidad>();

				while(lrs_rs.next())
					lctc_turnos.add(getTramiteAnalistaCertificados(lrs_rs, ab_detalle));
			}
			catch(SQLException lse_e)
			{
				logError(this, "bandejaAnalistaCertificadosEspeciales", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}

			if(lctc_turnos.isEmpty())
				lctc_turnos = null;
		}

		return lctc_turnos;
	}

	/**
	 * Retorna el valor del objeto de tipo Bandeja calificacion.
	 *
	 * @param at_turno correspondiente al valor del tipo de objeto Turno
	 * @param al_idMotivo correspondiente al valor del tipo de objeto long
	 * @return devuelve el valor del objeto collection de TramiteCantidad
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TramiteCantidad> bandejaCalificacion(Turno at_turno, long al_idMotivo)
	    throws B2BException
	{
		Collection<TramiteCantidad> lcth_datos;

		lcth_datos = new ArrayList<TramiteCantidad>();

		if(at_turno != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				boolean       lb_bandejaDetalle;
				int           li_contador;
				StringBuilder lsb_query;
				String        ls_nir;
				String        ls_turno;
				long          ll_etapaAnterior;
				Long          ll_etapaActual;

				boolean lb_etapaAnterior10;
				boolean lb_etapaActual80;
				boolean lb_etapaConvertida;
				boolean lb_sinUsuario;
				boolean lb_130;
				boolean lb_correccionesInternasExternas;

				lb_bandejaDetalle     = al_idMotivo > 0;
				li_contador           = 1;
				ls_nir                = at_turno.getNir();
				ls_turno              = at_turno.getIdTurno();
				ll_etapaAnterior      = at_turno.getIdEtapaAnt();
				ll_etapaActual        = at_turno.getIdEtapaActual();
				lb_sinUsuario         = false;

				lb_etapaAnterior10                  = ll_etapaAnterior == 10;
				lb_etapaActual80                    = NumericUtils.isValidLong(ll_etapaActual)
						&& (ll_etapaActual.compareTo(NumericUtils.getLongWrapper(80L)) == 0L);
				lb_etapaConvertida                  = (lb_etapaAnterior10 && lb_etapaActual80);
				lb_130                              = NumericUtils.isValidLong(ll_etapaActual)
						&& (ll_etapaActual.longValue() == EtapaCommon.ID_ETAPA_CORRECCIONES);
				lb_correccionesInternasExternas     = lb_130 && lb_etapaAnterior10;

				if(ll_etapaActual.compareTo(NumericUtils.getLongWrapper(236L)) == 0L)
					lb_sinUsuario = true;

				if(lb_sinUsuario)
					lsb_query = new StringBuilder(
						    lb_bandejaDetalle ? cs_DETALLE_BANDEJA_CALIFICACION : cs_BANDEJA_CALIFICACION_SIN_USUARIO
						);
				else
					lsb_query = new StringBuilder(
						    lb_bandejaDetalle ? cs_DETALLE_BANDEJA_CALIFICACION : cs_BANDEJA_CALIFICACION
						);

				if(lb_bandejaDetalle)
				{
					lsb_query.append(
					    " LEFT JOIN (SELECT ID_SOLICITUD, SUM(CASE WHEN NVL(INDICADOR_VINCULADO,'N') = 'S' THEN 1 ELSE 0  END) SI, "
					);
					lsb_query.append(
					    " SUM(CASE WHEN NVL(INDICADOR_VINCULADO,'N') IN ('N','A') THEN 1 ELSE 0  END) NO "
					);
					lsb_query.append(" FROM SDB_ACC_SOLICITUD_ASOCIADA ASA GROUP BY ID_SOLICITUD ) ASOCIADA ");
					lsb_query.append(" ON  S.ID_SOLICITUD = ASOCIADA.ID_SOLICITUD ");

					if(lb_sinUsuario)
						lsb_query.append(" WHERE TH.ID_ETAPA = ? AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') ");
					else
						lsb_query.append(
						    " WHERE TH.ID_ETAPA = ?  AND TH.ID_USUARIO = ?  AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') "
						);

					lsb_query.append(" AND TH1.ID_MOTIVO = ?");

					if(lb_correccionesInternasExternas)
						lsb_query.append(" AND TH1.ID_ETAPA IN (10,15,20,18) ");
					else if(lb_etapaConvertida)
						lsb_query.append(" AND TH1.ID_ETAPA IN (15,20,18) ");
					else
						lsb_query.append(" AND TH1.ID_ETAPA = ? ");
				}

				if(StringUtils.isValidString(ls_nir))
					lsb_query.append(" AND S.NIR = ? ");

				if(StringUtils.isValidString(ls_turno))
					lsb_query.append(" AND T.ID_TURNO = ?  ");

				lsb_query.append(" AND NVL(NO,1) >0 AND NVL(SI,0) = 0");

				if(!lb_bandejaDetalle)
					lsb_query.append(
					    " GROUP BY  MT.DESCRIPCION,TH.ID_ETAPA, MT.ID_MOTIVO, CASE WHEN TH1.ID_ETAPA = 15 OR TH1.ID_ETAPA = 20 OR TH1.ID_ETAPA = 18 THEN 10 ELSE TH1.ID_ETAPA END"
					);

				if(lb_bandejaDetalle)
					lsb_query.append(" ORDER BY T.FECHA_CREACION ASC");

				lps_ps = getConnection().prepareStatement(lsb_query.toString());

				setLong(lps_ps, ll_etapaActual, li_contador++);

				if(!lb_sinUsuario)
					lps_ps.setString(li_contador++, at_turno.getIdUsuarioCreacion());

				if(lb_bandejaDetalle)
				{
					lps_ps.setLong(li_contador++, al_idMotivo);

					if(!lb_etapaConvertida && !lb_correccionesInternasExternas)
						lps_ps.setLong(li_contador++, at_turno.getIdEtapaAnt());
				}

				if(StringUtils.isValidString(ls_nir))
					lps_ps.setString(li_contador++, ls_nir);

				if(StringUtils.isValidString(ls_turno))
					lps_ps.setString(li_contador++, ls_turno);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getTramiteEntidad(lrs_rs, lb_bandejaDetalle, false));
			}
			catch(SQLException lse_e)
			{
				logError(this, "bandejaCalificacion", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo Bandeja calificacion Recepción de documentos.
	 *
	 * @param at_turno correspondiente al valor del tipo de objeto Turno
	 * @param al_idMotivo correspondiente al valor del tipo de objeto long
	 * @return devuelve el valor del objeto collection de TramiteCantidad
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TramiteCantidad> bandejaCalificacionRecepcionDocumentos(Turno at_turno, long al_idMotivo)
	    throws B2BException
	{
		Collection<TramiteCantidad> lcth_datos;

		lcth_datos = new ArrayList<TramiteCantidad>();

		if(at_turno != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_contador;
				StringBuilder lsb_query;
				String        ls_nir;
				String        ls_turno;
				Long          ll_etapaActual;

				li_contador        = 1;
				ls_nir             = at_turno.getNir();
				ls_turno           = at_turno.getIdTurno();
				ll_etapaActual     = at_turno.getIdEtapaActual();

				lsb_query = new StringBuilder(cs_BANDEJA_CALIFICACION_RECEPCION_DOCUMENTOS);

				if(StringUtils.isValidString(ls_nir))
					lsb_query.append(" AND S1.NIR = ? ");

				if(StringUtils.isValidString(ls_turno))
					lsb_query.append(" AND T.ID_TURNO = ?  ");

				lsb_query.append(
				    " GROUP BY MT.DESCRIPCION, AP.NOMBRE, AP.ID_PROCESO, ASP.NOMBRE, ASP.ID_SUBPROCESO, TH.ID_ETAPA, MT.ID_MOTIVO"
				);

				lps_ps = getConnection().prepareStatement(lsb_query.toString());

				setLong(lps_ps, ll_etapaActual, li_contador++);
				lps_ps.setString(li_contador++, at_turno.getIdUsuarioCreacion());
				lps_ps.setLong(li_contador++, al_idMotivo);

				if(StringUtils.isValidString(ls_nir))
					lps_ps.setString(li_contador++, ls_nir);

				if(StringUtils.isValidString(ls_turno))
					lps_ps.setString(li_contador++, ls_turno);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getBandejaRecepcionDocumentos(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "bandejaCalificacionRecepcionDocumentos", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo Bandeja calificacion suspendidos.
	 *
	 * @param at_t correspondiente al valor del tipo de objeto Turno
	 * @param al_idMotivo correspondiente al valor del tipo de objeto long
	 * @return <code>Collection</code> llena con <code>TramiteCantidad</code>
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TramiteCantidad> bandejaCalificacionSuspendidos(Turno at_t, long al_idMotivo)
	    throws B2BException
	{
		Collection<TramiteCantidad> lcth_datos;

		lcth_datos = null;

		if(at_t != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				StringBuilder lsb_query;
				boolean       lb_idMotivoValido;
				boolean       lb_esAnalistaCertificados;
				int           li_contador;
				long          ll_idEtapaAnt;
				String        ls_nir;
				String        ls_turno;
				long          ll_etapaActual;

				lsb_query                     = new StringBuilder(cs_BANDEJA_CALIFICACION_SUSPENDIDOS);
				lb_idMotivoValido             = al_idMotivo > 0;
				li_contador                   = 1;
				ll_idEtapaAnt                 = at_t.getIdEtapaAnt();
				ls_nir                        = at_t.getNir();
				ls_turno                      = at_t.getIdTurno();
				ll_etapaActual                = NumericUtils.getLong(at_t.getIdEtapaActual());
				lb_esAnalistaCertificados     = ll_etapaActual == EtapaCommon.ID_ETAPA_ANALISTA_CERTIFICADOS_ESPECIALES;

				if(lb_idMotivoValido)
				{
					lsb_query = new StringBuilder(cs_DETALLE_BANDEJA_CALIFICACION);

					lsb_query.append(" LEFT JOIN SDB_ACC_SOLICITUD_ASOCIADA ASA ON ASA.ID_SOLICITUD = S.ID_SOLICITUD ");
					lsb_query.append(
					    " WHERE TH.ID_ETAPA IN ( "
					    + (((ll_etapaActual == EtapaCommon.ID_ETAPA_CALIFICACION)
						    || (ll_etapaActual == EtapaCommon.ID_ETAPA_CORRECCIONES)
						    || (ll_etapaActual == EtapaCommon.ID_ETAPA_RESPONSABLE_ACTUACIONES_ADMINISTRATIVAS))
					    ? "85,280,281,282" : "284,285,286,287")
					    + ")  AND TH.ID_USUARIO = ?  AND TH.ESTADO_ACTIVIDAD IN ('AUT') "
					);

					if((al_idMotivo == 10) && (ll_idEtapaAnt != EtapaCommon.ID_ETAPA_ENTREGA_NOTIFICACIO_A_ENTIDADES))
						lsb_query.append(" AND TH1.ID_MOTIVO IS NULL ");
					else
						lsb_query.append(" AND TH1.ID_MOTIVO = ? AND TH1.ID_ETAPA = ? ");

					lsb_query.append(" AND NVL(ASA.INDICADOR_VINCULADO,'N') != 'S'");
				}
				else
				{
					if(lb_esAnalistaCertificados)
						lsb_query.append("AND TH1.ID_ETAPA = 310 AND TH.ID_ETAPA IN (85) ");
					else
					{
						lsb_query.append(
						    "AND TH1.ID_ETAPA <> 310 AND TH.ID_ETAPA IN ("
						    + (((ll_etapaActual == EtapaCommon.ID_ETAPA_CALIFICACION)
							    || (ll_etapaActual == EtapaCommon.ID_ETAPA_CORRECCIONES)
							    || (ll_etapaActual == EtapaCommon.ID_ETAPA_RESPONSABLE_ACTUACIONES_ADMINISTRATIVAS))
						    ? "85,280,281,282,130" : "284,285,286,287")
						);

						if((ll_etapaActual == EtapaCommon.ID_ETAPA_CORRECCIONES))
							lsb_query.append(",284,285");

						lsb_query.append(") ");
					}

					if(ll_etapaActual == EtapaCommon.ID_ETAPA_CALIFICACION)
						lsb_query.append(" AND TH1.ID_ETAPA <> '130' AND TH1.ID_ETAPA <> '170' ");
					else if(ll_etapaActual == EtapaCommon.ID_ETAPA_CORRECCIONES)
						lsb_query.append(" AND TH1.ID_ETAPA <> '80' AND TH1.ID_ETAPA <> '170' ");
					else if(ll_etapaActual == EtapaCommon.ID_ETAPA_RESPONSABLE_ACTUACIONES_ADMINISTRATIVAS)
						lsb_query.append(" AND TH1.ID_ETAPA <> '80' AND TH1.ID_ETAPA <> '130' ");
				}

				if(StringUtils.isValidString(ls_nir))
					lsb_query.append(" AND S.NIR = ? ");

				if(StringUtils.isValidString(ls_turno))
					lsb_query.append(" AND T.ID_TURNO = ?  ");

				if(!lb_idMotivoValido)
				{
					lsb_query.append(" AND NVL(ASA.INDICADOR_VINCULADO,'N') != 'S'");
					lsb_query.append(" GROUP BY  MT.DESCRIPCION,TH.ID_ETAPA, MT.ID_MOTIVO, TH1.ID_ETAPA ");
				}

				if(lb_idMotivoValido)
					lsb_query.append(" ORDER BY T.FECHA_CREACION ASC");

				lps_ps = getConnection().prepareStatement(lsb_query.toString());

				lps_ps.setString(li_contador++, at_t.getIdUsuarioCreacion());

				if(
				    lb_idMotivoValido
					    && ((al_idMotivo != 10)
					    || (ll_idEtapaAnt == EtapaCommon.ID_ETAPA_ENTREGA_NOTIFICACIO_A_ENTIDADES))
				)
				{
					lps_ps.setLong(li_contador++, al_idMotivo);
					lps_ps.setLong(li_contador++, ll_idEtapaAnt);
				}

				if(StringUtils.isValidString(ls_nir))
					lps_ps.setString(li_contador++, ls_nir);

				if(StringUtils.isValidString(ls_turno))
					lps_ps.setString(li_contador++, ls_turno);

				lrs_rs     = lps_ps.executeQuery();

				lcth_datos = new ArrayList<TramiteCantidad>();

				while(lrs_rs.next())
					lcth_datos.add(getTramiteEntidad(lrs_rs, lb_idMotivoValido, false));
			}
			catch(SQLException lse_e)
			{
				logError(this, "bandejaCalificacionSuspendidos", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lcth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo Bandeja detalle calificacion Recepción de documentos.
	 *
	 * @param at_turno correspondiente al valor del tipo de objeto Turno
	 * @param al_idMotivo correspondiente al valor del tipo de objeto long
	 * @return devuelve el valor del objeto collection de TramiteCantidad
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TramiteCantidad> bandejaDetalleCalificacionRecepcionDocumentos(Turno at_turno, long al_idMotivo)
	    throws B2BException
	{
		Collection<TramiteCantidad> lcth_datos;

		lcth_datos = new ArrayList<TramiteCantidad>();

		if(at_turno != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				String ls_nir;
				String ls_turno;
				String ls_idProceso;
				String ls_idSubProceso;

				boolean lb_nir;
				boolean lb_turno;
				boolean lb_idProceso;
				boolean lb_idSubProceso;

				ls_nir              = at_turno.getNir();
				ls_turno            = at_turno.getIdTurno();
				ls_idProceso        = at_turno.getIdProceso();
				ls_idSubProceso     = at_turno.getIdSubProceso();

				lb_nir              = StringUtils.isValidString(ls_nir);
				lb_turno            = StringUtils.isValidString(ls_turno);
				lb_idProceso        = StringUtils.isValidString(ls_idProceso);
				lb_idSubProceso     = StringUtils.isValidString(ls_idSubProceso);

				{
					StringBuilder lsb_query;

					lsb_query = new StringBuilder(cs_BANDEJA_DETALLE_CALIFICACION_RECEPCION_DOCUMENTOS);

					if(lb_nir)
						lsb_query.append(" AND S1.NIR = ? ");

					if(lb_turno)
						lsb_query.append(" AND T.ID_TURNO = ? ");

					if(StringUtils.isValidString(ls_idProceso))
						lsb_query.append(" AND AP.ID_PROCESO = ? ");

					if(StringUtils.isValidString(ls_idSubProceso))
						lsb_query.append(" AND ASP.ID_SUBPROCESO = ? ");

					lsb_query.append(" ORDER BY T.FECHA_CREACION ASC ");

					lps_ps = getConnection().prepareStatement(lsb_query.toString());
				}

				{
					int li_contador;

					li_contador = 1;

					setLong(lps_ps, at_turno.getIdEtapaActual(), li_contador++);
					lps_ps.setString(li_contador++, at_turno.getIdUsuarioCreacion());
					lps_ps.setLong(li_contador++, al_idMotivo);

					if(lb_nir)
						lps_ps.setString(li_contador++, ls_nir);

					if(lb_turno)
						lps_ps.setString(li_contador++, ls_turno);

					if(lb_idProceso)
						lps_ps.setString(li_contador++, ls_idProceso);

					if(lb_idSubProceso)
						lps_ps.setString(li_contador++, ls_idSubProceso);
				}

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getTramiteEntidad(lrs_rs, true, false));
			}
			catch(SQLException lse_e)
			{
				logError(this, "bandejaDetalleCalificacionRecepcionDocumentos", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lps_ps);
				close(lrs_rs);
			}
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo Bandeja digitalizacion.
	 *
	 * @param al_etapa correspondiente al valor del tipo de objeto long
	 * @param as_turno correspondiente al valor del tipo de objeto String
	 * @param as_nir correspondiente al valor del tipo de objeto String
	 * @return devuelve el valor del objeto collection de TramiteCantidad
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TramiteCantidad> bandejaDigitalizacion(long al_etapa, String as_turno, String as_nir)
	    throws B2BException
	{
		Collection<TramiteCantidad> lctc_datos;
		PreparedStatement           lps_ps;
		ResultSet                   lrs_rs;
		StringBuilder               lsb_query;

		lctc_datos     = new ArrayList<TramiteCantidad>();
		lps_ps         = null;
		lrs_rs         = null;
		lsb_query      = new StringBuilder();

		try
		{
			int     li_contador;
			boolean lb_etapa;

			li_contador     = 1;
			lb_etapa        = al_etapa > 0;

			lsb_query.append(cs_DETALLE_BANDEJA_DIGITALIZACION);

			lsb_query.append(" 1 = 1 ");

			if(StringUtils.isValidString(as_turno))
				lsb_query.append(" AND T.ID_TURNO = ?");
			else if(StringUtils.isValidString(as_nir))
				lsb_query.append(" AND S.NIR = ?");

			if(!lb_etapa)
				lsb_query.append(" AND T.ID_TURNO IS NOT NULL AND TH.ID_ETAPA < 500");
			else
				lsb_query.append(" AND TH.ID_ETAPA = ? ");

			lsb_query.append(" AND TH.ESTADO_ACTIVIDAD = 'ASG' ORDER BY T.FECHA_CREACION ASC");

			lps_ps = getConnection().prepareStatement(lsb_query.toString());

			if(StringUtils.isValidString(as_turno))
				lps_ps.setString(li_contador++, as_turno);
			else if(StringUtils.isValidString(as_nir))
				lps_ps.setString(li_contador++, as_nir);

			if(lb_etapa)
				lps_ps.setLong(li_contador++, al_etapa);

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
				lctc_datos.add(getTramiteEntidadDigitalizacion(lrs_rs));
		}
		catch(SQLException lse_e)
		{
			logError(this, "bandejaCalificacion", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lctc_datos.isEmpty())
			lctc_datos = null;

		return lctc_datos;
	}

	/**
	 * Bandeja impresion documentos correspondencia.
	 *
	 * @param atc_tc de atc tc
	 * @return el valor de collection
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public Collection<TramiteCantidad> bandejaImpresionDocumentosCorrespondencia(TramiteCantidad atc_tc)
	    throws B2BException
	{
		Collection<TramiteCantidad> lctc_turnos;

		lctc_turnos = null;

		if(atc_tc != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_contador;
				String        ls_turno;
				String        ls_circulo;
				String        ls_nir;
				boolean       lb_tieneTurno;
				boolean       lb_tieneNir;
				StringBuilder lsb_builder;

				li_contador       = 1;
				ls_turno          = atc_tc.getIdTurno();
				ls_nir            = atc_tc.getNir();
				lb_tieneTurno     = StringUtils.isValidString(ls_turno);
				lb_tieneNir       = StringUtils.isValidString(ls_nir);
				lsb_builder       = new StringBuilder();
				ls_circulo        = atc_tc.getIdCirculo();

				lsb_builder.append(cs_BANDEJA_IMPRESION_DOCUMENTOS_CORRESPONDENCIA);

				if(lb_tieneTurno)
					lsb_builder.append("AND T.ID_TURNO = ? ");

				if(lb_tieneNir)
					lsb_builder.append("AND S.NIR = ? ");

				if(StringUtils.isValidString(ls_circulo))
					lsb_builder.append("AND T.ID_CIRCULO = ? ");

				lsb_builder.append("GROUP BY E.NOMBRE, E.ID_ETAPA");

				lps_ps = getConnection().prepareStatement(lsb_builder.toString());
				setLong(lps_ps, atc_tc.getIdEtapa(), li_contador++);

				if(lb_tieneTurno)
					lps_ps.setString(li_contador++, ls_turno);

				if(lb_tieneNir)
					lps_ps.setString(li_contador++, ls_nir);

				if(StringUtils.isValidString(ls_circulo))
					lps_ps.setString(li_contador++, ls_circulo);

				lrs_rs     = lps_ps.executeQuery();

				lctc_turnos = new ArrayList<TramiteCantidad>();

				while(lrs_rs.next())
					lctc_turnos.add(getTramiteImpresionDocumentosCorrespondencia(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "bandejaImpresionDocumentosCorrespondencia", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lctc_turnos;
	}

	/**
	 * Bandeja notificacion personal orip.
	 *
	 * @param atc_tc de atc tc
	 * @param asa_etapasNotificacion de asa etapas notificacion
	 * @return el valor de collection
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public Collection<TramiteCantidad> bandejaNotificacionPersonalOrip(
	    TramiteCantidad atc_tc, String[] asa_etapasNotificacion
	)
	    throws B2BException
	{
		Collection<TramiteCantidad> lctc_turnos;

		lctc_turnos = null;

		if((atc_tc != null) && CollectionUtils.isValidCollection(asa_etapasNotificacion))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_contador;
				String        ls_turno;
				String        ls_nir;
				boolean       lb_tieneTurno;
				boolean       lb_tieneNir;
				StringBuilder lsb_builder;

				li_contador       = 1;
				ls_turno          = atc_tc.getIdTurno();
				ls_nir            = atc_tc.getNir();
				lb_tieneTurno     = StringUtils.isValidString(ls_turno);
				lb_tieneNir       = StringUtils.isValidString(ls_nir);
				lsb_builder       = new StringBuilder();

				lsb_builder.append(cs_BANDEJA_NOTIFICACION_PERSONAL_ORIP);

				for(
				    int li_posicion = 0, li_tamanio = asa_etapasNotificacion.length; li_posicion < li_tamanio;
					    li_posicion++
				)
					lsb_builder.append(((li_posicion + 1) == li_tamanio) ? "?" : "?, ");

				lsb_builder.append(") AND S.ID_PROCESO <> '38' ");

				if(lb_tieneTurno)
					lsb_builder.append("AND T.ID_TURNO = ? ");

				if(lb_tieneNir)
					lsb_builder.append("AND S.NIR = ? ");

				lsb_builder.append("GROUP BY E.NOMBRE, E.ID_ETAPA");

				lps_ps = getConnection().prepareStatement(lsb_builder.toString());

				for(
				    int li_posicion = 0, li_tamanio = asa_etapasNotificacion.length; li_posicion < li_tamanio;
					    li_posicion++
				)
				{
					lps_ps.setString(li_posicion + 1, asa_etapasNotificacion[li_posicion]);
					li_contador++;
				}

				if(lb_tieneTurno)
					lps_ps.setString(li_contador++, ls_turno);

				if(lb_tieneNir)
					lps_ps.setString(li_contador++, ls_nir);

				lrs_rs     = lps_ps.executeQuery();

				lctc_turnos = new ArrayList<TramiteCantidad>();

				while(lrs_rs.next())
					lctc_turnos.add(getTramiteImpresionDocumentosCorrespondencia(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "bandejaImpresionDocumentosCorrespondencia", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lctc_turnos;
	}

	/**
	 * Retorna el valor del objeto de tipo Bandeja analista certificados especiales.
	 *
	 * @param atc_tc correspondiente al valor del tipo de objeto TramiteCantidad
	 * @param ab_detalle correspondiente al valor del tipo de objeto boolean
	 * @return devuelve el valor del objeto collection de TramiteCantidad
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TramiteCantidad> bandejaTestamentos(TramiteCantidad atc_tc, boolean ab_detalle)
	    throws B2BException
	{
		Collection<TramiteCantidad> lctc_turnos;
		lctc_turnos = null;

		if(atc_tc != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_contador;
				String        ls_turno;
				String        ls_nir;
				boolean       lb_tieneTurno;
				boolean       lb_tieneNir;
				StringBuilder lsb_builder;

				li_contador       = 1;
				ls_turno          = atc_tc.getIdTurno();
				ls_nir            = atc_tc.getNir();
				lb_tieneTurno     = StringUtils.isValidString(ls_turno);
				lb_tieneNir       = StringUtils.isValidString(ls_nir);
				lsb_builder       = new StringBuilder();

				if(ab_detalle)
					lsb_builder.append(cs_DETALLE_TESTAMENTOS);

				if(lb_tieneTurno)
					lsb_builder.append("AND T.ID_TURNO = ? ");

				if(lb_tieneNir)
					lsb_builder.append("AND S.NIR = ? ");

				lps_ps = getConnection().prepareStatement(lsb_builder.toString());
				setLong(lps_ps, atc_tc.getIdEtapa(), li_contador++);
				lps_ps.setString(li_contador++, atc_tc.getUsuario());

				if(lb_tieneTurno)
					lps_ps.setString(li_contador++, ls_turno);

				if(lb_tieneNir)
					lps_ps.setString(li_contador++, ls_nir);

				lrs_rs     = lps_ps.executeQuery();

				lctc_turnos = new ArrayList<TramiteCantidad>();

				while(lrs_rs.next())
					lctc_turnos.add(getTramiteAnalistaCertificados(lrs_rs, ab_detalle));
			}
			catch(SQLException lse_e)
			{
				logError(this, "bandejaTestamentos", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}

			if(lctc_turnos.isEmpty())
				lctc_turnos = null;
		}

		return lctc_turnos;
	}

	/**
	 * Consulta todos los registros que de el turno y en estado actividad enviado como argumento.
	 *
	 * @param as_isTurno Argumento de tipo <code>String</code> que contiene el id_turno a consultar.
	 * @param as_estadoActividad Argumento de tipo <code>String</code> que contiene el estado_actividad a consultar.
	 * @return Objeto de tipo TurnoHistoria producto de la consulta realizada.
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public TurnoHistoria buscarPorIdTurnoEstadoActividad(String as_isTurno, String as_estadoActividad)
	    throws B2BException
	{
		TurnoHistoria lth_datos;

		lth_datos = null;

		if(StringUtils.isValidString(as_isTurno) && StringUtils.isValidString(as_estadoActividad))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;
				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_BUSCAR_POR_ID_TURNO_ESTADO_ACTIVIDAD);

				lps_ps.setString(li_contador++, as_isTurno);
				lps_ps.setString(li_contador++, as_estadoActividad);

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					lth_datos = getTurnoHistoria(lrs_rs);
			}
			catch(SQLException lse_e)
			{
				logError(this, "buscarPorIdTurnoEstadoActividad", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo Detalle turnos desestimiento.
	 *
	 * @param ath_th correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see TurnoHistoria
	 */
	public TurnoHistoria detalleTurnosDesestimiento(TurnoHistoria ath_th)
	    throws B2BException
	{
		TurnoHistoria     lth_datos;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		lth_datos     = null;
		lps_ps        = null;
		lrs_rs        = null;

		if(ath_th != null)
		{
			try
			{
				int li_contador;
				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_DETALLE_TURNO_DESESTIMIENTO);

				lps_ps.setBigDecimal(li_contador++, ath_th.getIdEtapa());
				lps_ps.setString(li_contador++, ath_th.getIdUsuarioCreacion());
				setLong(lps_ps, ath_th.getIdMotivo(), li_contador++);
				lps_ps.setBigDecimal(li_contador++, ath_th.getIdAnterior());

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					lth_datos = getTurnoHistoria(lrs_rs);
			}
			catch(SQLException lse_e)
			{
				logError(this, "detalleTurnosDesestimiento", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lth_datos;
	}

	/**
	 * Etapa turno anterior.
	 *
	 * @param as_Idturno correspondiente al valor del tipo de objeto String
	 * @return verdadero, si se cumple la condicion, de lo contario retorna falso
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public boolean etapaTurnoAnterior(String as_Idturno)
	    throws B2BException
	{
		boolean           lb_b;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;
		int               ll_etapa;

		lps_ps       = null;
		lrs_rs       = null;
		lb_b         = false;
		ll_etapa     = 0;

		try
		{
			int li_contador;
			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(cs_FIND_ID_ANTERIOR);

			lps_ps.setString(li_contador++, as_Idturno);

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
			{
				ll_etapa = lrs_rs.getInt("ID_ETAPA");

				if((ll_etapa == 140) || (ll_etapa == 190))
					lb_b = true;
			}
		}
		catch(SQLException lse_e)
		{
			logError(this, "etapaTurnoAnterior", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lb_b;
	}

	/**
	 * Consulta todos los registros que esten en fase de entrega y en estado actividad asignado para un id turno.
	 *
	 * @param al_idEtapa de al id etapa
	 * @param al_cantidadIntentosMax de al cantidad intentos max
	 * @param ab_documentoEnviado de ab documento enviado
	 * @return Objeto de tipo TurnoHistoria producto de la consulta realizada
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TurnoHistoria> findAllByEtapaAut(
	    long al_idEtapa, long al_cantidadIntentosMax, boolean ab_documentoEnviado
	)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;

		lcth_datos = new LinkedList<TurnoHistoria>();

		if(al_idEtapa > 0)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_cont;
				StringBuilder lsb_query;

				li_cont       = 1;
				lsb_query     = new StringBuilder(cs_FIND_ALL_BY_ETAPA_AUT);

				if(ab_documentoEnviado)
					lsb_query.append(
					    " INNER JOIN SDB_ACC_DOCUMENTOS_SALIDA SADS ON SATH.ID_DOCUMENTO_SALIDA = SADS.ID_DOCUMENTO_SALIDA "
					);

				lsb_query.append(
				    " WHERE SATH.ID_ETAPA = ? AND SATH.ESTADO_ACTIVIDAD = 'AUT' AND NVL(SATH.INTENTOS_FALLIDOS_EJECUCION_AUTOMATICA, 0) < ? "
				);

				if(ab_documentoEnviado)
					lsb_query.append(
					    " AND SADS.ID_NOMBRE_DOCUMENTO IS NOT NULL AND SADS.ID_ECM IS NOT NULL AND SADS.FECHA_ENVIO IS NOT NULL "
					);

				lps_ps = getConnection().prepareStatement(lsb_query.toString());

				lps_ps.setLong(li_cont++, al_idEtapa);
				lps_ps.setLong(li_cont++, al_cantidadIntentosMax);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getTurnoHistoria(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findAllByEtapaAut", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo Collection de ReasignarTurnos.
	 *
	 * @param al_etapa correspondiente al valor del tipo de objeto long
	 * @param as_idCirculo correspondiente al valor del tipo de objeto String
	 * @param as_idUsuario correspondiente al valor del tipo de objeto String
	 * @param ab_porCantidad correspondiente al valor del tipo de objeto boolean
	 * @param ai_cantidad correspondiente al valor del tipo de objeto Integer
	 * @return devuelve el valor del objeto collection de ReasignarTurnos
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see ReasignarTurnos
	 */
	public Collection<ReasignarTurnos> findAllByEtapaUsuario(
	    long al_etapa, String as_idCirculo, String as_idUsuario, boolean ab_porCantidad, Integer ai_cantidad
	)
	    throws B2BException
	{
		Collection<ReasignarTurnos> lcth_datos;
		PreparedStatement           lps_ps;
		ResultSet                   lrs_rs;
		lcth_datos     = new ArrayList<ReasignarTurnos>();

		lps_ps     = null;
		lrs_rs     = null;

		try
		{
			int           li_contador;
			StringBuilder lsb_sb;
			int           ls_idOrdenTurno;

			lsb_sb              = new StringBuilder();
			li_contador         = 1;
			ls_idOrdenTurno     = 0;

			lsb_sb.append(cs_FIND_ALL_BY_ETAPA_USUARIO);

			if(ab_porCantidad)
				lsb_sb.append(" FETCH FIRST ? ROWS ONLY");

			lps_ps = getConnection().prepareStatement(StringUtils.getString(lsb_sb));

			lps_ps.setString(li_contador++, as_idUsuario);
			lps_ps.setLong(li_contador++, al_etapa);
			lps_ps.setString(li_contador++, as_idCirculo);

			if(ab_porCantidad)
				lps_ps.setInt(
				    li_contador++, NumericUtils.getInt(NumericUtils.isValidInteger(ai_cantidad) ? ai_cantidad : null)
				);

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
			{
				ReasignarTurnos lrt_turnos = new ReasignarTurnos();

				ls_idOrdenTurno++;

				lrt_turnos.setIdOrdenTurno(ls_idOrdenTurno);
				lrt_turnos.setIdTurnoHistoria(NumericUtils.getBigDecimal(lrs_rs.getBigDecimal("ID_TURNO_HISTORIA")));
				lrt_turnos.setIdTurno(lrs_rs.getString("ID_TURNO"));
				lrt_turnos.setNir(lrs_rs.getString("NIR"));
				lcth_datos.add(lrt_turnos);
			}
		}
		catch(SQLException lse_e)
		{
			logError(this, "findAllByEtapaUsuario", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Find all by id solicitud.
	 *
	 * @param as_idSolicitud de as id solicitud
	 * @return el valor de collection
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public Collection<TurnoHistoria> findAllByIdSolicitud(String as_idSolicitud)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_trazabilidad;

		lcth_trazabilidad = new ArrayList<TurnoHistoria>();

		if(StringUtils.isValidString(as_idSolicitud))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_contador;
				StringBuilder lsb_sentencia;

				li_contador       = 1;
				lsb_sentencia     = new StringBuilder();

				lsb_sentencia.append(cs_FIND_ALL_BY_ID_SOLICITUD);

				lps_ps = getConnection().prepareStatement(StringUtils.getString(lsb_sentencia));

				lps_ps.setString(li_contador++, as_idSolicitud);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_trazabilidad.add(getTurnoHistoria(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findAllByIdSolicitud", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_trazabilidad.isEmpty())
			lcth_trazabilidad = null;

		return lcth_trazabilidad;
	}

	/**
	 * Find all by id solicitud id turno.
	 *
	 * @param as_idSolicitud de as id solicitud
	 * @param as_idTurno de as id turno
	 * @return el valor de collection
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public Collection<TurnoHistoria> findAllByIdSolicitudIdTurno(String as_idSolicitud, String as_idTurno)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_trazabilidad;

		lcth_trazabilidad = new ArrayList<TurnoHistoria>();

		if(StringUtils.isValidString(as_idSolicitud) && StringUtils.isValidString(as_idTurno))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_contador;
				StringBuilder lsb_sentencia;

				li_contador       = 1;
				lsb_sentencia     = new StringBuilder();

				lsb_sentencia.append(cs_FIND_ALL_BY_ID_SOLICITUD_ID_TURNO);

				lps_ps = getConnection().prepareStatement(StringUtils.getString(lsb_sentencia));

				lps_ps.setString(li_contador++, as_idSolicitud);
				lps_ps.setString(li_contador++, as_idTurno);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_trazabilidad.add(getTurnoHistoria(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findAllByIdSolicitudIdTurno", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_trazabilidad.isEmpty())
			lcth_trazabilidad = null;

		return lcth_trazabilidad;
	}

	/**
	 * Find all by id turno.
	 *
	 * @param as_idTurno de as id turno
	 * @return el valor de collection
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public Collection<TurnoHistoria> findAllByIdTurno(String as_idTurno)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;

		lcth_datos = new LinkedList<TurnoHistoria>();

		if(StringUtils.isValidString(as_idTurno))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_cont;

				li_cont     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_BY_ID_TURNO);

				lps_ps.setString(li_cont++, as_idTurno);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getTurnoHistoria(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findAllByIdTurno", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Consulta todos los registros de la tabla asociados a un id solicitud.
	 *
	 * @param ath_parametros Objeto contenedor del id solicitud a utilizar como filtro en la consulta
	 * @return Colección resultante de la consulta
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see TurnoHistoria
	 */
	public Collection<TurnoHistoria> findAllBySolicitud(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;

		lcth_datos = new ArrayList<TurnoHistoria>();

		if(ath_parametros != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;
				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_BY_SOLICITUD);

				lps_ps.setString(li_contador++, ath_parametros.getIdSolicitud());

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getTurnoHistoria(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findAllBySolicitud", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Consulta todos los registros de la tabla asociados a un id solicitud e id proceso específico.
	 *
	 * @param ath_parametros Objeto contenedor del id solicitud e id proceso a utilizar como filtro en la consulta
	 * @return Colección resultante de la consulta
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see TurnoHistoria
	 */
	public Collection<TurnoHistoria> findAllBySolicitudProceso(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;

		lcth_datos = new ArrayList<TurnoHistoria>();

		if(ath_parametros != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;
				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_BY_SOLICITUD_PROCESO);

				lps_ps.setString(li_contador++, ath_parametros.getIdSolicitud());
				lps_ps.setString(li_contador++, ath_parametros.getIdProceso());

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(obtenerTurnos(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findAllBySolicitudProceso", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Obtiene el detalle de los turnos asociados a un subproceso.
	 *
	 * @param aoa_tmp Objeto contenedor de los datos a utilizar como filtro en la consulta
	 * @param ab_conUsuario indica si la aprobación tiene un usuario asignado
	 * @return Coleccion resultante de la consulta
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see Aprobacion
	 */
	public Collection<Aprobacion> findAllData(Aprobacion aoa_tmp, boolean ab_conUsuario)
	    throws B2BException
	{
		Collection<Aprobacion> lca_data;

		lca_data = new ArrayList<Aprobacion>();

		if(aoa_tmp != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_column;
				StringBuilder lsb_sb;
				boolean       lb_idSolicitud;
				boolean       lb_idTurno;
				String        ls_solicitud;
				String        ls_idTurno;

				li_column = 1;

				if(ab_conUsuario)
					lsb_sb = new StringBuilder(cs_DATA_PRINCIPAL);
				else
					lsb_sb = new StringBuilder(cs_DATA_PRINCIPAL_SIN_USUARIO);

				lb_idSolicitud     = false;
				lb_idTurno         = false;
				ls_idTurno         = null;
				ls_solicitud       = null;

				ls_solicitud     = aoa_tmp.getIdSolicitud();
				ls_idTurno       = aoa_tmp.getIdTurno();

				if(StringUtils.isValidString(ls_solicitud))
				{
					lsb_sb.append(" AND TH.ID_SOLICITUD = ? ");
					lb_idSolicitud = true;
				}

				if(StringUtils.isValidString(ls_idTurno))
				{
					lsb_sb.append(" AND TH.ID_TURNO = ? ");
					lb_idTurno = true;
				}

				lsb_sb.append(" ORDER BY TH.ID_TURNO ASC, TH.FECHA_INICIAL, TH.FECHA_CREACION DESC");

				lps_ps = getConnection().prepareStatement(lsb_sb.toString());

				setLong(lps_ps, aoa_tmp.getIdEtapa(), li_column++);
				lps_ps.setString(li_column++, aoa_tmp.getNombreSubproceso());

				if(ab_conUsuario)
					lps_ps.setString(li_column++, aoa_tmp.getIdUsuarioCreacion());

				lps_ps.setString(li_column++, aoa_tmp.getProceso());

				if(lb_idSolicitud)
					lps_ps.setString(li_column++, ls_solicitud);

				if(lb_idTurno)
					lps_ps.setString(li_column++, ls_idTurno);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lca_data.add(dataPrincipal(lrs_rs, true));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findAllData", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lca_data.isEmpty())
			lca_data = null;

		return lca_data;
	}

	/**
	 * Consulta todos los registros de la tabla asociados a un id solicitud.
	 *
	 * @param as_idTurno correspondiente al valor del tipo de objeto String
	 * @return Colección resultante de la consulta
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see TurnoHistoria
	 */
	public Collection<TurnoHistoria> findAllInEtapa280Or281(String as_idTurno)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;

		lcth_datos = new ArrayList<TurnoHistoria>();

		if(StringUtils.isValidString(as_idTurno))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;
				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_TURNO_HISTORIA_IN_ETAPA_280_OR_281);

				lps_ps.setString(li_contador++, as_idTurno);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getTurnoHistoria(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findAllBySolicitud", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo Collection de InteresadoDocumentoTipo.
	 *
	 * @param al_idEtapa correspondiente al valor del tipo de objeto Long
	 * @return devuelve el valor del objeto collection
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see InteresadoDocumentoTipo
	 */
	public Collection<InteresadoDocumentoTipo> findAprobaciones(Long al_idEtapa)
	    throws B2BException
	{
		Collection<InteresadoDocumentoTipo> lp_subproceso;
		PreparedStatement                   lps_ps;
		ResultSet                           lrs_rs;

		lp_subproceso     = new ArrayList<InteresadoDocumentoTipo>();
		lps_ps            = null;
		lrs_rs            = null;

		try
		{
			lps_ps = getConnection().prepareStatement(cs_FIND_ALL);
			setLong(lps_ps, al_idEtapa, 1);

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
				lp_subproceso.add(getObjetFromResultSet(lrs_rs));
		}
		catch(SQLException lse_e)
		{
			logError(this, "findAprobaciones", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lp_subproceso.isEmpty())
			lp_subproceso = null;

		return lp_subproceso;
	}

	/**
	 * Retorna el valor del objeto de tipo Collection de TurnoHistoria filtrado por etapa y estado actividad.
	 *
	 * @param al_etapa correspondiente al valor del tipo de objeto long
	 * @param as_estadoAct correspondiente al valor del tipo de objeto String
	 * @return devuelve el valor del objeto collection de TurnoHistoria
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see TurnoHistoria
	 */
	public Collection<TurnoHistoria> findByEtapaEstAct(long al_etapa, String as_estadoAct)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;
		PreparedStatement         lps_ps;
		ResultSet                 lrs_rs;
		lcth_datos     = new ArrayList<TurnoHistoria>();

		lps_ps     = null;
		lrs_rs     = null;

		try
		{
			int li_contador;
			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(cs_FIND_BY_ETAPA_EST_ACT);

			lps_ps.setLong(li_contador++, al_etapa);
			lps_ps.setString(li_contador++, as_estadoAct);

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
				lcth_datos.add(getTurnoHistoria(lrs_rs));
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByEtapaEstAct", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo Collection de TurnoHistoria filtrado por etapa, estado actividad, porceso y subproceso.
	 *
	 * @param al_etapa Argumento de tipo <code>long</code> que contiene el id de la etapa.
	 * @param as_estadoAct Argumento de tipo <code>String</code> que contiene el estado actividad.
	 * @param as_idProceso Argumento de tipo <code>String </code> que contiene el id del proceso.
	 * @param as_subproceso Argumento de tipo <code>String</code> que contiene el nombre del subproceso.
	 * @return devuelve el valor del objeto collection de TurnoHistoria
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public Collection<TurnoHistoria> findByEtapaEstActProcesoSubproceso(
	    long al_etapa, String as_estadoAct, String as_idProceso, String as_subproceso
	)
	    throws B2BException
	{
		return findByEtapaEstActProcesoSubproceso(al_etapa, as_estadoAct, as_idProceso, as_subproceso, null);
	}

	/**
	 * Retorna el valor del objeto de tipo Collection de TurnoHistoria filtrado por etapa, estado actividad, porceso y subproceso.
	 *
	 * @param al_etapa Argumento de tipo <code>long</code> que contiene el id de la etapa.
	 * @param as_estadoAct Argumento de tipo <code>String</code> que contiene el estado actividad.
	 * @param as_idProceso Argumento de tipo <code>String </code> que contiene el id del proceso.
	 * @param as_subproceso Argumento de tipo <code>String</code> que contiene el nombre del subproceso.
	 * @param aa_aprobacion Argumento de tipo <code>Aprobación</code> que contiene la información de la aprobación de la operación.
	 * @return devuelve el valor del objeto collection de TurnoHistoria
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public Collection<TurnoHistoria> findByEtapaEstActProcesoSubproceso(
	    long al_etapa, String as_estadoAct, String as_idProceso, String as_subproceso, Aprobacion aa_aprobacion
	)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;
		PreparedStatement         lps_ps;
		ResultSet                 lrs_rs;
		lcth_datos     = new ArrayList<TurnoHistoria>();

		lps_ps     = null;
		lrs_rs     = null;

		try
		{
			StringBuilder lsb_sb;
			boolean       lb_idSolicitud;
			boolean       lb_idTurno;
			String        ls_nir;
			String        ls_idTurno;

			lb_idSolicitud     = false;
			lb_idTurno         = false;
			ls_idTurno         = null;
			ls_nir             = null;
			lsb_sb             = new StringBuilder(cs_FIND_BY_ETAPA_PROCESO_SUB_EST_ACT);

			if(aa_aprobacion != null)
			{
				if(aa_aprobacion.isConsultaDetalle())
				{
					ls_nir         = aa_aprobacion.getNir();
					ls_idTurno     = aa_aprobacion.getIdTurno();

					if(StringUtils.isValidString(ls_nir))
					{
						lsb_sb             = lsb_sb.append(" AND SO.NIR = ? ");
						lb_idSolicitud     = true;
					}

					if(StringUtils.isValidString(ls_idTurno))
					{
						lsb_sb         = lsb_sb.append(" AND TUA.ID_TURNO = ? ");
						lb_idTurno     = true;
					}
				}
			}

			int li_contador;
			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(lsb_sb.toString());

			lps_ps.setLong(li_contador++, al_etapa);
			lps_ps.setString(li_contador++, as_estadoAct);
			lps_ps.setString(li_contador++, as_idProceso);
			lps_ps.setString(li_contador++, as_subproceso);

			if(lb_idSolicitud)
				lps_ps.setString(li_contador++, ls_nir);

			if(lb_idTurno)
				lps_ps.setString(li_contador++, ls_idTurno);

			lsb_sb.append(" ORDER BY TUA.FECHA_CREACION ASC");

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
				lcth_datos.add(getTurnoHistoria(lrs_rs));
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByEtapaEstAct", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria.
	 *
	 * @param ath_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see TurnoHistoria
	 */
	public TurnoHistoria findById(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		return (ath_parametros != null) ? findById(ath_parametros.getIdTurnoHistoria()) : null;
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria filtrado por ID.
	 *
	 * @param al_idTurnoHistoria correspondiente al valor del tipo de objeto Long
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see TurnoHistoria
	 */
	public TurnoHistoria findById(Long al_idTurnoHistoria)
	    throws B2BException
	{
		TurnoHistoria lth_return;

		lth_return = null;

		if(NumericUtils.isValidLong(al_idTurnoHistoria))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;
				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_BY_ID);

				setLong(lps_ps, al_idTurnoHistoria, li_contador++);

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					lth_return = getTurnoHistoria(lrs_rs);
			}
			catch(SQLException lse_e)
			{
				logError(this, "findById", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lth_return;
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria filtrado por id anterior.
	 *
	 * @param ath_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see TurnoHistoria
	 */
	public TurnoHistoria findByIdAnterior(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		return findByIdAnterior(ath_parametros, false);
	}

	/**
	 * Find by id anterior.
	 *
	 * @param ath_parametros de ath parametros
	 * @param ab_idanterior de ab idanterior
	 * @return el valor de turno historia
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public TurnoHistoria findByIdAnterior(TurnoHistoria ath_parametros, boolean ab_idanterior)
	    throws B2BException
	{
		TurnoHistoria     lca_data;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		lca_data     = null;
		lps_ps       = null;
		lrs_rs       = null;

		try
		{
			int li_contador;
			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(ab_idanterior ? cs_FIND_BY_ID_ANTERIOR : cs_FIND_BY_ID);

			lps_ps.setBigDecimal(li_contador++, ath_parametros.getIdAnterior());

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lca_data = getTurnoHistoria(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByIdTurnoUltimo", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lca_data;
	}

	/**
	 * Find by id mensaje.
	 *
	 * @param as_idMensaje de as id mensaje
	 * @return el valor de turno historia
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public TurnoHistoria findByIdMensaje(String as_idMensaje)
	    throws B2BException
	{
		TurnoHistoria     lth_data;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;
		lth_data     = null;

		lps_ps     = null;
		lrs_rs     = null;

		try
		{
			int li_contador;
			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(cs_FIND_BY_ID_MENSAJE);

			lps_ps.setString(li_contador++, as_idMensaje);

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lth_data = getTurnoHistoria(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByIdMensaje", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lth_data;
	}

	/**
	 * Find by id solicitud blq 80.
	 *
	 * @param as_idSolicitud the as id solicitud
	 * @return the turno historia
	 * @throws B2BException the b 2 B exception
	 */
	public TurnoHistoria findByIdSolicitudBlq80(String as_idSolicitud)
	    throws B2BException
	{
		TurnoHistoria lth_return;

		lth_return = null;

		if(StringUtils.isValidString(as_idSolicitud))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				lps_ps = getConnection().prepareStatement(cs_FIND_BY_ID_SOLICITUD_80_BLQ);

				lps_ps.setString(1, as_idSolicitud);

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					lth_return = getTurnoHistoria(lrs_rs);
			}
			catch(SQLException lse_e)
			{
				logError(this, "findByIdSolicitudBlq80", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lth_return;
	}

	/**
	 * Metodo encargado de consultar el turno historia por el id_turno.
	 *
	 * @param as_idTurno Objeto de tipo String que contiene el id_turno a ser consultado
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findByIdTurno(String as_idTurno)
	    throws B2BException
	{
		return findByIdTurno(new TurnoHistoria(as_idTurno), true);
	}

	/**
	 * Metodo encargado de consultar el turno historia por el id_turno.
	 *
	 * @param ath_parametros Objeto de tipo TurnoHistoria que contiene el id_turno a ser consultado
	 * @param ab_orden Objeto de tipo boolean que define el ordenamiento de la consulta
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findByIdTurno(TurnoHistoria ath_parametros, boolean ab_orden)
	    throws B2BException
	{
		TurnoHistoria     lca_data;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		lca_data     = new TurnoHistoria();
		lps_ps       = null;
		lrs_rs       = null;

		try
		{
			int           li_contador;
			StringBuilder lsb_sentencia;

			li_contador       = 1;
			lsb_sentencia     = new StringBuilder();

			lsb_sentencia.append(cs_FIND_BY_ID_TURNO);

			if(ab_orden)
				lsb_sentencia.append(" ORDER BY ID_TURNO_HISTORIA DESC");

			lps_ps = getConnection().prepareStatement(StringUtils.getString(lsb_sentencia));

			lps_ps.setString(li_contador++, ath_parametros.getIdTurno());

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lca_data = getTurnoHistoria(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findById", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lca_data;
	}

	/**
	 * Metodo encargado de consultar el turno historia por el id_turno.
	 *
	 * @param as_idTurno de as id turno
	 * @param asa_codigos de asa codigos
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findByIdTurnoBandejaCorrespondencia(String as_idTurno, String[] asa_codigos)
	    throws B2BException
	{
		TurnoHistoria     lth_data;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		lth_data     = null;
		lps_ps       = null;
		lrs_rs       = null;

		try
		{
			int           li_contador;
			StringBuilder lsb_sentencia;

			li_contador       = 1;
			lsb_sentencia     = new StringBuilder();

			lsb_sentencia.append(cs_FIND_BY_ID_TURNO);

			lsb_sentencia.append(" AND ID_ETAPA <> '15' ");

			if(CollectionUtils.isValidCollection(asa_codigos))
			{
				for(String ls_tmp : asa_codigos)
				{
					if(StringUtils.isValidString(ls_tmp))
						lsb_sentencia.append(" AND ID_ETAPA <> ? ");
				}
			}

			lsb_sentencia.append(" AND ESTADO_ACTIVIDAD = 'ASG' ");

			lps_ps = getConnection().prepareStatement(StringUtils.getString(lsb_sentencia));

			lps_ps.setString(li_contador++, as_idTurno);

			if(CollectionUtils.isValidCollection(asa_codigos))
			{
				for(String ls_tmp : asa_codigos)
				{
					if(StringUtils.isValidString(ls_tmp))
						lps_ps.setString(li_contador++, ls_tmp);
				}
			}

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lth_data = getTurnoHistoria(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByIdTurnoBandejaCorrespondencia", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lth_data;
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria.
	 *
	 * @param ath_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findByIdTurnoDesc(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		TurnoHistoria     lca_data;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		lca_data     = new TurnoHistoria();
		lps_ps       = null;
		lrs_rs       = null;

		try
		{
			int li_contador;
			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(cs_FIND_BY_ID_TURNO_DESC);

			lps_ps.setString(li_contador++, ath_parametros.getIdTurno());

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lca_data = getTurnoHistoria(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByIdTurnoDesc", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lca_data;
	}

	/**
	 * Metodo encargado de consultar el turno historia por el id_turno y id_etapa.
	 *
	 * @param as_idTurno Objeto de tipo String que contiene el id_turno a ser consultado
	 * @param al_idEtapa Variable de tipo long que contiene el id_etapa a ser consultada
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findByIdTurnoEtapa(String as_idTurno, long al_idEtapa)
	    throws B2BException
	{
		TurnoHistoria     lca_data;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		lca_data     = null;
		lps_ps       = null;
		lrs_rs       = null;

		try
		{
			int li_contador;

			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(cs_FIND_BY_ID_TURNO_ETAPA);

			lps_ps.setString(li_contador++, as_idTurno);
			lps_ps.setLong(li_contador++, al_idEtapa);

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lca_data = getTurnoHistoria(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByIdTurnoEtapa", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lca_data;
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria.
	 *
	 * @param ath_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findByIdTurnoEtapa(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		TurnoHistoria     lca_data;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;
		lca_data     = null;

		lps_ps     = null;
		lrs_rs     = null;

		try
		{
			int li_contador;
			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(cs_FIND_BY_ID_TURNO_ETAPA_ESTADO);

			lps_ps.setString(li_contador++, ath_parametros.getIdTurno());
			setDouble(lps_ps, NumericUtils.getDoubleWrapper(ath_parametros.getIdEtapa()), li_contador++);
			lps_ps.setString(li_contador++, ath_parametros.getEstadoActividad());

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lca_data = getTurnoHistoria(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByIdTurnoEtapa", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lca_data;
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria filtrado por id turno y id etapa.
	 *
	 * @param ath_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findByIdTurnoEtapaDiffASG(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		return (ath_parametros != null)
		? findByIdTurnoEtapaDiffASG(ath_parametros.getIdTurno(), NumericUtils.getLong(ath_parametros.getIdEtapa())) : null;
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria filtrado por id turno y id etapa.
	 *
	 * @param as_idTurno correspondiente al valor del tipo de objeto id turno
	 * @param al_idEtapa correspondiente al valor del tipo de objeto id etapa
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findByIdTurnoEtapaDiffASG(String as_idTurno, long al_idEtapa)
	    throws B2BException
	{
		TurnoHistoria lca_data;

		lca_data = null;

		if(StringUtils.isValidString(as_idTurno) && (al_idEtapa > 0))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;
				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_BY_ID_TURNO_ETAPA_DIFF_ASG);

				lps_ps.setString(li_contador++, as_idTurno);
				lps_ps.setLong(li_contador++, al_idEtapa);

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					lca_data = getTurnoHistoria(lrs_rs);
			}
			catch(SQLException lse_e)
			{
				logError(this, "findByIdTurnoEtapaDiffASG", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lca_data;
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria filtrado por motivo etapa.
	 *
	 * @param ath_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findByIdTurnoEtapaOrdered(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		TurnoHistoria     lca_data;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;
		lca_data     = null;

		lps_ps     = null;
		lrs_rs     = null;

		try
		{
			int li_contador;
			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(cs_FIND_BY_ID_TURNO_ETAPA_FOR_MOTIVO);

			lps_ps.setString(li_contador++, ath_parametros.getIdTurno());

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lca_data = getTurnoHistoria(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByIdTurnoEtapaOrdered", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lca_data;
	}

	/**
	 * Metodo encargado de consultar el turno historia por el id_turno y etapas 501,502,515.
	 *
	 * @param as_idTurno de as id turno
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findByIdTurnoEtapasDevDinero(String as_idTurno)
	    throws B2BException
	{
		TurnoHistoria     lth_data;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		lth_data     = null;
		lps_ps       = null;
		lrs_rs       = null;

		try
		{
			int           li_contador;
			StringBuilder lsb_sentencia;

			li_contador       = 1;
			lsb_sentencia     = new StringBuilder(cs_FIND_BY_ID_TURNO);

			lsb_sentencia.append(" AND ID_ETAPA IN ('501','502','515') AND ESTADO_ACTIVIDAD = 'TER' ");

			lps_ps = getConnection().prepareStatement(lsb_sentencia.toString());

			lps_ps.setString(li_contador++, as_idTurno);

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lth_data = getTurnoHistoria(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByIdTurnoEtapasDevDinero", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lth_data;
	}

	/**
	 * Metodo encargado de consultar el turno historia por el id_turno.
	 *
	 * @param ath_parametros Objeto de tipo TurnoHistoria que contiene el id_turno a ser consultado
	 * @return devuelve el valor del collection de objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TurnoHistoria> findByIdTurnoFechaCreacion(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;
		PreparedStatement         lps_ps;
		ResultSet                 lrs_rs;

		lcth_datos     = new ArrayList<TurnoHistoria>();
		lps_ps         = null;
		lrs_rs         = null;

		try
		{
			int           li_contador;
			StringBuilder lsb_sentencia;

			li_contador       = 1;
			lsb_sentencia     = new StringBuilder();

			lsb_sentencia.append(cs_FIND_BY_ID_TURNO);

			lsb_sentencia.append(" ORDER BY FECHA_CREACION DESC");

			lps_ps = getConnection().prepareStatement(StringUtils.getString(lsb_sentencia));

			lps_ps.setString(li_contador++, ath_parametros.getIdTurno());

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
				lcth_datos.add(getTurnoHistoria(lrs_rs));
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByIdTurnoFechaCreacion", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria.
	 *
	 * @param ath_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see TurnoHistoria
	 */
	public TurnoHistoria findByIdTurnoUltimo(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		return (ath_parametros != null) ? findByIdTurnoUltimo(ath_parametros.getIdTurno()) : null;
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria filtrado por ID.
	 *
	 * @param ath_parametros correspondiente al valor del tipo de objeto Long
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see TurnoHistoria
	 */
	public TurnoHistoria findByIdTurnoUltimo(String ath_parametros)
	    throws B2BException
	{
		TurnoHistoria     lca_data;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		lca_data     = null;
		lps_ps       = null;
		lrs_rs       = null;

		try
		{
			int li_contador;
			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(cs_FIND_BY_TURNO);

			lps_ps.setString(li_contador++, ath_parametros);

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lca_data = getTurnoHistoria(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByIdTurnoUltimo", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lca_data;
	}

	/**
	 * Metodo encargado de consultar el turno historia por el id_turno.
	 *
	 * @param as_nir de as nir
	 * @param asa_codigos de asa codigos
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findByNIRBandejaCorrespondencia(String as_nir, String[] asa_codigos)
	    throws B2BException
	{
		TurnoHistoria     lca_data;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		lca_data     = null;
		lps_ps       = null;
		lrs_rs       = null;

		try
		{
			int           li_contador;
			StringBuilder lsb_sentencia;

			li_contador       = 1;
			lsb_sentencia     = new StringBuilder();

			lsb_sentencia.append(cs_FIND_BY_NIR);

			lsb_sentencia.append(" AND ATH.ID_ETAPA <> '15' ");

			if(CollectionUtils.isValidCollection(asa_codigos))
			{
				for(String ls_tmp : asa_codigos)
				{
					if(StringUtils.isValidString(ls_tmp))
						lsb_sentencia.append(" AND ATH.ID_ETAPA <> ? ");
				}
			}

			lsb_sentencia.append(" AND ATH.ESTADO_ACTIVIDAD = 'ASG' ");

			lps_ps = getConnection().prepareStatement(StringUtils.getString(lsb_sentencia));

			lps_ps.setString(li_contador++, as_nir);

			if(CollectionUtils.isValidCollection(asa_codigos))
			{
				for(String ls_tmp : asa_codigos)
				{
					if(StringUtils.isValidString(ls_tmp))
						lps_ps.setString(li_contador++, ls_tmp);
				}
			}

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lca_data = getTurnoHistoria(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByNIRDesistimiento", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lca_data;
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria.
	 *
	 * @param ath_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findBySolicitud(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		TurnoHistoria lca_data;
		lca_data = null;

		if(ath_parametros != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;
				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_BY_SOLICITUD);

				lps_ps.setString(li_contador++, ath_parametros.getIdSolicitud());

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					lca_data = getTurnoHistoria(lrs_rs);
			}
			catch(SQLException lse_e)
			{
				logError(this, "findBySolicitud", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lca_data;
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria filtrado por solicitud etapa.
	 *
	 * @param as_parametro de as parametro
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findBySolicitudEtapa(TurnoHistoria as_parametro)
	    throws B2BException
	{
		return ((as_parametro != null)
		? findBySolicitudEtapa(
		    as_parametro.getIdSolicitud(), null, NumericUtils.getLong(as_parametro.getIdEtapa()),
		    as_parametro.getEstadoActividad()
		) : null);
	}

	/**
	 * Retorna el valor del objeto de tipo TurnoHistoria filtrado por solicitud etapa.
	 *
	 * @param as_idSolicitud de as id solicitud
	 * @param as_idTurno de as id turno
	 * @param al_idEtapa de al id etapa
	 * @param ls_estadoActividad de ls estado actividad
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findBySolicitudEtapa(
	    String as_idSolicitud, String as_idTurno, long al_idEtapa, String ls_estadoActividad
	)
	    throws B2BException
	{
		TurnoHistoria lth_data;
		lth_data = null;

		if(
		    (StringUtils.isValidString(as_idSolicitud) || StringUtils.isValidString(as_idTurno))
			    && (al_idEtapa > NumericUtils.DEFAULT_LONG_VALUE)
		)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_contador;
				StringBuilder lsb_sb;
				boolean       lb_estadoActividad;

				li_contador            = 1;
				lsb_sb                 = new StringBuilder(cs_FIND_BY_SOLICITUD_ETAPA);
				lb_estadoActividad     = StringUtils.isValidString(ls_estadoActividad);

				if(StringUtils.isValidString(as_idSolicitud))
					lsb_sb.append(" AND ID_SOLICITUD = ?");
				else if(StringUtils.isValidString(as_idTurno))
					lsb_sb.append(" AND ID_TURNO = ?");

				if(lb_estadoActividad)
					lsb_sb.append(" AND ESTADO_ACTIVIDAD = ?");

				lsb_sb.append(" ORDER BY ID_TURNO_HISTORIA DESC");

				lps_ps = getConnection().prepareStatement(lsb_sb.toString());

				lps_ps.setBigDecimal(li_contador++, BigDecimal.valueOf(al_idEtapa));

				if(StringUtils.isValidString(as_idSolicitud))
					lps_ps.setString(li_contador++, as_idSolicitud);
				else if(StringUtils.isValidString(as_idTurno))
					lps_ps.setString(li_contador++, as_idTurno);

				if(lb_estadoActividad)
					lps_ps.setString(li_contador++, ls_estadoActividad);

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					lth_data = getTurnoHistoria(lrs_rs);
			}
			catch(SQLException lse_e)
			{
				logError(this, "findBySolicitudEtapa", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lth_data;
	}

	/**
	 * Retorna el valor del objeto de tipo Collection de TurnoHistoria filtrado por id turno, id etapa, estado actividad.
	 *
	 * @param ath_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return devuelve el valor del objeto collection
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TurnoHistoria> findByTurnoEtapaEstActDif(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;
		PreparedStatement         lps_ps;
		ResultSet                 lrs_rs;
		lcth_datos     = new ArrayList<TurnoHistoria>();

		lps_ps     = null;
		lrs_rs     = null;

		try
		{
			int li_contador;
			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(cs_FIND_BY_TURNO_ETAPA_EST_ACT_DIF);

			lps_ps.setString(li_contador++, ath_parametros.getIdTurno());
			setDouble(lps_ps, NumericUtils.getDoubleWrapper(ath_parametros.getIdEtapa()), li_contador++);
			lps_ps.setString(li_contador++, ath_parametros.getEstadoActividad());

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
				lcth_datos.add(getTurnoHistoria(lrs_rs));
		}
		catch(SQLException lse_e)
		{
			logError(this, "findByTurnoEtapaEstActDif", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Consulta todos los registros que esten en fase de entrega y en estado actividad asignado para un id turno.
	 *
	 * @param as_isTurno correspondiente al valor del tipo de objeto String
	 * @return Objeto de tipo TurnoHistoria producto de la consulta realizada
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findByTurnoFaseEntrega(String as_isTurno)
	    throws B2BException
	{
		TurnoHistoria lth_datos;

		lth_datos = null;

		if(StringUtils.isValidString(as_isTurno))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;
				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_BY_TURNO_FASE_ENTREGA);

				lps_ps.setString(li_contador++, as_isTurno);

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					lth_datos = getTurnoHistoria(lrs_rs);
			}
			catch(SQLException lse_e)
			{
				logError(this, "findByTurnoFaseEntrega", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lth_datos;
	}

	/**
	 * Consulta todos los registros de la tabla asociados a un id turno.
	 *
	 * @param ath_parametros Objeto contenedor del id turno a utilizar como filtro en la consulta
	 * @return Colección resultante de la consulta
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TurnoHistoria> findByTurnoProrrogaMayorValor(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;

		lcth_datos = new ArrayList<TurnoHistoria>();

		if(ath_parametros != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;
				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_BY_TURNO_PRORROGA_MAYOR_VALOR);

				lps_ps.setString(li_contador++, ath_parametros.getIdTurno());

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getTurnoHistoria(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findByTurnoProrrogaMayorValor", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Consulta todos los registros de la tabla asociados a un id turno.
	 *
	 * @param ath_parametros Objeto contenedor del id turno a utilizar como filtro en la consulta
	 * @return Colección resultante de la consulta
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TurnoHistoria> findByTurnoSegundaInstancia(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;

		lcth_datos = new ArrayList<TurnoHistoria>();

		if(ath_parametros != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;
				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_BY_TURNO_SEGUNDA_INSTANCIA);

				lps_ps.setString(li_contador++, ath_parametros.getIdTurno());

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getTurnoHistoria(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findByTurnoSegundaInstancia", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Consulta todos los registros de la tabla asociados a un id turno.
	 *
	 * @param ath_parametros Objeto contenedor del id turno a utilizar como filtro en la consulta
	 * @param ab_segundRecepcion de ab segund recepcion
	 * @return Colección resultante de la consulta
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TurnoHistoria> findByTurnoSuspensionTramiteEntregaDoc(
	    TurnoHistoria ath_parametros, boolean ab_segundRecepcion, String as_subProcesos
	)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;

		lcth_datos = new ArrayList<TurnoHistoria>();

		if(ath_parametros != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_contador;
				StringBuilder lsb_sb;

				li_contador     = 1;
				lsb_sb          = new StringBuilder(cs_FIND_BY_TURNO_SUSPENSION_ENTREGA_DOC);

				if(ab_segundRecepcion && StringUtils.isValidString(as_subProcesos))
				{
					as_subProcesos = as_subProcesos.replace(",", "','");
					lsb_sb.append(" AND ID_SUBPROCESO IN('" + as_subProcesos + "') ");
				}

				lps_ps = getConnection().prepareStatement(lsb_sb.toString());

				lps_ps.setString(li_contador++, ath_parametros.getIdTurno());
				lps_ps.setString(li_contador++, ath_parametros.getIdTurno());
				lps_ps.setString(li_contador++, ath_parametros.getIdTurno());
				lps_ps.setString(li_contador++, ath_parametros.getIdTurno());

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getTurnoHistoria(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findByTurnoSuspensionTramiteEntregaDoc", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Consulta todos los registros de la tabla asociados a un id turno.
	 *
	 * @param ath_parametros Objeto contenedor del id turno a utilizar como filtro en la consulta
	 * @return Colección resultante de la consulta
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TurnoHistoria> findByTurnoSuspensionTramiteProrrogaEntregaDoc(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;

		lcth_datos = new ArrayList<TurnoHistoria>();

		if(ath_parametros != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;
				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_BY_TURNO_SUSPENSION_PRORROGA_ENTREGA);

				lps_ps.setString(li_contador++, ath_parametros.getIdTurno());
				lps_ps.setString(li_contador++, ath_parametros.getIdTurno());
				lps_ps.setString(li_contador++, ath_parametros.getIdTurno());

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getTurnoHistoria(lrs_rs));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findByTurnoSuspensionTramiteProrrogaEntregaDoc", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Retorna la cantidad de registros que coincidan con los criterios de consulta.
	 *
	 * @param ath_parametros Argumento de tipo <code>TurnoHistoria</code> que contiene los criterios necesarios para realizar la consulta.
	 * @return Retorna cantidad de registros que coincidan con los criterios de consulta.
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public int findCountByTurnoEtapaMotivo(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		int               li_idCorreo;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		li_idCorreo     = 0;
		lps_ps          = null;
		lrs_rs          = null;

		try
		{
			if(ath_parametros != null)
			{
				int li_count;

				li_count     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_COUNT_BY_TURNO_ETAPA_MOTIVO);

				lps_ps.setString(li_count++, ath_parametros.getIdTurno());
				setDouble(lps_ps, NumericUtils.getDoubleWrapper(ath_parametros.getIdEtapa()), li_count++);
				lps_ps.setString(li_count++, ath_parametros.getEstadoActividad());
				setLong(lps_ps, ath_parametros.getIdMotivo(), li_count++);

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					li_idCorreo = lrs_rs.getInt(1);
			}
		}
		catch(SQLException lse_e)
		{
			logError(this, "findCountByTurnoEtapaMotivo", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return li_idCorreo;
	}

	/**
	 * Consulta en la base de datos los registros pertenecientes a la etapa de aprobación.
	 *
	 * @param aa_a objeto contenedor de los parametros a uitlizar como filtro en la búsqueda
	 * @param ab_conUsuario  indica si la aprobación tiene usuario asignado
	 * @return Colección de aprobaciones resultante de la consulta
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<Aprobacion> findDataAprobacion(Aprobacion aa_a, boolean ab_conUsuario)
	    throws B2BException
	{
		return findDataAprobacion(aa_a, null, ab_conUsuario);
	}

	/**
	 * Consulta en la base de datos los registros pertenecientes a la etapa de aprobación.
	 *
	 * @param aa_a objeto contenedor de los parametros a uitlizar como filtro en la búsqueda
	 * @param ab_conUsuario  indica si la aprobación tiene usuario asignado
	 * @return Colección de aprobaciones resultante de la consulta
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<Aprobacion> findDataAprobacion(
	    Aprobacion aa_aprobacion, String as_idProceso, boolean ab_conUsuario
	)
	    throws B2BException
	{
		return findDataAprobacion(aa_aprobacion, as_idProceso, ab_conUsuario, false);
	}

	/**
	 * Consulta en la base de datos los registros pertenecientes a la etapa de aprobación.
	 *
	 * @param aa_aprobacion objeto contenedor de los parametros a uitlizar como filtro en la búsqueda
	 * @param as_idProceso Id del proceso del cual se quiere obtener los tramites activos
	 * @param ab_conUsuario indica si la aprobación tiene usuario asignado
	 * @return Colección de aprobaciones resultante de la consulta
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<Aprobacion> findDataAprobacion(
	    Aprobacion aa_aprobacion, String as_idProceso, boolean ab_conUsuario, boolean lb_0463
	)
	    throws B2BException
	{
		Collection<Aprobacion> lca_data;
		lca_data = new ArrayList<Aprobacion>(1);

		if((aa_aprobacion != null))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				boolean       lb_bandejaSubproceso;
				Long          ll_idEtapa;
				boolean       lb_etapaValida;
				boolean       lb_bandejaAprobacionEjecucion;
				StringBuilder lsb_sb;
				boolean       lb_idSolicitud;
				boolean       lb_idTurno;
				int           li_column;
				String        ls_solicitud;
				String        ls_idTurno;
				boolean       lb_conMotivoNoTramite;

				lb_bandejaSubproceso              = StringUtils.isValidString(as_idProceso);
				ll_idEtapa                        = aa_aprobacion.getIdEtapa();
				lb_etapaValida                    = NumericUtils.isValidLong(ll_idEtapa);
				lb_bandejaAprobacionEjecucion     = lb_bandejaSubproceso
						&& as_idProceso.equalsIgnoreCase(ProcesoCommon.ID_PROCESO_62) && lb_etapaValida
						&& (ll_idEtapa.longValue() == EtapaCommon.ID_ETAPA_APROBACION_EJECUCION);
				li_column                         = 1;
				lb_conMotivoNoTramite             = aa_aprobacion.getConMotivoNoTramite();

				if(ab_conUsuario)
					lsb_sb = new StringBuilder(
						    lb_bandejaSubproceso ? cs_BANDEJA_APROBACION_SUBPROCESO : cs_BANDEJA_APROBACION
						);
				else
				{
					if(lb_bandejaSubproceso)
					{
						if(lb_bandejaAprobacionEjecucion)
							lsb_sb = new StringBuilder(cs_BANDEJA_APROBACION_EJECUCION_SUBPROCESO_SIN_USUARIO);
						else
							lsb_sb = new StringBuilder(cs_BANDEJA_APROBACION_SUBPROCESO_SIN_USUARIO);
					}
					else
						lsb_sb = new StringBuilder(
							    lb_conMotivoNoTramite ? cs_BANDEJA_APROBACION_SIN_MOTIVO_NO_TRAMITE
							                          : cs_BANDEJA_APROBACION_SIN_USUARIO
							);
				}

				if(lb_0463)
					lsb_sb = new StringBuilder(cs_BANDEJA_APROBACION_SUBPROCESO_ACTO);

				lb_idSolicitud     = false;
				lb_idTurno         = false;
				ls_idTurno         = null;
				ls_solicitud       = null;

				if(aa_aprobacion.isConsultaDetalle())
				{
					ls_solicitud     = aa_aprobacion.getIdSolicitud();
					ls_idTurno       = aa_aprobacion.getIdTurno();

					if(StringUtils.isValidString(ls_solicitud))
					{
						lsb_sb             = lsb_sb.append(" AND TH.ID_SOLICITUD = ? ");
						lb_idSolicitud     = true;
					}

					if(StringUtils.isValidString(ls_idTurno))
					{
						lsb_sb         = lsb_sb.append(" AND TH.ID_TURNO = ? ");
						lb_idTurno     = true;
					}
				}

				if(lb_bandejaAprobacionEjecucion)
				{
					lsb_sb.append(" AND SUB.ID_SUBPROCESO IN( ");
					lsb_sb.append(aa_aprobacion.isConsultaAuto() ? "1,2" : "3,4,5");
					lsb_sb.append(") ");
					lsb_sb.append(" AND TH2.ID_ETAPA IN ('835','840') ");
					lsb_sb.append(" AND TH2.ID_MOTIVO IN ( ");
					lsb_sb.append(aa_aprobacion.getIdMotivosAprobacionEjecucion());
					lsb_sb.append(") ");
				}

				if(!lb_conMotivoNoTramite)
					lsb_sb = lsb_sb.append(" AND TH.MOTIVO_NO_TRAMITE IS NOT NULL ");

				if(lb_bandejaSubproceso)
					lsb_sb = lsb_sb.append(" GROUP BY SUB.NOMBRE");
				else
				{
					if(!lb_conMotivoNoTramite)
						lsb_sb = lsb_sb.append(
							    " GROUP BY  TH.MOTIVO_NO_TRAMITE,TH.ID_ETAPA,ATH2.ID_ETAPA,ATH2.ID_MOTIVO"
							);
					else
						lsb_sb = lsb_sb.append(
							    " GROUP BY ATH2.ID_ETAPA, ATH2.ID_MOTIVO, TH.MOTIVO_NO_TRAMITE, SUB.ID_SUBPROCESO"
							);
				}

				lps_ps = getConnection().prepareStatement(lsb_sb.toString());

				if(lb_bandejaSubproceso)
					lps_ps.setString(li_column++, as_idProceso);
				else
					lps_ps.setString(li_column++, aa_aprobacion.getIdProceso());

				setLong(lps_ps, aa_aprobacion.getIdEtapa(), li_column++);

				if(ab_conUsuario)
					lps_ps.setString(li_column++, aa_aprobacion.getIdUsuarioCreacion());

				if(!ab_conUsuario && lsb_sb.toString().contains("AND TH.ID_USUARIO"))
					lps_ps.setString(li_column++, aa_aprobacion.getIdUsuarioCreacion());

				if(!lb_bandejaSubproceso)
					lps_ps.setString(li_column++, aa_aprobacion.getNombreProceso());

				if(lb_idSolicitud)
					lps_ps.setString(li_column++, ls_solicitud);

				if(lb_idTurno)
					lps_ps.setString(li_column++, ls_idTurno);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
				{
					if(lb_bandejaSubproceso)
						lca_data.add(obtenerBandejaPorSubproceso(lrs_rs));
					else
						lca_data.add(dataPrincipal(lrs_rs, false));
				}
			}
			catch(SQLException lse_e)
			{
				logError(this, "findAllData", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}

			if(lca_data.isEmpty())
				lca_data = null;
		}

		return lca_data;
	}

	/**
	 * Retorna el valor del objeto de tipo Collection de Aprobacion antiguo sistema.
	 *
	 * @param al_idEtapa correspondiente al valor del tipo de objeto Long
	 * @param as_idTurno correspondiente al valor del tipo de objeto String
	 * @param as_idSolicitud correspondiente al valor del tipo de objeto String
	 * @param as_usuario correspondiente al valor del tipo de objeto String
	 * @return devuelve el valor del objeto collection de Aprobacion
	 * @throws B2BException Señala que se ha producido una excepción
	 * @see Aprobacion
	 */
	public Collection<Aprobacion> findDataAprobadorAntiguoSistema(
	    Long al_idEtapa, String as_idTurno, String as_idSolicitud, String as_usuario
	)
	    throws B2BException
	{
		Collection<Aprobacion> lca_data;
		PreparedStatement      lps_ps;
		ResultSet              lrs_rs;
		int                    li_column;
		StringBuilder          lsb_sb;
		lsb_sb        = new StringBuilder();
		li_column     = 1;
		lca_data      = new ArrayList<Aprobacion>();
		lps_ps        = null;
		lrs_rs        = null;

		boolean lb_turno;
		boolean lb_solicitud;
		lb_turno      = false;
		lb_solicitud  = false;

		try
		{
			lsb_sb = lsb_sb.append(cs_APROBADOR_ANTIGUO_SISTEMA);

			if(StringUtils.isValidString(as_idTurno))
			{
				lsb_sb       = lsb_sb.append("AND TH.ID_TURNO = ? ");
				lb_turno     = true;

				if(StringUtils.isValidString(as_idSolicitud))
				{
					lsb_sb           = lsb_sb.append("AND TH.ID_SOLICITUD = ? ORDER BY TH.ID_TURNO ");
					lb_solicitud     = true;
				}
				else
					lsb_sb = lsb_sb.append("ORDER BY TH.ID_TURNO ");
			}
			else
			{
				if(StringUtils.isValidString(as_idSolicitud))
				{
					lsb_sb           = lsb_sb.append("AND TH.ID_SOLICITUD = ? ORDER BY TH.ID_TURNO ");
					lb_solicitud     = true;
				}
				else
					lsb_sb = lsb_sb.append("ORDER BY TH.ID_TURNO ");
			}

			lps_ps = getConnection().prepareStatement(lsb_sb.toString());

			setLong(lps_ps, al_idEtapa, li_column++);
			lps_ps.setString(li_column++, as_usuario);

			if(lb_turno)
				lps_ps.setString(li_column++, as_idTurno);

			if(lb_solicitud)
				lps_ps.setString(li_column++, as_idSolicitud);

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
				lca_data.add(dataAprobadorAntiguoSistema(lrs_rs));
		}
		catch(SQLException lse_e)
		{
			logError(this, "findDataAprobadorAntiguoSistema", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lca_data.isEmpty())
			lca_data = null;

		return lca_data;
	}

	/**
	 * Método encargado de obtener todos los turno_Historia con estado actividad AUT y estapa especifica.
	 *
	 * @param ab_etapa21o22AUT Variable de tipo <code> boolean </code> que parametriza la etapa a buscar
	 * @param al_limiteIntentos de al limite intentos
	 * @return devuelve el valor del objeto collection
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TurnoHistoria> findDataJobGenerarDocumentos(boolean ab_etapa21o22AUT, long al_limiteIntentos)
	    throws B2BException
	{
		return findDataJobGenerarDocumentos(
		    ab_etapa21o22AUT ? IdentificadoresCommon.ETAPAS_21_22 : IdentificadoresCommon.ETAPAS_40_41,
		    al_limiteIntentos
		);
	}

	/**
	 * Método encargado de obtener todos los turno_Historia con estado actividad AUT y estapa especifica.
	 *
	 * @param as_etapas de as etapas
	 * @param al_limiteIntentos de al limite intentos
	 * @return devuelve el valor del objeto collection
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public synchronized Collection<TurnoHistoria> findDataJobGenerarDocumentos(
	    String as_etapas, long al_limiteIntentos
	)
	    throws B2BException
	{
		Collection<TurnoHistoria> lcth_datos;
		PreparedStatement         lps_ps;
		ResultSet                 lrs_rs;

		lcth_datos     = new ArrayList<TurnoHistoria>();
		lps_ps         = null;
		lrs_rs         = null;

		try
		{
			StringBuilder lsb_sb;

			lsb_sb = new StringBuilder(cs_FIND_BY_DATA_JOB_GENERAR_DOCUMENTOS);

			lsb_sb.append(" AND TH.ID_ETAPA IN (");
			lsb_sb.append(as_etapas);
			lsb_sb.append(") AND NVL(TH.INTENTOS_FALLIDOS_EJECUCION_AUTOMATICA,0) < ?");

			if(StringUtils.isValidString(as_etapas) && as_etapas.equalsIgnoreCase(IdentificadoresCommon.ETAPAS_21_22))
				lsb_sb.append(
				    " AND EXISTS (SELECT 1 FROM SDB_ACC_TURNO T INNER JOIN SDB_ACC_SOLICITUD S ON (S.ID_SOLICITUD = TH.ID_SOLICITUD) WHERE T.ID_SOLICITUD = S.ID_SOLICITUD) "
				);

			lps_ps = getConnection().prepareStatement(lsb_sb.toString());

			lps_ps.setLong(1, al_limiteIntentos);

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
				lcth_datos.add(getTurnoHistoria(lrs_rs));
		}
		catch(SQLException lse_e)
		{
			logError(this, "findDataJobGenerarDocumentos", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Método encargado de consultar el detalle de un registro para un id turno historia y id etapa determinado.
	 *
	 * @param al_IdturnoHistoria Variable de tipo Long que contiene un id turno historia determinado.
	 * @param al_idEtapa Variable de tipo Long que contiene un id etapa determinado.
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findDataTurn(Long al_IdturnoHistoria, Long al_idEtapa)
	    throws B2BException
	{
		TurnoHistoria     lth_datos;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		lth_datos     = null;
		lps_ps        = null;
		lrs_rs        = null;

		try
		{
			int li_contador;
			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(cs_FIND_DATOS_TURN);

			setLong(lps_ps, al_IdturnoHistoria, li_contador++);
			setLong(lps_ps, al_idEtapa, li_contador++);

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lth_datos = datosTurno(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findDataTurn", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lth_datos;
	}

	/**
	 * Retorna el valor maximo del telefono.
	 *
	 * @param apd_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return devuelve el valor del objeto int
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public int findIdTelefono(TurnoHistoria apd_parametros)
	    throws B2BException
	{
		int               li_idCorreo;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		li_idCorreo     = 0;
		lps_ps          = null;
		lrs_rs          = null;

		try
		{
			lps_ps = getConnection().prepareStatement(cs_FIND_MAX_ID_TELEFONO);

			setLong(lps_ps, apd_parametros.getIdTurnoHistoria(), 1);

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				li_idCorreo = lrs_rs.getInt(1);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findIdCorreoElectronico", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return li_idCorreo;
	}

	/**
	 * Retorna el valor del objeto de tipo Collection Aprobacion filtrado por id documentos.
	 *
	 * @param as_idTurno correspondiente al valor del tipo de objeto String
	 * @return devuelve el valor del objeto collection de Aprobacion
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<Aprobacion> findIdsDocs(String as_idTurno)
	    throws B2BException
	{
		Collection<Aprobacion> lca_data;
		PreparedStatement      lps_ps;
		ResultSet              lrs_rs;
		int                    li_column;
		li_column     = 1;

		lca_data     = new ArrayList<Aprobacion>();
		lps_ps       = null;
		lrs_rs       = null;

		try
		{
			lps_ps = getConnection().prepareStatement(cs_ID_DOCUMENTOS);

			lps_ps.setString(li_column++, as_idTurno);

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
			{
				Aprobacion loa_data;
				loa_data = new Aprobacion();

				loa_data.setIdImage(getLong(lrs_rs, "ID_IMAGEN"));

				lca_data.add(loa_data);
			}
		}
		catch(SQLException lse_e)
		{
			logError(this, "findIdsDocs", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lca_data.isEmpty())
			lca_data = null;

		return lca_data;
	}

	/**
	 * Busca un registro asociado a un id solicitud que se encuentre en estado activo.
	 *
	 * @param as_idSolicitud Id de la solicitud a utilizar como filtro en la busqueda
	 * @return Turno historia resultante de la consulta.
	 * @throws B2BException Si ocurre un error en base de datos.
	 */
	public TurnoHistoria findLastBySolicitud(String as_idSolicitud)
	    throws B2BException
	{
		TurnoHistoria lth_return;

		lth_return = null;

		if(StringUtils.isValidString(as_idSolicitud))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_contador;
				StringBuilder lsb_query;

				li_contador     = 1;
				lsb_query       = new StringBuilder(cs_FIND_BY_SOLICITUD);

				lsb_query.append(" AND ESTADO_ACTIVIDAD = 'ASG' ");

				lps_ps = getConnection().prepareStatement(lsb_query.toString());

				lps_ps.setString(li_contador++, as_idSolicitud);

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					lth_return = getTurnoHistoria(lrs_rs);
			}
			catch(SQLException lse_e)
			{
				logError(this, "findLastBySolicitud", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lth_return;
	}

	/**
	 * Retorna el valor del objeto de tipo Find matriculas.
	 *
	 * @param as_idTurnoHist correspondiente al valor del tipo de objeto Long
	 * @return devuelve el valor del objeto collection
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TurnoHistoria> findMatriculas(Long as_idTurnoHist)
	    throws B2BException
	{
		Collection<TurnoHistoria> lca_data;
		PreparedStatement         lps_ps;
		TurnoHistoria             loa_data;
		ResultSet                 lrs_rs;
		int                       li_column;
		li_column     = 1;
		loa_data      = new TurnoHistoria();
		lca_data      = new ArrayList<TurnoHistoria>();
		lps_ps        = null;
		lrs_rs        = null;

		try
		{
			lps_ps = getConnection().prepareStatement(ConsultasUtilidades.CS_MATRICULAS_PREDIO);

			setLong(lps_ps, as_idTurnoHist, li_column++);

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
			{
				loa_data = new TurnoHistoria();
				loa_data.setMotivo(lrs_rs.getString("MATRICULA"));

				lca_data.add(loa_data);
			}
		}
		catch(SQLException lse_e)
		{
			logError(this, "findMatriculas", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lca_data.isEmpty())
			lca_data = null;

		return lca_data;
	}

	/**
	 * Find max by id etapa.
	 *
	 * @param al_idEtapa de al id etapa
	 * @param as_idSolicitud de as id solicitud
	 * @return el valor de turno historia
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public TurnoHistoria findMaxByIdEtapa(long al_idEtapa, String as_idSolicitud)
	    throws B2BException
	{
		return findMaxByIdEtapa(al_idEtapa, as_idSolicitud, null, -1L);
	}

	/**
	 * Find max by id etapa.
	 *
	 * @param al_idEtapa de al id etapa
	 * @param as_idSolicitud de as id solicitud
	 * @param as_idTurno de as id turno
	 * @param al_idMotivo de al id motivo
	 * @return el valor de turno historia
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public TurnoHistoria findMaxByIdEtapa(long al_idEtapa, String as_idSolicitud, String as_idTurno, long al_idMotivo)
	    throws B2BException
	{
		TurnoHistoria lth_return;

		lth_return = null;

		if((al_idEtapa > 0) && (StringUtils.isValidString(as_idSolicitud) || StringUtils.isValidString(as_idTurno)))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_cont;
				StringBuilder lsb_query;

				li_cont       = 1;
				lsb_query     = new StringBuilder(cs_FIND_MAX_BY_ID_ETAPA);

				if(StringUtils.isValidString(as_idSolicitud))
					lsb_query.append(" AND ID_SOLICITUD = ? ");
				else
					lsb_query.append(" AND ID_TURNO = ? ");

				if(al_idMotivo > NumericUtils.DEFAULT_LONG_VALUE)
					lsb_query.append(" AND ID_MOTIVO = ? ");

				lsb_query.append("ORDER BY ID_TURNO_HISTORIA DESC");

				lps_ps = getConnection().prepareStatement(lsb_query.toString());

				lps_ps.setLong(li_cont++, al_idEtapa);

				if(StringUtils.isValidString(as_idSolicitud))
					lps_ps.setString(li_cont++, as_idSolicitud);
				else
					lps_ps.setString(li_cont++, as_idTurno);

				if(al_idMotivo > NumericUtils.DEFAULT_LONG_VALUE)
					lps_ps.setLong(li_cont++, al_idMotivo);

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					lth_return = getTurnoHistoria(lrs_rs);
			}
			catch(SQLException lse_e)
			{
				logError(this, "findMaxByIdEtapa", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lth_return;
	}

	/**
	 * Find max by id etapa id turno.
	 *
	 * @param al_idEtapa de al id etapa
	 * @param as_idTurno de as id turno
	 * @return el valor de turno historia
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public TurnoHistoria findMaxByIdEtapaIdTurno(long al_idEtapa, String as_idTurno)
	    throws B2BException
	{
		return findMaxByIdEtapa(al_idEtapa, null, as_idTurno, -1L);
	}

	/**
	 * Find max by id etapa id turno id motivo.
	 *
	 * @param al_idEtapa de al id etapa
	 * @param as_idTurno de as id turno
	 * @param al_idMotivo de al id motivo
	 * @return el valor de turno historia
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public TurnoHistoria findMaxByIdEtapaIdTurnoIdMotivo(long al_idEtapa, String as_idTurno, long al_idMotivo)
	    throws B2BException
	{
		return findMaxByIdEtapa(al_idEtapa, null, as_idTurno, al_idMotivo);
	}

	/**
	 * Find max by id turno etapa.
	 *
	 * @param al_idEtapa de al id etapa
	 * @param as_idTurno de as id turno
	 * @return el valor de long
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public long findMaxByIdTurnoEtapa(long al_idEtapa, String as_idTurno)
	    throws B2BException
	{
		long ll_idTurnoHistoria;

		ll_idTurnoHistoria = 0;

		if((al_idEtapa > 0) || StringUtils.isValidString(as_idTurno))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_cont;
				StringBuilder lsb_query;

				li_cont       = 1;
				lsb_query     = new StringBuilder(cs_FIND_MAX_BY_ID_TURNO_ETAPA);

				lps_ps = getConnection().prepareStatement(lsb_query.toString());

				lps_ps.setLong(li_cont++, al_idEtapa);

				lps_ps.setString(li_cont++, as_idTurno);

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					ll_idTurnoHistoria = NumericUtils.getLong(getLong(lrs_rs, "ID_TURNO_HISTORIA"));
			}
			catch(SQLException lse_e)
			{
				logError(this, "findMaxByIdTurnoEtapa", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return ll_idTurnoHistoria;
	}

	/**
	 * Método encargado de retornar los procesos de una etapa en estado ASG, BLQ.
	 *
	 * @param al_idEtapa Argumento de tipo <code>Long</code> que contiene los criterios necesarios para realizar la consulta.
	 * @return Retorna los procesos de una etapa en estado ASG, BLQ.
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<Proceso> findProcesosByIdEtapa(Long al_idEtapa)
	    throws B2BException
	{
		Collection<Proceso> lcp_procesos;
		PreparedStatement   lps_ps;
		ResultSet           lrs_rs;

		lcp_procesos     = new LinkedList<Proceso>();
		lps_ps           = null;
		lrs_rs           = null;

		try
		{
			if(al_idEtapa != null)
			{
				int li_count;

				li_count     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_PROCESOS_BY_ID_ETAPA);

				setLong(lps_ps, al_idEtapa, li_count++);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
				{
					Proceso lp_proceso;

					lp_proceso = new Proceso();

					lp_proceso.setIdProceso(lrs_rs.getString(1));
					lp_proceso.setNombre(lrs_rs.getString(2));

					lcp_procesos.add(lp_proceso);
				}
			}
		}
		catch(SQLException lse_e)
		{
			logError(this, "findProcesosByIdEtapa", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lcp_procesos.isEmpty())
			lcp_procesos = null;

		return lcp_procesos;
	}

	/**
	 * Retorna el valor de la secuencia.
	 *
	 * @return devuelve el valor del objeto int
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public int findSecuence()
	    throws B2BException
	{
		int               li_secuencia;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		li_secuencia     = 0;
		lps_ps           = null;
		lrs_rs           = null;

		try
		{
			lps_ps     = getConnection().prepareStatement(cs_FIND_SECUENCE);

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				li_secuencia = lrs_rs.getInt(1);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findSecuence", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return li_secuencia;
	}

	/**
	 * Retorna el valor del objeto de tipo Find secuence nota devolutiva.
	 *
	 * @return devuelve el valor del objeto int
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public int findSecuenceNotaDevolutiva()
	    throws B2BException
	{
		int               li_secuencia;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		li_secuencia     = 0;
		lps_ps           = null;
		lrs_rs           = null;

		try
		{
			lps_ps     = getConnection().prepareStatement(cs_FIND_SECUENCE_NOTA_DEVOLUTIVA);

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				li_secuencia = lrs_rs.getInt(1);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findSecuence", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return li_secuencia;
	}

	/**
	 * Retorna el valor del objeto de turno derivado.
	 *
	 * @param as_Idturno correspondiente al valor del tipo de objeto String
	 * @return devuelve el valor del objeto string
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public String findTurnoDerivado(String as_Idturno)
	    throws B2BException
	{
		String            li_secuencia;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		li_secuencia     = null;
		lps_ps           = null;
		lrs_rs           = null;

		try
		{
			lps_ps = getConnection().prepareStatement(cs_FIND_TURNO_DERIVADO);
			lps_ps.setString(1, as_Idturno);
			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				li_secuencia = lrs_rs.getString(1);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findTurnoDerivado", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return li_secuencia;
	}

	/**
	 * Obtiene la cantidad de turnos en algun estado pre establecido.
	 *
	 * @param as_estado id del estado el cual se va a consultar
	 * @param as_idUsuario id del usuario que tiene los turnos asignados
	 * @param al_idEtapa id de la etapa en la cual se encuentran los turnos
	 * @param as_tramite motivo tramite al cula pertenece el turno
	 * @return Número de casos encontrados en la busqueda
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Integer findTurnosCantidad(String as_estado, String as_idUsuario, long al_idEtapa, String as_tramite)
	    throws B2BException
	{
		return findTurnosCantidad(as_estado, as_idUsuario, al_idEtapa, as_tramite, false);
	}

	/**
	 * Obtiene la cantidad de turnos en algun estado pre establecido.
	 *
	 * @param as_estado id del estado el cual se va a consultar
	 * @param as_idUsuario id del usuario que tiene los turnos asignados
	 * @param al_idEtapa id de la etapa en la cual se encuentran los turnos
	 * @param as_tramite motivo tramite al cula pertenece el turno
	 * @param ab_bandejaSubprocesos Indica si se debe buscar por motivo no tramite o por nombre de subproceso
	 * @return Número de casos encontrados en la busqueda
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Integer findTurnosCantidad(
	    String as_estado, String as_idUsuario, long al_idEtapa, String as_tramite, boolean ab_bandejaSubprocesos
	)
	    throws B2BException
	{
		Integer           lth_datos;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;
		StringBuilder     lsb_sb;

		lth_datos     = null;
		lps_ps        = null;
		lrs_rs        = null;
		lsb_sb        = new StringBuilder();

		try
		{
			boolean ab_tramite;
			int     li_contador;

			ab_tramite      = StringUtils.isValidString(as_tramite);
			li_contador     = 1;

			if(ab_tramite)
			{
				if(ab_bandejaSubprocesos)
					lsb_sb.append(cs_FIND_COUNT_BY_USER_ETAPA_ESTADO_TRAMITE_SUBPROCESO);
				else
					lsb_sb.append(cs_FIND_COUNT_BY_USER_ETAPA_ESTADO_TRAMITE);
			}
			else
				lsb_sb.append(cs_FIND_COUNT_BY_USER_ETAPA_ESTADO);

			if(as_estado.equalsIgnoreCase(EstadoCommon.TERMINADA))
				lsb_sb.append("AND TO_CHAR(FECHA_FINAL,'YYYY/MM/DD') =  TO_CHAR(SYSTIMESTAMP,'YYYY/MM/DD') ");

			lps_ps = getConnection().prepareStatement(lsb_sb.toString());

			lps_ps.setString(li_contador++, as_idUsuario);
			setLong(lps_ps, NumericUtils.getLongWrapper(al_idEtapa), li_contador++);
			lps_ps.setString(li_contador++, as_estado);

			if(ab_tramite)
				lps_ps.setString(li_contador++, as_tramite);

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lth_datos = getInteger(lrs_rs, "CANTIDAD");
		}
		catch(SQLException lse_e)
		{
			logError(this, "findTurnosCantidad", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lth_datos;
	}

	/**
	 * Obtiene la cantidad de turnos para cualquier usuario.
	 *
	 * @param as_estado id del estado el cual se va a consultar
	 * @param al_idEtapa id de la etapa en la cual se encuentran los turnos
	 * @return Número de casos encontrados en la busqueda
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Integer findTurnosCantidadForAllUsers(String as_estado, long al_idEtapa)
	    throws B2BException
	{
		Integer           lth_datos;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;
		String            ls_query;

		lth_datos     = null;
		lps_ps        = null;
		lrs_rs        = null;

		try
		{
			int li_contador;

			li_contador     = 1;

			ls_query     = cs_FIND_COUNT_BY_ETAPA_ESTADO;

			lps_ps = getConnection().prepareStatement(ls_query);

			setLong(lps_ps, NumericUtils.getLongWrapper(al_idEtapa), li_contador++);
			lps_ps.setString(li_contador++, as_estado);

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lth_datos = getInteger(lrs_rs, "CANTIDAD");
		}
		catch(SQLException lse_e)
		{
			logError(this, "findTurnosCantidadForAllUsers", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo turnos derivados.
	 *
	 * @param as_idTurno correspondiente al valor del tipo de objeto String
	 * @param ab_indVinculado correspondiente al valor del tipo de objeto boolean
	 * @param ab_indHijo correspondiente al valor del tipo de objeto boolean
	 * @return devuelve el valor del objeto collection de Aprobacion
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<Aprobacion> findTurnosDerivados(String as_idTurno, boolean ab_indVinculado, boolean ab_indHijo)
	    throws B2BException
	{
		Collection<Aprobacion> lca_data;
		PreparedStatement      lps_ps;
		ResultSet              lrs_rs;
		String                 ls_query;
		int                    li_column;

		li_column     = 1;
		lca_data      = new ArrayList<Aprobacion>();
		lps_ps        = null;
		lrs_rs        = null;
		ls_query      = cs_TURNOS_DERIVADOS;

		try
		{
			if(ab_indVinculado)
			{
				StringBuilder lsb_sb;
				lsb_sb = new StringBuilder(cs_TURNOS_DERIVADOS_VINCULACION);

				if(ab_indHijo)
					lsb_sb.append(
					    " INNER JOIN  SDB_ACC_SOLICITUD_ASOCIADA ASA ON ASA.ID_SOLICITUD = S.ID_SOLICITUD AND ASA.INDICADOR_VINCULADO = 'S'"
					);
				else
					lsb_sb.append(
					    " INNER JOIN  SDB_ACC_SOLICITUD_ASOCIADA ASA ON ASA.ID_SOLICITUD = S.ID_SOLICITUD AND ASA.INDICADOR_VINCULADO <> 'S'"
					);

				lsb_sb.append(" WHERE TD.ID_TURNO_PADRE =?");

				ls_query = lsb_sb.toString();
			}

			lps_ps = getConnection().prepareStatement(ls_query);

			lps_ps.setString(li_column++, as_idTurno);

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
			{
				Aprobacion loa_data;
				String     ls_idProceso;

				loa_data         = new Aprobacion();
				ls_idProceso     = null;

				loa_data.setTurnosAsociados(lrs_rs.getString("ID_TURNO_HIJO"));

				if(ab_indVinculado)
					ls_idProceso = lrs_rs.getString("ID_PROCESO_HIJO");

				loa_data.setIdProceso(ls_idProceso);
				lca_data.add(loa_data);
			}
		}
		catch(SQLException lse_e)
		{
			logError(this, "findTurnosDerivados", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lca_data.isEmpty())
			lca_data = null;

		return lca_data;
	}

	/**
	 * Retorna el valor del objeto de tipo turnos derivados con indicador vinculado.
	 *
	 * @param as_idTurno correspondiente al valor del tipo de objeto String
	 * @return devuelve el valor del objeto collection de Aprobacion
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<Aprobacion> findTurnosDerivadosConIndicadorVinculado(String as_idTurno)
	    throws B2BException
	{
		Collection<Aprobacion> lca_data;
		PreparedStatement      lps_ps;

		ResultSet lrs_rs;
		int       li_column;
		li_column = 1;

		String ls_query;

		lca_data     = new ArrayList<Aprobacion>();
		lps_ps       = null;
		lrs_rs       = null;
		ls_query     = cs_TURNOS_DERIVADOS_CON_INDICADOR_VINCULADO;

		try
		{
			lps_ps = getConnection().prepareStatement(ls_query);

			lps_ps.setString(li_column++, as_idTurno);

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
			{
				Aprobacion loa_data;

				loa_data = new Aprobacion();

				loa_data.setTurnosAsociados(lrs_rs.getString("ID_TURNO_HIJO"));
				lca_data.add(loa_data);
			}
		}
		catch(SQLException lse_e)
		{
			logError(this, "findTurnosDerivadosConIndicadorVinculado", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lca_data.isEmpty())
			lca_data = null;

		return lca_data;
	}

	/**
	 * Retorna el valor del objeto de tipo Find turnos derivados no vinculados.
	 *
	 * @param as_idTurno correspondiente al valor del tipo de objeto String
	 * @return devuelve el valor del objeto collection de Aprobacion
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<Aprobacion> findTurnosDerivadosNoVinculados(String as_idTurno)
	    throws B2BException
	{
		Collection<Aprobacion> lca_data;
		PreparedStatement      lps_ps;
		ResultSet              lrs_rs;
		int                    li_column;

		li_column     = 1;
		lca_data      = new ArrayList<Aprobacion>();
		lps_ps        = null;
		lrs_rs        = null;

		try
		{
			lps_ps = getConnection().prepareStatement(cs_TURNOS_DERIVADOS_NO_VINCULADOS);

			lps_ps.setString(li_column++, as_idTurno);

			lrs_rs = lps_ps.executeQuery();

			while(lrs_rs.next())
			{
				Aprobacion loa_data;

				loa_data = new Aprobacion();

				loa_data.setTurnosAsociados(lrs_rs.getString("ID_TURNO_HIJO"));
				lca_data.add(loa_data);
			}
		}
		catch(SQLException lse_e)
		{
			logError(this, "findTurnosDerivadosNoVinculados", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lca_data.isEmpty())
			lca_data = null;

		return lca_data;
	}

	/**
	 * Find ultimo registro terminado by turno.
	 *
	 * @param as_idTurno de as id turno
	 * @return el valor de turno historia
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public TurnoHistoria findUltimoRegistroTerminadoByTurno(String as_idTurno)
	    throws B2BException
	{
		TurnoHistoria lth_th;

		lth_th = null;

		if(StringUtils.isValidString(as_idTurno))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;

				li_contador     = 1;

				lps_ps = getConnection().prepareStatement(cs_FIND_LAST_IN_TER);

				lps_ps.setString(li_contador++, as_idTurno);

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
					lth_th = getTurnoHistoria(lrs_rs);
			}
			catch(SQLException lse_e)
			{
				logError(this, "findUltimoRegistroTerminadoByTurno", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lth_th;
	}

	/**
	 * Método para obtener el último registro de la tabla SDB_PGN_MOTIVO_TRAMITE con ESTADO_ACTIVIDAD terminado.
	 *
	 * @param at_t correspondiente al valor del tipo de objeto Trazabilidad
	 * @return devuelve el valor del objeto turno historia
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public TurnoHistoria findUltimoRegistroTerminadoByTurno(Trazabilidad at_t)
	    throws B2BException
	{
		TurnoHistoria     lmt_mt;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		lmt_mt     = null;
		lps_ps     = null;
		lrs_rs     = null;

		try
		{
			int li_contador;

			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(cs_FIND_LAST_IN_TER);

			{
				Turno lt_turno;

				lt_turno = at_t.getTurno();

				if(lt_turno != null)
					lps_ps.setString(li_contador++, lt_turno.getIdTurno());
			}

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lmt_mt = getTurnoHistoria(lrs_rs);
		}
		catch(SQLException lse_e)
		{
			logError(this, "findUltimoRegistroTerminadoByTurno", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lmt_mt;
	}

	/**
	 * Inserta un nuevo registro de correccion.
	 *
	 * @param aoc_datos correspondiente al valor del tipo de objeto Calificacion
	 * @param as_userId correspondiente al valor del tipo de objeto String
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public void insertInfoCorreccion(Calificacion aoc_datos, String as_userId)
	    throws B2BException
	{
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;
		int               li_column;
		li_column     = 1;

		lps_ps     = null;
		lrs_rs     = null;

		try
		{
			lps_ps = getConnection().prepareStatement(cs_INSERT_CHEKS);

			lps_ps.setString(li_column++, aoc_datos.getIdSolicitud());
			setLong(lps_ps, aoc_datos.getIdTurnoHistoria(), li_column++);
			lps_ps.setString(li_column++, aoc_datos.getCampo());
			lps_ps.setString(li_column++, as_userId);

			lps_ps.executeUpdate();
		}
		catch(SQLException lse_e)
		{
			logError(this, "insertInfoCorreccion", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}
	}

	/**
	 * Inserta o actualiza el registro en la tabla.
	 *
	 * @param apt_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @param ab_query correspondiente al valor del tipo de objeto boolean
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public void insertOrUpdate(TurnoHistoria apt_parametros, boolean ab_query)
	    throws B2BException
	{
		if(apt_parametros != null)
		{
			PreparedStatement lps_ps;
			lps_ps = null;

			try
			{
				int li_column;

				li_column     = 1;
				lps_ps        = getConnection().prepareStatement(ab_query ? cs_INSERT : cs_UPDATE);

				if(ab_query)
					setLong(lps_ps, apt_parametros.getIdTurnoHistoria(), li_column++);

				lps_ps.setString(li_column++, apt_parametros.getIdTurno());
				lps_ps.setString(li_column++, apt_parametros.getIdSolicitud());
				lps_ps.setBigDecimal(li_column++, apt_parametros.getIdEtapa());
				lps_ps.setString(li_column++, apt_parametros.getIdUsuario());
				lps_ps.setString(li_column++, apt_parametros.getIdCirculoUsuario());
				lps_ps.setString(li_column++, apt_parametros.getIndicadorDevolucion());
				lps_ps.setString(li_column++, apt_parametros.getEstadoActividad());
				lps_ps.setTimestamp(li_column++, DateUtils.getTimestamp(apt_parametros.getFechaReparto()));

				if(!ab_query)
				{
					if(apt_parametros.getFechaInicial() != null)
						lps_ps.setTimestamp(li_column++, DateUtils.getTimestamp(apt_parametros.getFechaInicial()));
					else
						lps_ps.setTimestamp(li_column++, DateUtils.getTimestamp());
				}

				lps_ps.setString(li_column++, apt_parametros.getCalificacion());
				lps_ps.setString(li_column++, apt_parametros.getMotivo());
				lps_ps.setString(li_column++, apt_parametros.getObservaciones());
				lps_ps.setString(li_column++, apt_parametros.getJustificacion());
				lps_ps.setString(li_column++, apt_parametros.getObservacionesNoTramite());
				lps_ps.setBigDecimal(li_column++, apt_parametros.getIdAnterior());
				lps_ps.setString(li_column++, apt_parametros.getIdProceso());

				if(ab_query)
				{
					lps_ps.setString(li_column++, apt_parametros.getIdUsuarioCreacion());
					lps_ps.setString(li_column++, apt_parametros.getIpCreacion());
				}
				else
				{
					lps_ps.setString(li_column++, apt_parametros.getIdUsuarioModificacion());
					lps_ps.setString(li_column++, apt_parametros.getIpModificacion());
				}

				setLong(lps_ps, apt_parametros.getIdMotivo(), li_column++);
				lps_ps.setString(li_column++, apt_parametros.getGenerarRelacion());
				lps_ps.setString(li_column++, apt_parametros.getNumeroRelacion());
				lps_ps.setString(li_column++, apt_parametros.getIdSubproceso());
				setLong(lps_ps, apt_parametros.getVersionSubproceso(), li_column++);

				if(!ab_query)
					setLong(lps_ps, apt_parametros.getIdTurnoHistoria(), li_column++);

				lps_ps.executeUpdate();
			}
			catch(SQLException lse_e)
			{
				logError(this, "insertOrUpdate", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lps_ps);
			}
		}
	}

	/**
	 * Obtiene los tramites diferenciados por subproceso de cuenta cupos.
	 *
	 * @param atc_parametros objeto contenedor de los parametros a utilziar como filtro en la consulta
	 * @return Colección resultante de la busqueda
	 * @throws B2BException Si ocurre un error en base de datos
	 */
	public Collection<TramiteCantidad> obtenerBandejaCuentaCupo(TramiteCantidad atc_parametros)
	    throws B2BException
	{
		Collection<TramiteCantidad> lctc_turnos;

		lctc_turnos = new LinkedList<TramiteCantidad>();

		if(atc_parametros != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_cont;
				StringBuilder lsb_query;
				String        ls_nir;
				String        ls_turno;
				boolean       lb_conNir;
				boolean       lb_conTurno;

				li_cont         = 1;
				lsb_query       = new StringBuilder(cs_FIND_BANDEJA_CUENTA_CUPO);
				ls_nir          = atc_parametros.getNir();
				ls_turno        = atc_parametros.getIdTurno();
				lb_conNir       = StringUtils.isValidString(ls_nir);
				lb_conTurno     = StringUtils.isValidString(ls_turno);

				if(lb_conNir)
					lsb_query.append(" AND S.NIR = ? ");

				if(lb_conTurno)
					lsb_query.append(" AND T.ID_TURNO = ? ");

				lsb_query.append(" GROUP BY MT.DESCRIPCION, TH.ID_ETAPA, MT.ID_MOTIVO, TH.ID_SUBPROCESO ");

				lps_ps = getConnection().prepareStatement(lsb_query.toString());

				lps_ps.setString(li_cont++, atc_parametros.getUsuario());

				if(lb_conNir)
					lps_ps.setString(li_cont++, ls_nir);

				if(lb_conTurno)
					lps_ps.setString(li_cont++, ls_turno);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lctc_turnos.add(getTramiteCuentaCupos(lrs_rs, false));
			}
			catch(SQLException lse_e)
			{
				logError(this, "obtenerBandejaCuentaCupo", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}

			if(lctc_turnos.isEmpty())
				lctc_turnos = null;
		}

		return lctc_turnos;
	}

	/**
	 * Obtiene los tramites diferenciados por subproceso de cuenta cupos.
	 *
	 * @param atc_parametros objeto contenedor de los parametros a utilziar como filtro en la consulta
	 * @return Colección resultante de la busqueda
	 * @throws B2BException Si ocurre un error en base de datos
	 */
	public Collection<TramiteCantidad> obtenerBandejaDetalleCuentaCupo(TramiteCantidad atc_parametros)
	    throws B2BException
	{
		Collection<TramiteCantidad> lctc_turnos;

		lctc_turnos = new LinkedList<TramiteCantidad>();

		if(atc_parametros != null)
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int           li_cont;
				StringBuilder lsb_query;
				String        ls_nir;
				String        ls_turno;
				boolean       lb_conNir;
				boolean       lb_conTurno;

				li_cont         = 1;
				lsb_query       = new StringBuilder(cs_FIND_BANDEJA_DETALLE_CUENTA_CUPO);
				ls_nir          = atc_parametros.getNir();
				ls_turno        = atc_parametros.getIdTurno();
				lb_conNir       = StringUtils.isValidString(ls_nir);
				lb_conTurno     = StringUtils.isValidString(ls_turno);

				if(lb_conNir)
					lsb_query.append(" AND S.NIR = ? ");

				if(lb_conTurno)
					lsb_query.append(" AND T.ID_TURNO = ? ");

				lsb_query.append(
				    " GROUP BY S.NIR, T.ID_TURNO, (SAEE.ID_DOCUMENTO_TIPO || ' ' || SAEE.NUMERO_DOCUMENTO), SAEE.NOMBRE, S.FECHA_CREACION, TH1.OBSERVACIONES, TH.ID_TURNO_HISTORIA "
				);

				lps_ps = getConnection().prepareStatement(lsb_query.toString());

				lps_ps.setString(li_cont++, atc_parametros.getIdSubProceso());
				lps_ps.setString(li_cont++, atc_parametros.getUsuario());

				if(lb_conNir)
					lps_ps.setString(li_cont++, ls_nir);

				if(lb_conTurno)
					lps_ps.setString(li_cont++, ls_turno);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lctc_turnos.add(getTramiteCuentaCupos(lrs_rs, true));
			}
			catch(SQLException lse_e)
			{
				logError(this, "obtenerBandejaDetalleCuentaCupo", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}

			if(lctc_turnos.isEmpty())
				lctc_turnos = null;
		}

		return lctc_turnos;
	}

	/**
	 * Retorna el valor del objeto correspondiente al ID del registro guardado.
	 *
	 * @param aotc_otc correspondiente al valor del tipo de objeto TipoCausal
	 * @param ath_turnoHistoria correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return devuelve el valor del objeto string
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public String saveTipoCausal(TipoCausal aotc_otc, TurnoHistoria ath_turnoHistoria)
	    throws B2BException
	{
		String            lp_return;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;
		int               li_column;
		li_column     = 1;

		lp_return     = null;
		lps_ps        = null;
		lrs_rs        = null;

		try
		{
			lps_ps = getConnection().prepareStatement(cs_SAVE_TIPOS_CAUSALES);

			lps_ps.setString(li_column++, aotc_otc.getSecuence());
			lps_ps.setString(li_column++, ath_turnoHistoria.getIdTurno());
			lps_ps.setLong(li_column++, NumericUtils.getLong(ath_turnoHistoria.getIdTurnoHistoria()));
			lps_ps.setString(li_column++, aotc_otc.getIdTipoCausal());
			lps_ps.setString(li_column++, aotc_otc.getUserId());

			lps_ps.executeUpdate();
		}
		catch(SQLException lse_e)
		{
			logError(this, "saveTipoCausal", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lp_return;
	}

	/**
	 * Tiene etapa.
	 *
	 * @param as_idTurno de as id turno
	 * @param as_idEtapa de as id etapa
	 * @return retorna <code>true</code> si se cumple la condicion, de lo contario retorna <code>false</code>
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public boolean tieneEtapa(String as_idTurno, long as_idEtapa)
	    throws B2BException
	{
		boolean lb_return;

		lb_return = false;

		if(StringUtils.isValidString(as_idTurno))
		{
			PreparedStatement lps_ps;
			ResultSet         lrs_rs;

			lps_ps     = null;
			lrs_rs     = null;

			try
			{
				int li_contador;

				li_contador     = 1;
				lps_ps          = getConnection().prepareStatement(cs_HAS_STAGE);

				lps_ps.setString(li_contador++, as_idTurno);
				lps_ps.setLong(li_contador++, as_idEtapa);

				lrs_rs = lps_ps.executeQuery();

				if(lrs_rs.next())
				{
					int li_conteo;

					li_conteo     = lrs_rs.getInt("CONTEO");

					lb_return = li_conteo > 0;
				}
			}
			catch(SQLException lse_e)
			{
				logError(this, "pasoPorEtapa", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lrs_rs);
				close(lps_ps);
			}
		}

		return lb_return;
	}

	/**
	 * Retorna el valor del objeto de tipo Turnos en Prohibiciones.
	 *
	 * @param at_t correspondiente al valor del tipo de objeto Turno
	 * @param al_idMotivo correspondiente al valor del tipo de objeto long
	 * @return devuelve el valor del objeto collection de TramiteCantidad
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TramiteCantidad> turnosProhibiciones(Turno at_t, long al_idMotivo)
	    throws B2BException
	{
		Collection<TramiteCantidad> lcth_datos;
		PreparedStatement           lps_ps;
		ResultSet                   lrs_rs;
		StringBuilder               lsb_query;
		boolean                     lb_b;
		String                      ls_nir;
		String                      ls_turno;

		lcth_datos     = new ArrayList<TramiteCantidad>();
		lps_ps         = null;
		lrs_rs         = null;
		lsb_query      = new StringBuilder(cs_BANDEJA_CALIFICACION_PROHIBICIONES);
		lb_b           = al_idMotivo > 0;

		try
		{
			if(at_t != null)
			{
				int li_contador;

				li_contador     = 1;
				ls_nir          = at_t.getNir();
				ls_turno        = at_t.getIdTurno();

				if(lb_b)
				{
					lsb_query = new StringBuilder(cs_DETALLE_BANDEJA_CALIFICACION);

					lsb_query.append(
					    " INNER JOIN  SDB_ACC_ACTO ASA ON ASA.ID_SOLICITUD = S.ID_SOLICITUD AND ASA.ID_TIPO_ACTO = '0463'"
					    + " WHERE TH.ID_ETAPA = ?  AND TH.ID_USUARIO = ?  AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') "
					);

					lsb_query.append(" AND TH1.ID_MOTIVO = ? AND TH1.ID_ETAPA = ? ");
				}

				if(StringUtils.isValidString(ls_nir))
					lsb_query.append(" AND S.NIR = ? ");

				if(StringUtils.isValidString(ls_turno))
					lsb_query.append(" AND T.ID_TURNO = ?  ");

				if(!lb_b)
					lsb_query.append("  GROUP BY MT.DESCRIPCION,TH.ID_ETAPA, MT.ID_MOTIVO, TH1.ID_ETAPA ,AP.NOMBRE ");

				lps_ps = getConnection().prepareStatement(lsb_query.toString());

				setLong(lps_ps, at_t.getIdEtapaActual(), li_contador++);

				lps_ps.setString(li_contador++, at_t.getIdUsuarioCreacion());

				if(lb_b)
				{
					lps_ps.setLong(li_contador++, al_idMotivo);
					lps_ps.setLong(li_contador++, at_t.getIdEtapaAnt());
				}

				if(StringUtils.isValidString(ls_nir))
					lps_ps.setString(li_contador++, ls_nir);

				if(StringUtils.isValidString(ls_turno))
					lps_ps.setString(li_contador++, ls_turno);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getTramiteEntidad(lrs_rs, lb_b, true));
			}
		}
		catch(SQLException lse_e)
		{
			logError(this, "turnosVinculados", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo Turnos vinculados.
	 *
	 * @param at_t correspondiente al valor del tipo de objeto Turno
	 * @param al_idMotivo correspondiente al valor del tipo de objeto long
	 * @return devuelve el valor del objeto collection de TramiteCantidad
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public Collection<TramiteCantidad> turnosVinculados(Turno at_t, long al_idMotivo)
	    throws B2BException
	{
		Collection<TramiteCantidad> lcth_datos;
		PreparedStatement           lps_ps;
		ResultSet                   lrs_rs;
		StringBuilder               lsb_query;
		boolean                     lb_b;
		String                      ls_nir;
		String                      ls_turno;

		lcth_datos     = new ArrayList<TramiteCantidad>();
		lps_ps         = null;
		lrs_rs         = null;
		lsb_query      = new StringBuilder(cs_BANDEJA_CALIFICACION_VINCULACIONES);
		lb_b           = al_idMotivo > 0;

		try
		{
			if(at_t != null)
			{
				int li_contador;

				li_contador     = 1;
				ls_nir          = at_t.getNir();
				ls_turno        = at_t.getIdTurno();

				if(lb_b)
				{
					lsb_query = new StringBuilder(cs_DETALLE_BANDEJA_CALIFICACION);

					lsb_query.append(
					    " INNER JOIN  SDB_ACC_SOLICITUD_ASOCIADA ASA ON ASA.ID_SOLICITUD = S.ID_SOLICITUD AND ASA.INDICADOR_VINCULADO = 'S'"
					    + " WHERE TH.ID_ETAPA = ?  AND TH.ID_USUARIO = ?  AND TH.ESTADO_ACTIVIDAD IN ('ASG', 'BLQ') "
					);

					lsb_query.append(" AND TH1.ID_MOTIVO = ? AND TH1.ID_ETAPA = ? ");
				}

				if(StringUtils.isValidString(ls_nir))
					lsb_query.append(" AND S.NIR = ? ");

				if(StringUtils.isValidString(ls_turno))
					lsb_query.append(" AND T.ID_TURNO = ?  ");

				if(!lb_b)
					lsb_query.append("  GROUP BY MT.DESCRIPCION,TH.ID_ETAPA, MT.ID_MOTIVO, TH1.ID_ETAPA ,AP.NOMBRE ");

				lps_ps = getConnection().prepareStatement(lsb_query.toString());

				setLong(lps_ps, at_t.getIdEtapaActual(), li_contador++);

				lps_ps.setString(li_contador++, at_t.getIdUsuarioCreacion());

				if(lb_b)
				{
					lps_ps.setLong(li_contador++, al_idMotivo);
					lps_ps.setLong(li_contador++, at_t.getIdEtapaAnt());
				}

				if(StringUtils.isValidString(ls_nir))
					lps_ps.setString(li_contador++, ls_nir);

				if(StringUtils.isValidString(ls_turno))
					lps_ps.setString(li_contador++, ls_turno);

				lrs_rs = lps_ps.executeQuery();

				while(lrs_rs.next())
					lcth_datos.add(getTramiteEntidad(lrs_rs, lb_b, true));
			}
		}
		catch(SQLException lse_e)
		{
			logError(this, "turnosVinculados", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		if(lcth_datos.isEmpty())
			lcth_datos = null;

		return lcth_datos;
	}

	/**
	 * Metodo encargado de actualizar la calificación del turno historia.
	 *
	 * @param ath_parametros Argumento de tipo <code>TurnoHistoria</code> que contiene
	 * los criterios necesarios para realizar la actualización.
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public void updateCalificacion(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		if(ath_parametros != null)
		{
			PreparedStatement lps_ps;
			lps_ps = null;

			try
			{
				int li_column;

				li_column     = 1;
				lps_ps        = getConnection().prepareStatement(cs_UPDATE_CALIFICACION);

				lps_ps.setString(li_column++, ath_parametros.getCalificacion());
				lps_ps.setString(li_column++, ath_parametros.getIdUsuarioModificacion());
				lps_ps.setString(li_column++, ath_parametros.getIpModificacion());
				setLong(lps_ps, ath_parametros.getIdTurnoHistoria(), li_column++);

				lps_ps.executeUpdate();
			}
			catch(SQLException lse_e)
			{
				logError(this, "updateCalificacion", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lps_ps);
			}
		}
	}

	/**
	 * Update estado actividad.
	 *
	 * @param ath_parametros de ath parametros
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public void updateEstadoActividad(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		if(ath_parametros != null)
		{
			PreparedStatement lps_ps;
			lps_ps = null;

			try
			{
				int li_column;

				li_column     = 1;
				lps_ps        = getConnection().prepareStatement(cs_UPDATE_ESTADO_ACTIVIDAD);

				lps_ps.setString(li_column++, ath_parametros.getEstadoActividad());
				lps_ps.setString(li_column++, ath_parametros.getIdUsuarioModificacion());
				lps_ps.setString(li_column++, ath_parametros.getIpModificacion());
				setLong(lps_ps, ath_parametros.getIdTurnoHistoria(), li_column++);

				lps_ps.executeUpdate();
			}
			catch(SQLException lse_e)
			{
				logError(this, "updateEstadoActividad", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lps_ps);
			}
		}
	}

	/**
	 * Actualiza fecha inicial.
	 *
	 * @param apt_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public void updateFechaInicial(TurnoHistoria apt_parametros)
	    throws B2BException
	{
		PreparedStatement lps_ps;
		lps_ps = null;

		int li_column;

		if(apt_parametros != null)
		{
			try
			{
				li_column     = 1;
				lps_ps        = getConnection().prepareStatement(cs_UPDATE_FECHA_INICIAL);

				lps_ps.setString(li_column++, apt_parametros.getIpModificacion());
				lps_ps.setString(li_column++, apt_parametros.getIdUsuarioModificacion());
				setLong(lps_ps, apt_parametros.getIdTurnoHistoria(), li_column++);

				lps_ps.executeUpdate();
			}

			catch(SQLException lse_e)
			{
				logError(this, "updateFechaInicial", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lps_ps);
			}
		}
	}

	/**
	 * Update fecha respuesta mensaje.
	 *
	 * @param ath_parametros de ath parametros
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public void updateFechaRespuestaMensaje(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		if(ath_parametros != null)
		{
			PreparedStatement lps_ps;

			lps_ps = null;

			try
			{
				int li_column;

				li_column     = 1;
				lps_ps        = getConnection().prepareStatement(cs_UPDATE_FECHA_RESPUESTA_MENSAJE);

				lps_ps.setString(li_column++, ath_parametros.getIdMensaje());
				setDate(lps_ps, ath_parametros.getFechaRespuestaMensaje(), li_column++);
				lps_ps.setString(li_column++, ath_parametros.getIdUsuarioModificacion());
				lps_ps.setString(li_column++, ath_parametros.getIpModificacion());
				setLong(lps_ps, ath_parametros.getIdTurnoHistoria(), li_column++);

				lps_ps.executeUpdate();
			}
			catch(SQLException lse_e)
			{
				logError(this, "updateFechaRespuestaMensaje", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lps_ps);
			}
		}
	}

	/**
	 * Update id documento salida.
	 *
	 * @param ath_parametros de ath parametros
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public void updateIdDocumentoSalida(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		if(ath_parametros != null)
		{
			PreparedStatement lps_ps;
			lps_ps = null;

			try
			{
				int li_column;

				li_column     = 1;
				lps_ps        = getConnection().prepareStatement(cs_UPDATE_ID_DOCUMENTO_SALIDA);

				lps_ps.setString(li_column++, ath_parametros.getIdDocumentoSalida());
				lps_ps.setString(li_column++, ath_parametros.getIdUsuarioModificacion());
				lps_ps.setString(li_column++, ath_parametros.getIpModificacion());
				setLong(lps_ps, ath_parametros.getIdTurnoHistoria(), li_column++);

				lps_ps.executeUpdate();
			}
			catch(SQLException lse_e)
			{
				logError(this, "updateIdDocumentoSalida", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lps_ps);
			}
		}
	}

	/**
	 * Update intento envios.
	 *
	 * @param ath_parametros de ath parametros
	 * @throws B2BException Objeto de tipo B2BException, se produce cuando se encuentra algun error controlado.
	 */
	public void updateIntentoEnvios(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		if(ath_parametros != null)
		{
			PreparedStatement lps_ps;
			lps_ps = null;

			try
			{
				int li_column;

				li_column     = 1;
				lps_ps        = getConnection().prepareStatement(cs_UPDATE_INTENTO_ENVIOS);

				lps_ps.setLong(li_column++, ath_parametros.getIntentosFallidosEjecucionAutomatica());
				setDate(lps_ps, ath_parametros.getFechaExitoEjecucionAutomatica(), li_column++);
				lps_ps.setString(li_column++, ath_parametros.getRespuestaEjecucionAutomatica());
				lps_ps.setString(li_column++, ath_parametros.getIdUsuarioModificacion());
				lps_ps.setString(li_column++, ath_parametros.getIpModificacion());
				setLong(lps_ps, ath_parametros.getIdTurnoHistoria(), li_column++);

				lps_ps.executeUpdate();
			}
			catch(SQLException lse_e)
			{
				logError(this, "updateIntentoEnvios", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lps_ps);
			}
		}
	}

	/**
	 * Actualiza observaciones.
	 *
	 * @param apt_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public void updateObservaciones(TurnoHistoria apt_parametros)
	    throws B2BException
	{
		if(apt_parametros != null)
		{
			PreparedStatement lps_ps;
			lps_ps = null;

			try
			{
				int li_column;

				li_column     = 1;
				lps_ps        = getConnection().prepareStatement(cs_UPDATE_OBSERVACIONES);

				lps_ps.setString(li_column++, apt_parametros.getObservaciones());
				lps_ps.setString(li_column++, apt_parametros.getIdUsuarioModificacion());
				lps_ps.setString(li_column++, apt_parametros.getIpModificacion());
				setLong(lps_ps, apt_parametros.getIdTurnoHistoria(), li_column++);

				lps_ps.executeUpdate();
			}
			catch(SQLException lse_e)
			{
				logError(this, "updateObservaciones", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lps_ps);
			}
		}
	}

	/**
	 * Actualiza observaciones no tramite.
	 *
	 * @param apt_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public void updateObservacionesNoTramite(TurnoHistoria apt_parametros)
	    throws B2BException
	{
		if(apt_parametros != null)
		{
			PreparedStatement lps_ps;
			lps_ps = null;

			try
			{
				int li_column;

				li_column     = 1;
				lps_ps        = getConnection().prepareStatement(cs_UPDATE_OBSERVACIONES_NO_TRAMITE);

				lps_ps.setString(li_column++, apt_parametros.getObservacionesNoTramite());
				lps_ps.setString(li_column++, apt_parametros.getIdUsuarioModificacion());
				lps_ps.setString(li_column++, apt_parametros.getIpModificacion());
				setLong(lps_ps, apt_parametros.getIdTurnoHistoria(), li_column++);

				lps_ps.executeUpdate();
			}
			catch(SQLException lse_e)
			{
				logError(this, "updateObservacionesNoTramite", lse_e);

				throw new B2BException(SQL_ERROR, lse_e);
			}
			finally
			{
				close(lps_ps);
			}
		}
	}

	/**
	 * Validacion suspencion.
	 *
	 * @param ath_parametros correspondiente al valor del tipo de objeto TurnoHistoria
	 * @return verdadero, si se cumple la condicion, de lo contario retorna falso
	 * @throws B2BException Señala que se ha producido una excepción
	 */
	public boolean validacionSuspencion(TurnoHistoria ath_parametros)
	    throws B2BException
	{
		boolean           lb_return;
		PreparedStatement lps_ps;
		ResultSet         lrs_rs;

		lb_return     = true;
		lps_ps        = null;
		lrs_rs        = null;

		try
		{
			int li_contador;
			li_contador     = 1;

			lps_ps = getConnection().prepareStatement(cs_FIND_VALIDACION_SUSPENSION);

			setLong(lps_ps, ath_parametros.getIdTurnoHistoria(), li_contador++);

			lrs_rs = lps_ps.executeQuery();

			if(lrs_rs.next())
				lb_return = false;
		}
		catch(SQLException lse_e)
		{
			logError(this, "validacionSuspencion", lse_e);

			throw new B2BException(SQL_ERROR, lse_e);
		}
		finally
		{
			close(lrs_rs);
			close(lps_ps);
		}

		return lb_return;
	}

	/**
	 * Retorna el valor de bandeja recepcion de documentos.
	 *
	 * @param ars_rs correspondiente al valor del tipo de objeto ResultSet
	 * @return el valor de tramite entidad
	 * @throws SQLException Señala que se ha producido una excepción
	 */
	private TramiteCantidad getBandejaRecepcionDocumentos(ResultSet ars_rs)
	    throws SQLException
	{
		TramiteCantidad lth_datos;

		lth_datos = new TramiteCantidad();

		lth_datos.setCantidad(getInteger(ars_rs, "CANTIDAD"));
		lth_datos.setNombre(ars_rs.getString("DESCRIPCION"));
		lth_datos.setIdEtapa(getLong(ars_rs, "ID_ETAPA"));
		lth_datos.setIdMotivo(getLong(ars_rs, "ID_MOTIVO_ANT"));
		lth_datos.setIdProceso(ars_rs.getString("ID_PROCESO"));
		lth_datos.setIdSubProceso(ars_rs.getString("ID_SUBPROCESO"));
		lth_datos.setNombreSubProceso(ars_rs.getString("NOMBRE_SUBPROCESO"));

		{
			String ls_nombreProceso;

			ls_nombreProceso = ars_rs.getString("NOMBRE_PROCESO");

			lth_datos.setTramiteVinculado(ls_nombreProceso);
			lth_datos.setNombreProceso(ls_nombreProceso);
		}

		return lth_datos;
	}

	/**
	 * Retorna el valor de InteresadoDocumentoTipo.
	 *
	 * @param lrs_rs correspondiente al valor del tipo de objeto ResultSet
	 * @return el valor de InteresadoDocumentoTipo
	 * @throws SQLException Señala que se ha producido una excepción
	 */
	private InteresadoDocumentoTipo getObjetFromResultSet(ResultSet lrs_rs)
	    throws SQLException
	{
		InteresadoDocumentoTipo ls_solicitud;

		ls_solicitud = new InteresadoDocumentoTipo();

		ls_solicitud.setIdDocumentoTipo(lrs_rs.getString("ID_MOTIVO"));
		ls_solicitud.setDescripcion(lrs_rs.getString("DESCRIPCION"));

		return ls_solicitud;
	}

	/**
	 * Retorna Objeto o variable de valor tramite analista certificados.
	 *
	 * @param ars_rs de ars rs
	 * @param ab_detalle de ab detalle
	 * @return el valor de tramite analista certificados
	 * @throws SQLException cuando se produce algun error en el proceso
	 */
	private TramiteCantidad getTramiteAnalistaCertificados(ResultSet ars_rs, boolean ab_detalle)
	    throws SQLException
	{
		TramiteCantidad lth_datos;
		lth_datos = new TramiteCantidad();

		if(ab_detalle)
		{
			lth_datos.setIdTurno(ars_rs.getString("ID_TURNO"));
			lth_datos.setIdTurnoHistoria(ars_rs.getString("ID_TURNO_HISTORIA"));
			lth_datos.setFechaCreacion(ars_rs.getTimestamp("FECHA_CREACION"));
			lth_datos.setNir(ars_rs.getString("NIR"));
			lth_datos.setNombreProceso(ars_rs.getString("NOMBRE"));
			lth_datos.setFechaReparto(ars_rs.getTimestamp("FECHA_REPARTO"));
			lth_datos.setNombreSubProceso(ars_rs.getString("NOMBRE_SUBPROCESO"));
			lth_datos.setIdSubProceso(ars_rs.getString("ID_SUBPROCESO"));
			lth_datos.setIdProceso(ars_rs.getString("ID_PROCESO"));
		}
		else
		{
			lth_datos.setCantidad(getInteger(ars_rs, "CANTIDAD"));
			lth_datos.setNombreSubProceso(ars_rs.getString("NOMBRE_SUBPROCESO"));
			lth_datos.setIdSubProceso(ars_rs.getString("ID_SUBPROCESO"));
			lth_datos.setIdProceso(ars_rs.getString("ID_PROCESO"));
		}

		return lth_datos;
	}

	/**
	 * Retorna el valor de tramite cuenta cupos.
	 *
	 * @param ars_rs correspondiente al valor del tipo de objeto ResultSet
	 * @param ab_detalle correspondiente al valor del tipo de objeto boolean
	 * @return el valor de tramite cuenta cupo
	 * @throws SQLException Señala que se ha producido una excepción
	 */
	private TramiteCantidad getTramiteCuentaCupos(ResultSet ars_rs, boolean ab_detalle)
	    throws SQLException
	{
		TramiteCantidad ltc_tramiteCantidad;

		ltc_tramiteCantidad = new TramiteCantidad();

		if(ab_detalle)
		{
			ltc_tramiteCantidad.setNir(ars_rs.getString("NIR"));
			ltc_tramiteCantidad.setIdTurno(ars_rs.getString("ID_TURNO"));
			ltc_tramiteCantidad.setDocumento(ars_rs.getString("DOCUMENTO"));
			ltc_tramiteCantidad.setNombre(ars_rs.getString("NOMBRE"));
			ltc_tramiteCantidad.setFechaCreacion(ars_rs.getDate("FECHA_CREACION"));
			ltc_tramiteCantidad.setObservaciones(ars_rs.getString("OBSERVACIONES"));
			ltc_tramiteCantidad.setIdTurnoHistoria(ars_rs.getString("ID_TURNO_HISTORIA"));
		}
		else
		{
			ltc_tramiteCantidad.setNombre(ars_rs.getString("DESCRIPCION"));
			ltc_tramiteCantidad.setCantidad(getInteger(ars_rs, "CANTIDAD"));
			ltc_tramiteCantidad.setIdEtapa(getLong(ars_rs, "ID_ETAPA"));
			ltc_tramiteCantidad.setIdMotivo(getLong(ars_rs, "ID_MOTIVO"));
			ltc_tramiteCantidad.setIdSubProceso(ars_rs.getString("ID_SUBPROCESO"));
		}

		return ltc_tramiteCantidad;
	}

	/**
	 * Retorna el valor de tramite entidad.
	 *
	 * @param ars_rs correspondiente al valor del tipo de objeto ResultSet
	 * @param ab_bandejaDetalle correspondiente al valor del tipo de objeto boolean
	 * @param ab_proceso correspondiente al valor del tipo de objeto boolean
	 * @return el valor de tramite entidad
	 * @throws SQLException Señala que se ha producido una excepción
	 */
	private TramiteCantidad getTramiteEntidad(ResultSet ars_rs, boolean ab_bandejaDetalle, boolean ab_proceso)
	    throws SQLException
	{
		TramiteCantidad lth_datos;

		lth_datos = new TramiteCantidad();

		if(ab_bandejaDetalle)
		{
			lth_datos.setIdProceso(ars_rs.getString("ID_PROCESO"));
			lth_datos.setIdSubProceso(ars_rs.getString("ID_SUBPROCESO"));
			lth_datos.setNombreProceso(ars_rs.getString("PROCESO"));
			lth_datos.setIdTurno(ars_rs.getString("ID_TURNO"));
			lth_datos.setNir(ars_rs.getString("NIR"));
			lth_datos.setMotivoNoTramite(ars_rs.getString("MOTIVO_NO_TRAMITE"));
			lth_datos.setMotivo(ars_rs.getString("MOTIVO"));
			lth_datos.setObservaciones(ars_rs.getString("OBSERVACIONES"));
			lth_datos.setIdTurnoHistoria(ars_rs.getString("ID_TURNO_HISTORIA"));
			lth_datos.setIdEtapa(getLong(ars_rs, "ID_ETAPA"));
			lth_datos.setEstadoActividad(ars_rs.getString("ESTADO_ACTIVIDAD"));
			lth_datos.setNombreProceso(ars_rs.getString("NOMBRE_PROCESO"));
			lth_datos.setNombreSubProceso(ars_rs.getString("NOMBRE_SUBPROCESO"));
		}
		else
		{
			lth_datos.setCantidad(getInteger(ars_rs, "CANTIDAD"));
			lth_datos.setNombre(ars_rs.getString("DESCRIPCION"));
			lth_datos.setIdEtapa(getLong(ars_rs, "ID_ETAPA"));
			lth_datos.setIdMotivo(getLong(ars_rs, "ID_MOTIVO"));
			lth_datos.setIdEtapaAnt(ars_rs.getLong("ETAPA_ANT"));

			if(ab_proceso)
				lth_datos.setTramiteVinculado(ars_rs.getString("PROCESO"));
		}

		return lth_datos;
	}

	/**
	 * Metodo encargado de llenar el objeto <code>TramiteCantidad</code> con los resultados del argumento.
	 *
	 * @param ars_rs Argumento de tipo <code>ResultSet</code> que contiene los resultados de la consulta.
	 * @return Objeto de tipo <code>TramiteCantidad</code> que contiene los resultados de la consulta.
	 * @throws SQLException cuando se produce algun error en el proceso
	 */
	private TramiteCantidad getTramiteEntidadDigitalizacion(ResultSet ars_rs)
	    throws SQLException
	{
		TramiteCantidad lth_datos;
		lth_datos = new TramiteCantidad();

		lth_datos.setNombreProceso(ars_rs.getString("PROCESO"));
		lth_datos.setIdTurno(ars_rs.getString("ID_TURNO"));
		lth_datos.setNir(ars_rs.getString("NIR"));
		lth_datos.setMotivo(ars_rs.getString("MOTIVO"));
		lth_datos.setObservaciones(ars_rs.getString("OBSERVACIONES"));
		lth_datos.setIdTurnoHistoria(ars_rs.getString("ID_TURNO_HISTORIA"));
		lth_datos.setIdEtapa(getLong(ars_rs, "ID_ETAPA"));
		lth_datos.setEstadoActividad(ars_rs.getString("ESTADO_ACTIVIDAD"));
		lth_datos.setNombreProceso(ars_rs.getString("NOMBRE_PROCESO"));
		lth_datos.setNombreSubProceso(ars_rs.getString("NOMBRE_SUBPROCESO"));

		return lth_datos;
	}

	/**
	 * Retorna el valor de tramite analista certificados.
	 *
	 * @param ars_rs correspondiente al valor del tipo de objeto ResultSet
	 * @return el valor de tramite analista certificados
	 * @throws SQLException Señala que se ha producido una excepción
	 */
	private TramiteCantidad getTramiteImpresionDocumentosCorrespondencia(ResultSet ars_rs)
	    throws SQLException
	{
		TramiteCantidad lth_datos;
		lth_datos = new TramiteCantidad();

		lth_datos.setCantidad(getInteger(ars_rs, "CANTIDAD"));
		lth_datos.setNombre(ars_rs.getString("NOMBRE"));
		lth_datos.setIdEtapa(getLong(ars_rs, "ID_ETAPA"));

		return lth_datos;
	}

	/**
	 * Su función es obtener los datos que retornó una consulta y almacenarlos
	 * en los atributos de un objeto TurnoHistoria.
	 *
	 * @param ars_rs Objeto contenedor de los datos resultantes de una consulta
	 * determinada
	 * @return Objeto TurnoHistoria al cual se le asignará la información de la
	 * consulta en sus atributos
	 * @throws SQLException Señala que se ha producido una excepción
	 */
	private TurnoHistoria getTurnoHistoria(ResultSet ars_rs)
	    throws SQLException
	{
		TurnoHistoria lth_datos;
		lth_datos = new TurnoHistoria();

		lth_datos.setIdTurnoHistoria(getLong(ars_rs, "ID_TURNO_HISTORIA"));
		lth_datos.setIdTurno(ars_rs.getString("ID_TURNO"));
		lth_datos.setIdSolicitud(ars_rs.getString("ID_SOLICITUD"));
		lth_datos.setIdEtapa(ars_rs.getBigDecimal("ID_ETAPA"));
		lth_datos.setIdUsuario(ars_rs.getString("ID_USUARIO"));
		lth_datos.setIdCirculoUsuario(ars_rs.getString("ID_CIRCULO_USUARIO"));
		lth_datos.setIndicadorDevolucion(ars_rs.getString("INDICADOR_DEVOLUCION"));
		lth_datos.setEstadoActividad(ars_rs.getString("ESTADO_ACTIVIDAD"));
		lth_datos.setFechaReparto(ars_rs.getTimestamp("FECHA_REPARTO"));
		lth_datos.setFechaInicial(ars_rs.getTimestamp("FECHA_INICIAL"));
		lth_datos.setFechaFinal(ars_rs.getTimestamp("FECHA_FINAL"));
		lth_datos.setFechaVencimiento(ars_rs.getDate("FECHA_VENCIMIENTO"));
		lth_datos.setCalificacion(ars_rs.getString("CALIFICACION"));
		lth_datos.setMotivo(ars_rs.getString("MOTIVO"));
		lth_datos.setObservaciones(ars_rs.getString("OBSERVACIONES"));
		lth_datos.setIdAnterior(ars_rs.getBigDecimal("ID_ANTERIOR"));
		lth_datos.setIdProceso(ars_rs.getString("ID_PROCESO"));
		lth_datos.setMotivoNoTramite(ars_rs.getString("MOTIVO_NO_TRAMITE"));
		lth_datos.setObservacionesNoTramite(ars_rs.getString("OBSERVACIONES_NO_TRAMITE"));
		lth_datos.setIdMotivo(getLong(ars_rs, "ID_MOTIVO"));
		lth_datos.setGenerarRelacion(ars_rs.getString("GENERAR_RELACION"));
		lth_datos.setNumeroRelacion(ars_rs.getString("NUMERO_RELACION"));
		lth_datos.setJustificacion(ars_rs.getString("JUSTIFICACION"));
		lth_datos.setIdSubproceso(ars_rs.getString("ID_SUBPROCESO"));
		lth_datos.setVersionSubproceso(getLong(ars_rs, "VERSION_SUBPROCESO"));
		lth_datos.setResultadoAvance(getLong(ars_rs, "RESULTADO_AVANCE"));
		lth_datos.setObservacionAvance(ars_rs.getString("OBSERVACION_AVANCE"));
		lth_datos.setFechaVencimiento(ars_rs.getTimestamp("FECHA_VENCIMIENTO"));
		lth_datos.setIdMensaje(ars_rs.getString("ID_MENSAJE"));
		lth_datos.setIdDocumentoSalida(ars_rs.getString("ID_DOCUMENTO_SALIDA"));
		lth_datos.setRenunciaTerminos(ars_rs.getString("RENUNCIA_TERMINOS"));
		lth_datos.setFechaRespuestaMensaje(ars_rs.getTimestamp("FECHA_RESPUESTA_MENSAJE"));
		lth_datos.setIntentosFallidosEjecucionAutomatica(ars_rs.getLong("INTENTOS_FALLIDOS_EJECUCION_AUTOMATICA"));
		lth_datos.setFechaIntentoEjecucionAutomatica(ars_rs.getTimestamp("FECHA_INTENTO_EJECUCION_AUTOMATICA"));
		lth_datos.setFechaExitoEjecucionAutomatica(ars_rs.getTimestamp("FECHA_EXITO_EJECUCION_AUTOMATICA"));
		lth_datos.setRespuestaEjecucionAutomatica(ars_rs.getString("RESPUESTAS_EJECUCION_AUTOMATICA"));

		fillAuditoria(ars_rs, lth_datos);

		return lth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo Data aprobador antiguo sistema.
	 *
	 * @param ars_rs correspondiente al valor del tipo de objeto ResultSet
	 * @return devuelve el valor del objeto aprobacion
	 * @throws SQLException Señala que se ha producido una excepción
	 */
	private Aprobacion dataAprobadorAntiguoSistema(ResultSet ars_rs)
	    throws SQLException
	{
		Aprobacion lth_datos;
		lth_datos = new Aprobacion();

		lth_datos.setIdTurnoHistoria(NumericUtils.getLongWrapper(ars_rs.getLong("ID_TURNO_HISTORIA")));
		lth_datos.setIdTurno(ars_rs.getString("ID_TURNO"));
		lth_datos.setNir(ars_rs.getString("NIR"));
		lth_datos.setMotivo(ars_rs.getString("MOTIVO"));
		lth_datos.setMotivoNoTramite(ars_rs.getString("MOTIVO_NO_TRAMITE"));
		lth_datos.setObservaciones(ars_rs.getString("OBSERVACIONES"));

		return lth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo Data principal.
	 *
	 * @param ars_rs correspondiente al valor del tipo de objeto ResultSet
	 * @param ab_b correspondiente al valor del tipo de objeto boolean
	 * @return devuelve el valor del objeto aprobacion
	 * @throws SQLException Señala que se ha producido una excepción
	 */
	private Aprobacion dataPrincipal(ResultSet ars_rs, boolean ab_b)
	    throws SQLException
	{
		Aprobacion lth_datos;
		lth_datos = new Aprobacion();

		if(ab_b)
		{
			lth_datos.setProceso(ars_rs.getString("PROCESO"));
			lth_datos.setIdTurno(ars_rs.getString("ID_TURNO"));
			lth_datos.setNir(ars_rs.getString("NIR"));
			lth_datos.setMotivoNoTramite(ars_rs.getString("MOTIVO_NO_TRAMITE"));
			lth_datos.setMotivo(ars_rs.getString("MOTIVO"));
			lth_datos.setObservaciones(ars_rs.getString("OBSERVACIONES"));
			lth_datos.setIdTurnoHistoria(getLong(ars_rs, "ID_TURNO_HISTORIA"));
			lth_datos.setIdProceso(ars_rs.getString("ID_PROCESO"));
			lth_datos.setEstadoActividad(ars_rs.getString("ESTADO_ACTIVIDAD"));
		}
		else
		{
			lth_datos.setMotivoNoTramite(ars_rs.getString("MOTIVO_NO_TRAMITE"));
			lth_datos.setCantidad(getLong(ars_rs, "CANTIDAD"));
			lth_datos.setIdEtapaAnterior(getLong(ars_rs, "ID_ETAPA"));
			lth_datos.setMotivo(ars_rs.getString("ID_MOTIVO"));
		}

		return lth_datos;
	}

	/**
	 * Retorna el valor del objeto de tipo Datos turno.
	 *
	 * @param ars_rs correspondiente al valor del tipo de objeto ResultSet
	 * @return devuelve el valor del objeto turno historia
	 * @throws SQLException Señala que se ha producido una excepción
	 */
	private TurnoHistoria datosTurno(ResultSet ars_rs)
	    throws SQLException
	{
		TurnoHistoria lth_datos;
		lth_datos = new TurnoHistoria();

		lth_datos.setIdTurno(ars_rs.getString("ID_TURNO"));
		lth_datos.setIdSolicitud(ars_rs.getString("ID_SOLICITUD"));

		return lth_datos;
	}

	/**
	 * Obtiene los resultados de la consulta.
	 *
	 * @param ars_rs Objeto contenedor de lso resultados de la consulta
	 * @return Objeto aprobación con el resultado de la consulta
	 * @throws SQLException Señala que se ha producido una excepción
	 */
	private Aprobacion obtenerBandejaPorSubproceso(ResultSet ars_rs)
	    throws SQLException
	{
		Aprobacion la_datos;
		la_datos = new Aprobacion();

		la_datos.setMotivoNoTramite(ars_rs.getString("NOMBRE"));
		la_datos.setCantidad(getLong(ars_rs, "CANTIDAD"));

		return la_datos;
	}

	/**
	 * Extrae de la consulta el id turno resultante.
	 *
	 * @param ars_rs objeto contenedor de los resultados de la consulta
	 * @return Objeto turno historia con el id turno encontrado
	 * @throws SQLException Señala que se ha producido una excepción
	 */
	private TurnoHistoria obtenerTurnos(ResultSet ars_rs)
	    throws SQLException
	{
		TurnoHistoria lth_datos;
		lth_datos = new TurnoHistoria();

		lth_datos.setIdTurno(ars_rs.getString("ID_TURNO"));

		return lth_datos;
	}
}
